<html lang="ja" style="--bar-color: #000016;"><head>
  <meta charset="UTF-8">
  <title>名刺プレビュー</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Helvetica Neue', sans-serif;
      background-color: #ffffff;
      overflow: auto;
    }

    body {
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  overflow-x: hidden; /* 👈 横スクロール禁止！ */
  padding-bottom: 0px; 
}
    .main-wrapper {
      min-height: 100vh;
      padding-bottom: 140px; /* ツールバーを考慮 */
      box-sizing: border-box;
    }
    .card {
      width: 90%;
      max-width: 700px;
      margin: 30px auto;
      border: 2px solid #ccc;
      border-radius: 10px;
      background-color: white;
      overflow-y: auto;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
    }

    .header-bar {
      background-color: var(--bar-color, #6a1b9a);
      height: 40px;
    }

    .student-id {
      display: flex;
      flex-direction: row;
      padding: 20px;
      gap: 20px;
    }

    .left-section {
      width: 40%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .left-section img {
      width: 125px;
      height: 125px;
      object-fit: cover;
      border-radius: 15px;
      cursor: pointer;
    }

    .info-section {
      width: 60%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      font-size: 14px;
      line-height: 1.6;
    }

    .editable-text {
      border: none;
      background: transparent;
      border-bottom: 1px solid #ccc;
      font-size: 14px;
      width: 100%;
    }
body {
  padding-bottom: 10px;
  box-sizing: border-box;
}

    .toolbar {
      position: fixed;
      bottom: 5px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 10px 16px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      display: flex;
      gap: 16px;
      z-index: 1000;
      align-items: center;
      
    }

    .toolbar img {
      width: 28spx;
      height: 28px;
      cursor: pointer;
    }

    .toolbar button {
      padding: 4px 12px;
      border: none;
      background: #eee;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }

        .hidden-input {
      opacity: 0;
      position: absolute;
      pointer-events: auto;
    }


    .sns-bar {
      margin: 20px auto;
      padding-left: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      z-index: 900;
    }

    .sns-item {
      background: white;
      border-radius: 12px;
      padding: 10px 16px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 16px;
      max-width: fit-content;
    }

    .sns-item img {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    .sns-input {
      margin-left: 36px;
      margin-top: 8px;
      display: none;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 5px 10px;
      width: 220px;
      font-size: 14px;
    }

    .sns-wrapper {
      display: flex;
      flex-direction: column;
    }

    canvas {
      position: fixed;
      top: 0;
      left: 0;
      z-index: 800;
      display: none;
    }

    .deco-img {
      position: absolute;
      width: 100px;
      height: auto;
      cursor: move;
      z-index: 950;
      user-select: none;
      touch-action: none;
    }
  .text-sticker {
  position: absolute;
  font-size: 20px;
  font-weight: bold;
  color: #222;
  background: transparent;
  border: none;
  padding: 0;
  z-index: 970;
  max-width: 80vw;
  word-break: break-word;
  user-select: none;
  cursor: move;
}
.sns-item {
  position: relative; /* ボタンを上に重ねるために必要 */
}

.sns-delete-btn {
  position: absolute;
  top: -8px;
  right: -8px;
  width: 18px;
  height: 18px;
  cursor: pointer;
  z-index: 10;
}
#bg-template-list::-webkit-scrollbar {
  display: none;
}
.youtube-section {
  margin-top: 10px;
  margin-bottom: 60px; /* ← 追加！ */
  text-align: center;
}
#youtube-url {
  width: 70%;
  max-width: 500px;
  padding: 5px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 14px;
  margin-top: 5px;
}
#youtube-player {
  margin: 0;
  padding: 0;
  line-height: 0;
}
iframe {
  width: 100%;
  height: 200px; /* ← aspect-ratioと併用せず明示指定で高さ固定 */
  border: none;
  margin: 0 auto;
  padding: 0;
}
body {
  box-sizing: border-box;
}
body {
  overscroll-behavior: contain; /* ← iOSスクロール跳ね返りを抑制 */
  padding-bottom: 80px;
}

  </style>
</head>
<body style="background-image: url(&quot;/static/haikei_9.jpeg&quot;);">
  <div class="card">
    <div class="header-bar"></div>
    <div class="student-id">
      <div class="left-section">
        <img id="profile-img" src="data:image/jpeg;base64,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" alt="プロフィール画像">
        <input type="file" accept="image/*" id="profile-input" class="hidden-input">
      </div>
      <div class="info-section">
        <input type="text" class="editable-text" placeholder="名前" value="名前　高橋駿">
        <input type="text" class="editable-text" placeholder="誕生日" value="誕生日　4月20日">
        <input type="text" class="editable-text" placeholder="年齢" value="年齢　20歳">
        <input type="text" class="editable-text" placeholder="出身地" value="出身地　東京">
        <input type="text" class="editable-text" placeholder="趣味" value="趣味　走る事">
      </div>
    </div>
  </div>

 <!-- ▼ SNSアイコンと入力欄 -->
<div class="sns-bar">
  <div class="sns-wrapper">
    <div class="sns-item" style="position: relative;"><a href="https://www.instagram.com/shun_050420/" target="_blank" style="display: flex; align-items: center; gap: 10px; text-decoration: none; color: inherit;"><img src="/static/instagram_icon.jpeg" alt="Instagram" onclick="handleIconClick('instagram')">instagram</a></div>
    <input id="input-instagram" class="sns-input" placeholder="https://www.instagram.com/yourid" onblur="handleBlur('instagram')" style="display: none;">
  </div>

  <div class="sns-wrapper">
    <div class="sns-item" style="position: relative;">
      <img src="/static/X_icon.jpeg" alt="X" onclick="handleIconClick('x')">
      X（旧Twitter）
      
    </div>
    <input id="input-x" class="sns-input" placeholder="https://twitter.com/yourid" onblur="handleBlur('x')">
  </div>

  <div class="sns-wrapper">
    <div class="sns-item" style="position: relative;">
      <img src="/static/tiktok_icon.jpeg" alt="TikTok" onclick="handleIconClick('tiktok')">
      TikTok
      
    </div>
    <input id="input-tiktok" class="sns-input" placeholder="https://www.tiktok.com/@yourid" onblur="handleBlur('tiktok')">
  </div>
</div>


<!-- ▼ 自由記入欄（バツ付き） -->
<div id="extra-text-wrapper" class="sns-wrapper" style="margin-top: 20px; position: relative;">
  
  <textarea id="extra-text" class="editable-text" placeholder="記入欄" style="
    margin-top: 3px;
    margin-left: 20px;
    padding: 14px 18px;
    border-radius: 14px;
    border: 1px solid #ccc;
    width: 85vw;
    max-width: 600px;
    height: 150px;
    font-size: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.12);
    resize: none;
    line-height: 1.6;
    background-color: #fff;
    box-sizing: border-box;
  " value="Smart value">Smart value</textarea>
<input type="hidden" id="hidden-extra-text" name="extra-text" value="Smart value"></div>




<!-- ▼ YouTube入力欄 -->
<div class="youtube-section" style="position: relative; margin-top: 20px;">
  <img src="/static/batu.jpeg" alt="削除" class="sns-delete-btn" onclick="hideYouTubeSection()" style="position: absolute; top: 15px; right: 20px; width: 18px; height: 18px; cursor: pointer; z-index: 10; display: none;">

  <!-- ここを先に -->
  <div id="youtube-player" style="padding: 0; text-align: center;">
      <iframe width="100%" height="200" style="max-width: 90vw;" src="https://www.youtube.com/embed/GxiE-3bnYBE" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">
      </iframe>
    </div>

  <!-- 見出し -->
  <div style="font-weight: bold; font-size: 14px; margin-bottom: 6px; text-align: left; padding-left: 5vw;">
    URL<br><span style="font-size: 12px; color: #555;">YouTube</span>
  </div>

  <!-- 入力欄とボタン -->
  <input type="text" id="youtube-url" placeholder="YouTubeのURLを入力" style="width: 84vw; max-width: 500px; padding: 10px; border: 1px solid rgb(204, 204, 204); border-radius: 10px; font-size: 14px; display: none;">
  <button onclick="embedYouTubeVideo()" style="margin-left: 20px; padding: 8px 12px; font-size: 14px; border-radius: 8px; background: rgb(240, 240, 240); display: none;">反映</button>
</div>


  <canvas id="draw-canvas" width="390" height="663" style="display: none;"></canvas>
  <input type="file" id="background-input" class="hidden-input" accept="image/*" onchange="loadBackgroundImage(event)">
  <input type="file" id="deco-input" class="hidden-input" accept="image/*" onchange="addDecoImage(event)">
  <input type="color" id="color-picker" class="hidden-input" onchange="changeBarColor(event)">
<button id="finish-button" style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgb(238, 238, 238); border: medium; padding: 6px 16px; font-size: 16px; border-radius: 10px; box-shadow: rgba(0, 0, 0, 0.2) 0px 2px 6px; z-index: 1001; cursor: pointer; display: none;" disabled="">生成中...</button>
 <div class="toolbar" id="toolbar" style="display: none;">
    <img src="/static/upload.jpeg" onclick="toggleBackgroundList()">
    <img src="/static/pen_off.jpeg" onclick="toggleTextMode()" id="text-toggle-icon">
    <div style="position: relative; width: 28px; height: 28px;">
  <img src="/static/student.jpeg" style="width: 100%; height: 100%; cursor: pointer;">
  <input type="color" id="color-picker" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                opacity: 0; cursor: pointer;" onchange="changeBarColor(event)">
</div>
<img src="/static/restore.jpeg" onclick="restoreSNS()" style="width: 28px; height: 28px; cursor: pointer;">
    <img src="/static/photo_icon.jpeg" onclick="document.getElementById('deco-input').click()">
    <button onclick="togglePreview()" id="check-button">確認</button>
  </div>

  <script>
    const urls = { instagram: '', x: '', tiktok: '' };
    const canvas = document.getElementById('draw-canvas');
    const ctx = canvas.getContext('2d');
  function togglePreview() {
  const toolbar = document.getElementById('toolbar');
  const finalBtn = document.getElementById('finish-button');

  toolbar.style.display = 'none';
  finalBtn.style.display = 'block';
}
    let drawing = false, drawEnabled = false;
    let paths = [], currentPath = [];

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      redraw();
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function redraw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 2;
      for (const path of paths) {
        ctx.beginPath();
        path.forEach(([x, y], i) => i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y));
        ctx.stroke();
      }
      if (currentPath.length) {
        ctx.beginPath();
        currentPath.forEach(([x, y], i) => i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y));
        ctx.stroke();
      }
    }

    canvas.addEventListener('mousedown', e => {
      if (!drawEnabled) return;
      drawing = true;
      currentPath = [[e.offsetX, e.offsetY]];
    });

    canvas.addEventListener('mousemove', e => {
      if (!drawing || !drawEnabled) return;
      currentPath.push([e.offsetX, e.offsetY]);
      redraw();
    });

    canvas.addEventListener('mouseup', () => {
      if (!drawing || !drawEnabled) return;
      drawing = false;
      paths.push(currentPath);
      currentPath = [];
    });

    function toggleTextMode() {
      drawEnabled = !drawEnabled;
      canvas.style.display = drawEnabled ? 'block' : 'none';
      const icon = document.getElementById('text-toggle-icon');
      icon.src = drawEnabled ? '/static/pen_on.jpeg' : '/static/pen_off.jpeg';
    }

    function loadBackgroundImage(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        document.body.style.backgroundImage = `url('${reader.result}')`;
      };
      reader.readAsDataURL(file);
    }

    function changeBarColor(e) {
      document.documentElement.style.setProperty('--bar-color', e.target.value);
    }

    function handleIconClick(service) {
      const input = document.getElementById(`input-${service}`);
      if (urls[service]) {
        window.open(urls[service], '_blank');
      } else {
        input.style.display = 'block';
        input.focus();
      }
    }

    function handleBlur(service) {
      const input = document.getElementById(`input-${service}`);
      const value = input.value.trim();
      if (value) urls[service] = value;
      input.style.display = 'none';
    }

   function addDecoImage(e) {
  const file = e.target.files[0];
  if (!file) return;

  const img = document.createElement('img');
  const reader = new FileReader();
reader.onload = () => {
  img.src = reader.result;
};
reader.readAsDataURL(file);

 const scrollX = window.scrollX;
const scrollY = window.scrollY;

img.className = 'deco-img';
img.style.position = 'absolute'; // ← fixedじゃなくabsolute！
img.style.left = (150 + scrollX) + 'px';
img.style.top = (300 + scrollY) + 'px';
img.style.transform = 'rotate(0deg) scale(1)';
img.style.touchAction = 'none';
img.draggable = false;

document.body.appendChild(img);

let posX = 150 + scrollX, posY = 300 + scrollY, scale = 1, rotation = 0;
let isDragging = false, offsetX = 0, offsetY = 0;
let longPressTimer = null;

  // PC用マウス操作
  img.addEventListener('mousedown', e => {
    isDragging = true;
    offsetX = e.offsetX;
    offsetY = e.offsetY;
    longPressTimer = setTimeout(() => img.remove(), 1000);
  });

  document.addEventListener('mousemove', e => {
    if (!isDragging) return;
    clearTimeout(longPressTimer);
    posX = e.pageX - offsetX;
    posY = e.pageY - offsetY;
    img.style.left = `${posX}px`;
    img.style.top = `${posY}px`;
  });

  document.addEventListener('mouseup', () => {
    isDragging = false;
    clearTimeout(longPressTimer);
  });

  // スマホ用タッチ操作
  let initialDistance = null;
  let initialAngle = null;
  let startScale = 1;
  let startRotation = 0;

  img.addEventListener('touchstart', e => {
    if (e.touches.length === 1) {
      offsetX = e.touches[0].clientX - posX;
      offsetY = e.touches[0].clientY - posY;
      longPressTimer = setTimeout(() => img.remove(), 1000);
    } else if (e.touches.length === 2) {
      clearTimeout(longPressTimer);
      initialDistance = getDistance(e.touches[0], e.touches[1]);
      initialAngle = getAngle(e.touches[0], e.touches[1]);
      startScale = scale;
      startRotation = rotation;
    }
  }, { passive: false });

  img.addEventListener('touchmove', e => {
    e.preventDefault();
    if (e.touches.length === 1) {
      clearTimeout(longPressTimer);
      posX = e.touches[0].clientX - offsetX;
      posY = e.touches[0].clientY - offsetY;
      img.style.left = `${posX}px`;
      img.style.top = `${posY}px`;
    } else if (e.touches.length === 2) {
      const newDistance = getDistance(e.touches[0], e.touches[1]);
      const newAngle = getAngle(e.touches[0], e.touches[1]);

      scale = startScale * (newDistance / initialDistance);
      if (scale < 0.2) scale = 0.2;

      rotation = startRotation + (newAngle - initialAngle);
      img.style.transform = `rotate(${rotation}deg) scale(${scale})`;
    }
  }, { passive: false });

  img.addEventListener('touchend', () => {
    clearTimeout(longPressTimer);
  });

  function getDistance(t1, t2) {
    return Math.hypot(t2.clientX - t1.clientX, t2.clientY - t1.clientY);
  }

  function getAngle(t1, t2) {
    return Math.atan2(t2.clientY - t1.clientY, t2.clientX - t1.clientX) * 180 / Math.PI;
  }
}

    function downloadCard() {
      alert("この部分で画像化＆ZIP化などの処理を行います");
    }

    window.onload = () => {
      canvas.style.display = 'none';
      const profileImg = document.getElementById("profile-img");
      const profileInput = document.getElementById("profile-input");

      profileImg.addEventListener("click", () => {
        profileInput.click();
      });

      profileInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = () => {
          profileImg.src = reader.result;
        };
            fetch('/upload_profile_image', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ image: reader.result })
    })
    .then(response => response.json())
    .then(data => {
      console.log('保存成功:', data);
    })
    .catch(error => {
      console.error('アップロード失敗:', error);
    });

        reader.readAsDataURL(file);
      });
    };
let textEnabled = false;
let textFirstTapDone = false; // ← 追加：初回スキップフラグ

document.getElementById("text-toggle-icon").addEventListener("click", () => {
  textEnabled = !textEnabled;
  textFirstTapDone = false; // ONにしたときにリセット
});

document.body.addEventListener("click", (e) => {
  if (!textEnabled) return;

  if (!textFirstTapDone) {
    textFirstTapDone = true;
    return; // ← 初回はスキップして反応なし
  }

  if (e.target.tagName === "INPUT" || e.target.tagName === "TEXTAREA") return;
 const margin = 20;
const inputWidth = 150;
const maxX = window.innerWidth - inputWidth - margin;
const x = Math.min(e.pageX, maxX);
const y = e.pageY;

const input = document.createElement("input");
input.type = "text";
input.placeholder = "テキストを入力";
input.className = "text-sticker";
input.style.position = "absolute";
input.style.left = `${x}px`;
input.style.top = `${y}px`;
input.style.width = '150px';  // 固定サイズで横スクロール防止
input.style.maxWidth = 'calc(100vw - 40px)';  // 念のための安全策
document.body.appendChild(input);
// 入力が空のままフォーカスが外れたら消す処理
input.addEventListener("blur", () => {
  if (input.value.trim() === "") {
    input.remove();
  }
});
input.focus();
  let offsetX, offsetY, dragging = false;

  input.addEventListener("mousedown", (ev) => {
    dragging = true;
    offsetX = ev.offsetX;
    offsetY = ev.offsetY;
  });

  document.addEventListener("mousemove", (ev) => {
    if (!dragging) return;
    input.style.left = `${ev.pageX - offsetX}px`;
    input.style.top = `${ev.pageY - offsetY}px`;
  });

  document.addEventListener("mouseup", () => {
    dragging = false;
  });

  // 長押しで削除（スマホ用）
  let longPressTimer;
  input.addEventListener("touchstart", () => {
    longPressTimer = setTimeout(() => {
      input.remove();
    }, 1000);
  });

  input.addEventListener("touchend", () => {
    clearTimeout(longPressTimer);
  });
});
// SNS項目を非表示にする関数
function hideSNS(service) {
  const wrapper = document.querySelector(`.sns-wrapper:has(#input-${service})`);
  if (wrapper) wrapper.style.display = 'none';
}
function showHiddenSNS() {
  ['instagram', 'x', 'tiktok'].forEach(service => {
    const wrapper = document.querySelector(`.sns-wrapper:has(#input-${service})`);
    if (wrapper && wrapper.style.display === 'none') {
      wrapper.style.display = 'block';
    }
  });
}

function toggleBackgroundList() {
  const list = document.getElementById('bg-template-list');
  list.style.display = (list.style.display === 'none' || list.style.display === '') ? 'flex' : 'none';
}

function setBackground(url) {
  document.body.style.backgroundImage = `url('${url}')`;
  document.getElementById('bg-template-list').style.display = 'none';
}
function hideAddLink(event) {
  event.stopPropagation(); // 「showHiddenSNS()」が動かないように
  const addBtn = document.getElementById('add-link-button');
  if (addBtn) addBtn.style.display = 'none';
}function restoreSNS() {
  ['instagram', 'x', 'tiktok'].forEach(service => {
    const wrapper = document.querySelector(`.sns-wrapper:has(#input-${service})`);
    if (wrapper) wrapper.style.display = 'flex';
  });

  const addBtn = document.getElementById('add-link-button');
  if (addBtn) addBtn.style.display = 'flex';
  const extraTextWrapper = document.getElementById('extra-text-wrapper');
  if (extraTextWrapper) extraTextWrapper.style.display = 'block';
  const youtubeSection = document.querySelector('.youtube-section');
  if (youtubeSection) youtubeSection.style.display = 'block';
}
function hideExtraText() {
  const wrapper = document.getElementById('extra-text-wrapper');
  if (wrapper) wrapper.style.display = 'none';
}
document.getElementById('finish-button').addEventListener('click', async () => {
  const finishBtn = document.getElementById('finish-button');
  finishBtn.disabled = true;
  finishBtn.textContent = '生成中...';
// 入力値を表示用の要素に反映
// 入力値を表示エリアに反映する（完成前に必要！）
// 入力値を value 属性に反映（Firebaseに反映されるように）
const editableTexts = document.querySelectorAll('.editable-text');
editableTexts.forEach((input) => {
  input.setAttribute('value', input.value.trim());
});

// 記入欄（textarea）の値を value に反映
const extraInput = document.getElementById('extra-text');
if (extraInput) {
  const text = extraInput.value.trim();
  extraInput.setAttribute('value', text);

  let hidden = document.getElementById('hidden-extra-text');
  if (!hidden) {
    hidden = document.createElement('input');
    hidden.type = 'hidden';
    hidden.id = 'hidden-extra-text';
    hidden.name = 'extra-text';
    extraInput.parentNode.appendChild(hidden); // ✅ 修正！
  }
  hidden.value = text;
   extraInput.textContent = text;
}

  const toolbar = document.getElementById('toolbar');
  if (toolbar) toolbar.style.display = 'none';


  const youtubeBatsu = document.querySelector('.youtube-section .sns-delete-btn');
  if (youtubeBatsu) youtubeBatsu.style.display = 'none';
  // ✅ YouTube入力欄と反映ボタンを非表示にする
const youtubeInput = document.getElementById('youtube-url');
const youtubeButton = document.querySelector('.youtube-section button');
if (youtubeInput) youtubeInput.style.display = 'none';
if (youtubeButton) youtubeButton.style.display = 'none';

// SNSバツ削除
document.querySelectorAll('.sns-wrapper .sns-delete-btn').forEach(btn => {
  if (btn.parentNode) {
    btn.parentNode.removeChild(btn);
  }
});

  const extraBatsu = document.querySelector('#extra-text-wrapper .sns-delete-btn');
  if (extraBatsu) extraBatsu.style.display = 'none';
  // SNSリンクをHTMLに埋め込む処理（完成ボタン処理の中に追加）
['instagram', 'x', 'tiktok'].forEach(service => {
  const wrapper = document.querySelector(`.sns-wrapper:has(#input-${service})`);
  const link = urls[service];
  if (wrapper && link) {
    const snsItem = wrapper.querySelector('.sns-item');
    if (snsItem) {
      const img = snsItem.querySelector('img'); // アイコン画像
      const label = snsItem.childNodes[1]?.textContent?.trim() || service;

      // aタグでラップしてクリック可能に
      const anchor = document.createElement('a');
      anchor.href = link;
      anchor.target = '_blank';
      anchor.style.display = 'flex';
      anchor.style.alignItems = 'center';
      anchor.style.gap = '10px';
      anchor.style.textDecoration = 'none';
      anchor.style.color = 'inherit';

      anchor.appendChild(img);
      anchor.appendChild(document.createTextNode(label));

      snsItem.innerHTML = '';
      snsItem.appendChild(anchor);
    }
  }
});


  // ✅ プロフィール画像が blob: だったら保存済みのURLに書き換える
  const profileImg = document.getElementById("profile-img");
  if (profileImg && profileImg.src.startsWith("blob:")) {
    profileImg.src = "/static/uploads/profile.jpeg";
  }
  if (profileImg && profileImg.src.startsWith("data:image/")) {
    profileImg.src = await compressImage(profileImg.src);
  }

  const decoImgs = document.querySelectorAll("img.deco-img");
  for (const img of decoImgs) {
    if (img.src.startsWith("data:image/")) {
      img.src = await compressImage(img.src);
    }
  }
    finishBtn.style.display = 'none';

    const html = document.documentElement.outerHTML;

  // ✅ base64画像のうち、プロフィール画像とデコ画像だけは削除対象から除外！
  const cleanedHTML = html.replace(/<img[^>]+src="data:image\/[^"]+"[^>]*>/g, (match) => {
    if (match.includes('id="profile-img"') || match.includes('class="deco-img"')) {
      return match; // → プロフィール画像 or デコ画像はそのまま残す
    } else {
      return match.replace(/src="data:image\/[^"]+"/, 'src="/static/deleted_image.jpeg"');
    }
  });

  const formData = new FormData();
  formData.append('html', cleanedHTML);

  const res = await fetch('/generate_url', {
    method: 'POST',
    body: formData
  });

  const data = await res.json();
  if (data.url) {
    finishBtn.textContent = '生成完了';
    finishBtn.style.display = 'block';

    const output = document.createElement('div');
    output.id = 'shared-url-box';
    output.innerHTML = `<p>このURLを共有できます👇</p><a href="${data.url}" target="_blank">${data.url}</a>`;
    output.style.cssText = `...`; // スタイル省略可
    document.body.appendChild(output);

    setTimeout(() => {
      const box = document.getElementById('shared-url-box');
      if (box) box.remove();
    }, 600000);
  } else {
    alert('URLの発行に失敗しました');
    finishBtn.disabled = false;
    finishBtn.textContent = '完成';
    finishBtn.style.display = 'block';
  }
});



function embedYouTubeVideo() {
  const input = document.getElementById('youtube-url');
  const player = document.getElementById('youtube-player');
  let url = input.value.trim();

  // m.youtube → www.youtube に変換
  url = url.replace("m.youtube.com", "www.youtube.com");

  const match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/);
  if (match && match[1]) {
    const videoId = match[1];
    player.innerHTML = `
      <iframe width="100%" height="200" 
      style="max-width: 90vw;"  
        src="https://www.youtube.com/embed/${videoId}" 
        frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
        allowfullscreen>
      </iframe>
    `;
  } else {
    player.innerHTML = "<p style='color:red;'>正しいYouTubeのURLを入力してください。</p>";
  }
}
function hideYouTubeSection() {
    const section = document.querySelector('.youtube-section');
    if (section) {
      section.style.display = 'none';
    }
  }
  // base64画像をリサイズ＋圧縮する関数
async function compressImage(base64, maxSize = 300) {
  return new Promise((resolve) => {
    const img = new Image();
    img.onload = () => {
      const canvas = document.createElement("canvas");

      const scale = Math.min(maxSize / img.width, maxSize / img.height, 1);
      canvas.width = img.width * scale;
      canvas.height = img.height * scale;

      const ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      const compressed = canvas.toDataURL("image/jpeg", 0.6); // 60%圧縮
      resolve(compressed);
    };
    img.src = base64;
  });
}

  </script>
<!-- 横スクロール可能な背景テンプレ一覧 -->
<div id="bg-template-list" style="display: none; position: fixed; bottom: 70px; left: 50%; transform: translateX(-50%); background: white; padding: 10px; border-radius: 12px; box-shadow: rgba(0, 0, 0, 0.2) 0px 4px 12px; z-index: 1100; max-width: 90vw; overflow-x: auto; gap: 10px; scrollbar-width: none;">
<!-- ▼ カメラアイコン付きテンプレ追加ここから -->
<img src="/static/camera.jpeg" onclick="document.getElementById('background-input').click()" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<!-- ▼ カメラアイコン付きテンプレ追加ここまで -->
  <img src="/static/haikei_1.jpeg" onclick="setBackground('/static/haikei_1.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_2.jpeg" onclick="setBackground('/static/haikei_2.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_3.jpeg" onclick="setBackground('/static/haikei_3.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_4.jpeg" onclick="setBackground('/static/haikei_4.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_5.jpeg" onclick="setBackground('/static/haikei_5.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_6.jpeg" onclick="setBackground('/static/haikei_6.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_7.jpeg" onclick="setBackground('/static/haikei_7.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_8.jpeg" onclick="setBackground('/static/haikei_8.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_9.jpeg" onclick="setBackground('/static/haikei_9.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_10.jpeg" onclick="setBackground('/static/haikei_10.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<!-- さらに追加してもOK！ -->

</div>

 </body></html>