<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ååˆºãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
  html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  font-family: 'Helvetica Neue', sans-serif;
  background: linear-gradient(180deg, #ffe4ec, #fff1f7);
  overflow: auto;
}



    body {
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  overflow-x: hidden; /* ğŸ‘ˆ æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¦æ­¢ï¼ */
  padding-bottom: 0px; 
}
    .main-wrapper {
      position: relative;
      min-height: 100vh;
      padding-bottom: 140px; /* ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã‚’è€ƒæ…® */
      box-sizing: border-box;
    }
    .card {
      width: 90%;
      max-width: 700px;
      margin: 30px auto;
      border: 2px solid #ccc;
      border-radius: 10px;
      background-color: white;
      overflow-y: auto;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
    }

   :root {
  --bar-color: #add8e6; /* æœ€åˆã¯æ°´è‰²ã¨ã‹ã§OK */
}

.header-bar {
  background-color: var(--bar-color);  /* â† background-imageã¯ä½¿ã‚ãªã„ */
  height: 40px;
}


    .student-id {
      display: flex;
      flex-direction: row;
      padding: 20px;
      gap: 20px;
    }

    .left-section {
      width: 40%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .left-section img {
      width: 125px;
      height: 125px;
      object-fit: cover;
      border-radius: 15px;
      cursor: pointer;
    }

    .info-section {
      width: 60%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      font-size: 14px;
      line-height: 1.6;
    }

    .editable-text {
      border: none;
      background: transparent;
      border-bottom: 1px solid #ccc;
      font-size: 14px;
      width: 100%;
    }
body {
  padding-bottom: 10px;
  box-sizing: border-box;
}

    .toolbar {
      position: fixed;
      bottom: 5px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 10px 16px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      display: flex;
      gap: 16px;
      z-index: 1000;
      align-items: center;
      
    }

    .toolbar img {
      width: 28spx;
      height: 28px;
      cursor: pointer;
    }

    .toolbar button {
      padding: 4px 12px;
      border: none;
      background: #eee;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }

        .hidden-input {
      opacity: 0;
      position: absolute;
      pointer-events: auto;
    }


    .sns-input {
      margin-left: 36px;
      margin-top: 8px;
      display: none;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 5px 10px;
      width: 220px;
      font-size: 14px;
    }

    .sns-wrapper {
      display: flex;
      flex-direction: column;
    }

    canvas {
      position: fixed;
      top: 0;
      left: 0;
      z-index: 800;
      display: none;
    }

  .text-sticker {
  position: absolute;
  border: none;
  outline: none;
  background: transparent;
  font-size: 16px;
  font-weight: bold;
  pointer-events: auto;
  /* color: black; â† å‰Šé™¤ã‹ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ãã ã•ã„ */
}

.sns-item {
  position: relative; /* ãƒœã‚¿ãƒ³ã‚’ä¸Šã«é‡ã­ã‚‹ãŸã‚ã«å¿…è¦ */
}

.sns-delete-btn {
  position: absolute;
  top: -8px;
  right: -8px;
  width: 18px;
  height: 18px;
  cursor: pointer;
  z-index: 10;
}
#bg-template-list::-webkit-scrollbar {
  display: none;
}
.youtube-section {
  margin-top: 10px;
  margin-bottom: 60px; /* â† è¿½åŠ ï¼ */
  text-align: center;
}
#youtube-url {
  width: 70%;
  max-width: 500px;
  padding: 5px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 14px;
  margin-top: 5px;
}
#youtube-player {
  margin: 0;
  padding: 0;
  line-height: 0;
}
iframe {
  width: 100%;
  height: 200px; /* â† aspect-ratioã¨ä½µç”¨ã›ãšæ˜ç¤ºæŒ‡å®šã§é«˜ã•å›ºå®š */
  border: none;
  margin: 0 auto;
  padding: 0;
}
body {
  box-sizing: border-box;
}
body {
  overscroll-behavior: contain; /* â† iOSã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è·³ã­è¿”ã‚Šã‚’æŠ‘åˆ¶ */
  padding-bottom: 80px;
}
#page-wrapper {
  position: relative;
  min-height: 100vh;
  overflow: visible;
}
#text-tools {
  display: none;
  position: fixed;
  bottom: 80px;
  left: 10px;
  background: #fff;
  padding: 10px 14px;
  border-radius: 12px;
  box-shadow: 0 0 8px rgba(0,0,0,0.1);
  z-index: 9999;
  font-family: 'Rounded Mplus 1c', 'Noto Sans JP', sans-serif;
  width: fit-content;       /* â† ä¸­èº«ã«åˆã‚ã›ã‚‹ */
  max-width: 100vw;         /* â† ã‚¹ãƒãƒ›ã§é£›ã³å‡ºã•ãªã„ã‚ˆã†ä¿é™º */
  box-sizing: border-box;
}

.tool-row {
  display: inline-flex;     /* â† æ¨ªã«è‡ªç„¶ãªå¹…ã ã‘ä½¿ã† */
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
}

.tool-label {
  font-weight: bold;
  font-size: 13px;
  color: #444;
  width: 50px;
}

.tool-input {
  flex: 1;
  font-size: 13px;
}

#text-color-picker {
  width: 30px;
  height: 30px;
  border: none;
  padding: 0;
  background: none;
}

 #edit-toggle.floating-eye {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 9999;
    width: 40px;
    height: 40px;
  }
  .sns-icon-bar {
  background-color: #ffffffcc;
  border-radius: 12px;
  padding: 8px 12px;
  display: flex;
  justify-content: space-around;
  align-items: center;
  margin: 20px auto;
  max-width: 300px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.sns-icon {
  width: 36px;
  height: 36px;
  border-radius: 10px;
  padding: 4px;
  cursor: pointer;
}
@keyframes glow-temporary {
  0% { box-shadow: 0 0 0px #00bfff; }
  20% { box-shadow: 0 0 10px #00bfff; }
  40% { box-shadow: 0 0 15px #00bfff; }
  60% { box-shadow: 0 0 10px #00bfff; }
  80% { box-shadow: 0 0 5px #00bfff; }
  100% { box-shadow: none; }
}

.glow-once {
  animation: glow-temporary 5s ease-in-out 1;
   border-bottom: 1px solid #ccc;
  border-radius: 8px;
}
.template-btn {
    font-size: 13px;
    padding: 5px 12px;
    border-radius: 10px;
    background-color: #f8f8ff;
    border: 1px solid #bbb;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
  }

  .template-btn:hover {
    background-color: #ffe066;
    transform: scale(1.05);
  }

  .fade-in {
    animation: fadeIn 0.4s ease-in-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  </style>
</head>
<body>
  <div id="page-wrapper">
  <div class="main-wrapper">
  <div class="card">
    <div class="header-bar"></div>
    <div class="student-id">
      <div class="left-section">
        <img id="profile-img" src="{{ image_data or '/static/profile_icon.jpeg' }}" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ">
        <input type="file" accept="image/*" id="profile-input" class="hidden-input">
      </div>
      <div class="info-section">
        <input type="text" class="editable-text glow-once" placeholder="åå‰">
        <input type="text" class="editable-text" placeholder="èª•ç”Ÿæ—¥">
        <input type="text" class="editable-text" placeholder="å¹´é½¢">
        <input type="text" class="editable-text" placeholder="å­¦éƒ¨:å­¦ç§‘">
        <input type="text" class="editable-text" placeholder="å‡ºèº«åœ°">
        <input type="text" class="editable-text" placeholder="è¶£å‘³">
      </div>
    </div>
  </div>
<!-- æ¨ªä¸¦ã³ã®SNSã‚¢ã‚¤ã‚³ãƒ³ãƒãƒ¼ -->
<div class="sns-icon-bar" style="
  width: 90vw;
  max-width: 500px;
  margin: 20px auto;
  display: flex;
  justify-content: space-around;
  align-items: center;
  padding: 10px 14px;
  border-radius: 14px;
  background-color: #ffffffcc;
  box-shadow: 0 2px 8px rgba(0,0,0,0.12);
  box-sizing: border-box;
">
  <img src="/static/instagram_icon.jpeg" alt="Instagram" class="sns-icon" onclick="handleIconClick('instagram')" style="width: 32px; height: 32px;">
  <img src="/static/Line.icon.jpeg" alt="LINE" class="sns-icon" onclick="handleIconClick('line')" style="width: 32px; height: 32px;">
  <img src="/static/BeReal.icon.jpeg" alt="BeReal" class="sns-icon" onclick="handleIconClick('bereal')" style="width: 32px; height: 32px;">
  <img src="/static/X_icon.jpeg" alt="X" class="sns-icon" onclick="handleIconClick('x')" style="width: 32px; height: 32px;">
  <img src="/static/tiktok_icon.jpeg" alt="TikTok" class="sns-icon" onclick="handleIconClick('tiktok')" style="width: 32px; height: 32px;">
</div>
<div id="sns-explain" style="
  font-size: 12.5px;
  color: #777;
  text-align: center;
  margin-top: 12px;
  margin-bottom: 16px;
  line-height: 1.6;
">
  ã‚¢ã‚¤ã‚³ãƒ³ã‚’æŠ¼ã™ã¨å…¬å¼ãƒšãƒ¼ã‚¸ã¸ï¼<br>
  URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã«ç™»éŒ²ã—ã‚ˆã†
</div>


<!-- å„SNSã®å…¥åŠ›æ¬„ï¼ˆéè¡¨ç¤ºï¼‰ -->
<div class="sns-inputs">
  <input id="input-instagram" class="sns-input" placeholder="https://www.instagram.com/yourid" onblur="handleBlur('instagram')">
  <input id="input-line" class="sns-input" placeholder="https://lin.ee/yourid" onblur="handleBlur('line')">
  <input id="input-bereal" class="sns-input" placeholder="https://bere.al/yourid" onblur="handleBlur('bereal')">
  <input id="input-x" class="sns-input" placeholder="https://twitter.com/yourid" onblur="handleBlur('x')">
  <input id="input-tiktok" class="sns-input" placeholder="https://www.tiktok.com/@yourid" onblur="handleBlur('tiktok')">
</div>


<!-- â–¼ è‡ªç”±è¨˜å…¥æ¬„ï¼ˆãƒãƒ„ä»˜ãï¼‰ -->
<div id="extra-text-wrapper" class="sns-wrapper" style="margin-top: 20px; position: relative;">
  <img src="/static/batu.jpeg" alt="å‰Šé™¤" class="sns-delete-btn" onclick="hideExtraText()" style="
    position: absolute;
    top: -3px;
    right: 18px;
    width: 18px;
    height: 18px;
    cursor: pointer;
    z-index: 10;
  ">
  <textarea id="extra-text" class="editable-text" placeholder="è¨˜å…¥æ¬„" style="
    margin-top: 10px;
    margin-left: 20px;
    padding: 14px 18px;
    border-radius: 14px;
    border: 1px solid #ccc;
    width: 90vw;
    max-width: 650px;
    height: 160px;
    font-size: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.12);
    resize: none;
    line-height: 1.6;
    background-color: #fff;
    box-sizing: border-box;
  "></textarea>
</div>

<!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæŒ¿å…¥ãƒœã‚¿ãƒ³ -->
<div class="deletable-templates" style="text-align: center; margin-top: 13px;">
  <button onclick="showTemplateButtons()" style="
    font-size: 14px;
    padding: 6px 14px;
    border-radius: 8px;
    border: none;
    background: rgb(255, 224, 136); 
    color: #333;
    font-weight: bold;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: background-color 0.2s ease;
  ">âœï¸ è¨˜å…¥æ¬„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</button>
</div>


<!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé …ç›®ãƒœã‚¿ãƒ³ï¼ˆæ¨ªä¸¦ã³ï¼‰ -->
<div id="template-buttons" style="
  margin: 12px auto 0;
  display: none;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
  max-width: 90%;
">
  <button onclick="insertTemplate('club')" class="template-btn">éƒ¨æ´»</button>
  <button onclick="insertTemplate('study')" class="template-btn">å­¦æ¥­</button>
  <button onclick="insertTemplate('circle')" class="template-btn">ã‚µãƒ¼ã‚¯ãƒ«</button>
  <button onclick="insertTemplate('parttime')" class="template-btn">ãƒã‚¤ãƒˆ</button>
  <button onclick="insertTemplate('hobby')" class="template-btn">è¶£å‘³</button>
</div>


<!-- â–¼ YouTubeå…¥åŠ›æ¬„ -->
<div class="youtube-section" style="position: relative; margin-top: 20px;">
  <img src="/static/batu.jpeg" alt="å‰Šé™¤" class="sns-delete-btn" onclick="hideYouTubeSection()" style="
    position: absolute;
    top: 13px;
    right: 20px;
    width: 18px;
    height: 18px;
    cursor: pointer;
    z-index: 10;
  ">

  <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
  <div id="youtube-player" style="padding: 0; text-align: center;"></div>
<!-- â–¼ YouTubeè¦‹å‡ºã—ï¼ˆãƒªãƒ³ã‚¯åŒ–ï¼‹èµ¤ï¼‰ -->
<div style="font-weight: bold; font-size: 14px; margin-bottom: 6px; text-align: left; padding-left: 5vw;text-decoration: underline; /* âœ… è¦‹ãŸç›®ã§ã€Œãƒªãƒ³ã‚¯ã«ãªã‚‹æ„Ÿã€å‡ºã™ */">
  <a href="https://www.youtube.com" target="_blank" style="color: red; text-decoration: none;">
    YouTube URL
  </a><br>
  <span style="font-size: 12px; color: #555;"></span>
</div>

  <!-- å…¥åŠ›æ¬„ -->
  <input type="text" id="youtube-url" placeholder="YoutubeURLã‚’å…¥åŠ›"
    style="
      width: 90vw;
      max-width: 650px;
      padding: 14px 18px;
      border: 1px solid #ccc;
      border-radius: 14px;
      font-size: 16px;
      display: block;
      margin: 0 auto 12px auto;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
      box-sizing: border-box;
      
    ">

  <!-- ä¸­å¤®å¯„ã›ãƒœã‚¿ãƒ³ -->
  <button onclick="embedYouTubeVideo()" style="
    display: block;
    margin: 0 auto 10px auto;
    padding: 10px 20px;
    font-size: 15px;
    border-radius: 10px;
    background: rgb(255, 224, 136); 
    color: black;
border: none;
box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  ">
    åæ˜ 
  </button>
</div>

<!-- â–¼ SpotifyåŸ‹ã‚è¾¼ã¿æ¬„ -->
<div id="spotify-section" class="spotify-section" style="position: relative; margin-top: -40px;">
  <!-- âœ• ãƒœã‚¿ãƒ³ -->
  <img src="/static/batu.jpeg" alt="å‰Šé™¤" class="sns-delete-btn" onclick="hideSpotifySection()" style="
    position: absolute;
    top: 30px;
    right: 20px;
    width: 18px;
    height: 18px;
    cursor: pointer;
    z-index: 10;
  ">

  <!-- åŸ‹ã‚è¾¼ã¿ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å…ˆã« -->
  <div id="spotify-player" style="padding: 0; text-align: center;"></div>

<!-- â–¼ Spotifyè¦‹å‡ºã—ï¼ˆãƒªãƒ³ã‚¯åŒ–ï¼‹ç·‘ï¼‹ä¸‹ç·šï¼‰ -->
<div style="font-weight: bold; font-size: 14px; margin-bottom: 6px; text-align: left; padding-left: 5vw;">
  <a href="https://open.spotify.com" target="_blank" style="color: green; text-decoration: underline;">
    Spotify URL
  </a><br>
  <span style="font-size: 12px; color: #555;">ï¼ˆæ¥½æ›²/ã‚¢ãƒ«ãƒãƒ /ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆï¼‰</span>
</div>


  <!-- å…¥åŠ›æ¬„ -->
  <input type="text" id="spotify-url" placeholder="Spotifyã®URLã‚’å…¥åŠ›"
    style="
      width: 90vw;
      max-width: 650px;
      padding: 14px 18px;
      border: 1px solid #ccc;
      border-radius: 14px;
      font-size: 16px;
      display: block;
      margin: 0 auto 12px auto;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
      box-sizing: border-box;
    ">

  <!-- åæ˜ ãƒœã‚¿ãƒ³ï¼ˆä¸­å¤® & è‡ªå·±PRã®ãƒœã‚¿ãƒ³ã¨æƒãˆã‚‹ï¼‰ -->
<button onclick="embedSpotify()" style="
  display: block;
  margin: 0 auto 10px auto;
  padding: 10px 20px;
  font-size: 15px;
  border-radius: 10px;
  background: rgb(255, 224, 136); /* ã‚µãƒ–1ã®é»„è‰² */
  color: black;
  border: none;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
">
  åæ˜ 
</button>




  <canvas id="draw-canvas"></canvas>
  <input type="file" id="background-input" class="hidden-input" accept="image/*" onchange="loadBackgroundImage(event)">
  <input type="color" id="color-picker" class="hidden-input" onchange="changeBarColor(event)">
<button id="finish-button" style="
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: #eee;
  border: none;
  padding: 6px 16px;
  font-size: 16px;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  z-index: 1001;
  cursor: pointer;
  display: none;
">
  ä½œæˆ
</button>
 <div class="toolbar" id="toolbar">
    <img src="/static/upload.jpeg" onclick="toggleBackgroundList()">
    <img src="/static/pen_off.jpeg" onclick="toggleTextMode()" id="text-toggle-icon">
    <div style="position: relative; width: 28px; height: 28px;">
  <img src="/static/student.jpeg" style="width: 100%; height: 100%; cursor: pointer;">
  <input type="color" id="color-picker"
         style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                opacity: 0; cursor: pointer;"
         onchange="changeBarColor(event)">
</div>
<img src="/static/restore.jpeg" onclick="restoreSNS()" style="width: 28px; height: 28px; cursor: pointer;">
<!-- ãƒ„ãƒ¼ãƒ«ãƒãƒ¼å†…ã®ç¢ºèªãƒœã‚¿ãƒ³ã®å·¦ã‚ãŸã‚Šã«è¿½åŠ  -->
 <img id="edit-toggle" src="/static/open_eye.jpeg" style="width: 28px; height: 28px; cursor: pointer;" alt="ç·¨é›†åˆ‡æ›¿">
    <button onclick="togglePreview()" id="check-button">ç¢ºèª</button>
  </div>
  <img id="return-toggle" src="/static/closed_eye.jpeg"
     style="width: 50px; height: 50px; position: fixed; bottom: 20px; right: 20px;
            cursor: pointer; display: none; z-index: 9999;
            border-radius: 50%; background: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
            animation: pulse 2s infinite;" alt="æˆ»ã‚‹">

  <script>
    const urls = { instagram: '', x: '', tiktok: '' };
    const canvas = document.getElementById('draw-canvas');
    const ctx = canvas.getContext('2d');
  function togglePreview() {
  const toolbar = document.getElementById('toolbar');
  const finalBtn = document.getElementById('finish-button');

  toolbar.style.display = 'none';
  finalBtn.style.display = 'block';
}
 let drawing = false, drawEnabled = false;
let paths = [], currentPath = [];

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  redraw();
}

window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function redraw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.strokeStyle = '#000';
  ctx.lineWidth = 2;
  for (const path of paths) {
    ctx.beginPath();
    path.forEach(([x, y], i) => i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y));
    ctx.stroke();
  }
  if (currentPath.length) {
    ctx.beginPath();
    currentPath.forEach(([x, y], i) => i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y));
    ctx.stroke();
  }
}

canvas.addEventListener('mousedown', e => {
  if (!drawEnabled) return;
  drawing = true;
  currentPath = [[e.offsetX, e.offsetY]];
});

canvas.addEventListener('mousemove', e => {
  if (!drawing || !drawEnabled) return;
  currentPath.push([e.offsetX, e.offsetY]);
  redraw();
});

canvas.addEventListener('mouseup', () => {
  if (!drawing || !drawEnabled) return;
  drawing = false;
  paths.push(currentPath);
  currentPath = [];
});

function toggleTextMode() {
  drawEnabled = !drawEnabled;
  canvas.style.display = drawEnabled ? 'block' : 'none';
  const icon = document.getElementById('text-toggle-icon');
  icon.src = drawEnabled ? '/static/pen_on.jpeg' : '/static/pen_off.jpeg';
}

function loadBackgroundImage(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    document.body.style.backgroundImage = `url('${reader.result}')`;
  };
  reader.readAsDataURL(file);
}

function changeBarColor(e) {
  document.documentElement.style.setProperty('--bar-color', e.target.value);
}

const iconClickState = {};

function handleIconClick(service) {
  const input = document.getElementById(`input-${service}`);
  if (!input) return;

  const url = input.value.trim();
  const defaultLinks = {
    instagram: "https://www.instagram.com",
    line: "https://line.me",
    bereal: "https://bere.al",
    x: "https://twitter.com",
    tiktok: "https://www.tiktok.com"
  };

  // åˆå›ãªã‚‰å…¬å¼ã¸ã€2å›ç›®ä»¥é™ã¯å…¥åŠ›
  if (!iconClickState[service]) {
    iconClickState[service] = true;
    window.open(defaultLinks[service], '_blank');
  } else {
    input.style.display = "block";
    input.focus();
  }
}



function handleBlur(service) {
  const input = document.getElementById(`input-${service}`);
  const value = input.value.trim();
  if (value) urls[service] = value;
  input.style.display = 'none';
}

function downloadCard() {
  alert("ã“ã®éƒ¨åˆ†ã§ç”»åƒåŒ–ï¼†ZIPåŒ–ãªã©ã®å‡¦ç†ã‚’è¡Œã„ã¾ã™");
}

window.onload = () => {
  canvas.style.display = 'none';
  const profileImg = document.getElementById("profile-img");
  const profileInput = document.getElementById("profile-input");

  profileImg.addEventListener("click", () => {
    profileInput.click();
  });

  profileInput.addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
      profileImg.src = reader.result;
    };
    fetch('/upload_profile_image', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ image: reader.result })
    })
    .then(response => response.json())
    .then(data => {
      console.log('ä¿å­˜æˆåŠŸ:', data);
    })
    .catch(error => {
      console.error('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—:', error);
    });

    reader.readAsDataURL(file);
  });
};

let textEnabled = false;
let textFirstTapDone = false;

document.getElementById("text-toggle-icon").addEventListener("click", () => {
  textEnabled = !textEnabled;
  textFirstTapDone = false;

  const toolsPanel = document.getElementById("text-tools");
  toolsPanel.style.display = textEnabled ? "block" : "none";

  const icon = document.getElementById("text-toggle-icon");
  icon.src = textEnabled ? "/static/pen_on.jpeg" : "/static/pen_off.jpeg";
});

document.body.addEventListener("click", (e) => {
  if (!textEnabled) return;

  if (!textFirstTapDone) {
    textFirstTapDone = true;
    return;
  }

  if (e.target.tagName === "INPUT" || e.target.tagName === "TEXTAREA" || e.target.tagName === "SELECT") return;

  const margin = 20;
  const inputWidth = 150;
  const maxX = window.innerWidth - inputWidth - margin;
  const x = Math.min(e.pageX, maxX);
  const y = e.pageY;

  const input = document.createElement("input");
  input.type = "text";
  input.placeholder = "ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›";
  input.className = "text-sticker";
  input.style.position = "absolute";
  input.style.left = `${x}px`;
  input.style.top = `${y}px`;
  input.style.width = '150px';
  input.style.maxWidth = 'calc(100vw - 40px)';

  const textColorPicker = document.getElementById("text-color-picker");
  const fontSelector = document.getElementById("font-selector");
  const fontSizeSlider = document.getElementById("font-size-slider");

  if (textColorPicker) input.style.setProperty('color', textColorPicker.value, 'important');
  if (fontSelector) input.style.fontFamily = fontSelector.value;
  if (fontSizeSlider) input.style.fontSize = fontSizeSlider.value + "px";

  const container = document.getElementById('page-wrapper');
  container.appendChild(input);

  input.addEventListener("blur", () => {
    if (input.value.trim() === "") {
      input.remove();
    }
  });
  input.focus();

  let offsetX, offsetY, dragging = false;

  input.addEventListener("mousedown", (ev) => {
    dragging = true;
    offsetX = ev.offsetX;
    offsetY = ev.offsetY;
  });

  document.addEventListener("mousemove", (ev) => {
    if (!dragging) return;
    input.style.left = `${ev.pageX - offsetX}px`;
    input.style.top = `${ev.pageY - offsetY}px`;
  });

  document.addEventListener("mouseup", () => {
    dragging = false;
  });

  let longPressTimer;
  input.addEventListener("touchstart", () => {
    longPressTimer = setTimeout(() => {
      input.remove();
    }, 1000);
  });

  input.addEventListener("touchend", () => {
    clearTimeout(longPressTimer);
  });
});

// âœ… ãƒ†ã‚­ã‚¹ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åæ˜ 
const textColorPicker = document.getElementById("text-color-picker");
const fontSelector = document.getElementById("font-selector");
const fontSizeSlider = document.getElementById("font-size-slider");

function applyTextStyles() {
  document.querySelectorAll(".text-sticker").forEach(input => {
    if (textColorPicker) input.style.color = textColorPicker.value;
    if (fontSelector) input.style.fontFamily = fontSelector.value;
    if (fontSizeSlider) input.style.fontSize = fontSizeSlider.value + "px";
  });
}
if (textColorPicker) textColorPicker.addEventListener("input", applyTextStyles);
if (fontSelector) fontSelector.addEventListener("change", applyTextStyles);
if (fontSizeSlider) fontSizeSlider.addEventListener("input", applyTextStyles);


function toggleBackgroundList() {
  const list = document.getElementById('bg-template-list');
  list.style.display = (list.style.display === 'none' || list.style.display === '') ? 'flex' : 'none';
}

function setBackground(url) {
  document.body.style.backgroundImage = `url('${url}')`;
  document.getElementById('bg-template-list').style.display = 'none';
}
function hideAddLink(event) {
  event.stopPropagation(); // ã€ŒshowHiddenSNS()ã€ãŒå‹•ã‹ãªã„ã‚ˆã†ã«
  const addBtn = document.getElementById('add-link-button');
  if (addBtn) addBtn.style.display = 'none';
}function restoreSNS() {
 ['instagram', 'line', 'bereal', 'x', 'tiktok'].forEach(service => {
    const wrapper = document.querySelector(`.sns-wrapper:has(#input-${service})`);
    if (wrapper) wrapper.style.display = 'flex';
  });

  const addBtn = document.getElementById('add-link-button');
  if (addBtn) addBtn.style.display = 'flex';
  const extraTextWrapper = document.getElementById('extra-text-wrapper');
  if (extraTextWrapper) extraTextWrapper.style.display = 'block';
  const youtubeSection = document.querySelector('.youtube-section');
  if (youtubeSection) youtubeSection.style.display = 'block';
  const diagnosisWrapper = document.getElementById("diagnosis-wrapper");
  if (diagnosisWrapper) diagnosisWrapper.style.display = "block";
  const spotifySection = document.getElementById('spotify-section');
  if (spotifySection) spotifySection.style.display = 'block';
  const selfPR = document.getElementById('self-pr-section');
  if (selfPR) selfPR.style.display = 'block';
}
function hideExtraText() {
  const wrapper = document.getElementById('extra-text-wrapper');
  if (wrapper) wrapper.style.display = 'none';
}
function hideDiagnosisButton() {
  const diagnosisWrapper = document.getElementById("diagnosis-wrapper");
  if (diagnosisWrapper) diagnosisWrapper.style.display = "none";
}

function restoreDiagnosisButton() {
  const diagnosisWrapper = document.getElementById("diagnosis-wrapper");
  if (diagnosisWrapper) diagnosisWrapper.style.display = "block";
}

function hideSpotifySection() {
  const section = document.getElementById('spotify-section');
   if (section) {
    section.style.display = 'block';
  }
}
function restoreSpotifySection() {
  const section = document.getElementById('spotify-section');
  if (section) section.style.display = 'block';
}
function hideSelfPRSection() {
  const section = document.getElementById('self-pr-section');
  if (section) section.style.display = 'none';
}

function restoreSelfPRSection() {
  const section = document.getElementById('self-pr-section');
  if (section) section.style.display = 'block';
}

document.getElementById('finish-button').addEventListener('click', async () => {
  const finishBtn = document.getElementById('finish-button');
 const checkbox = document.getElementById('agree-checkbox');
if (!checkbox.checked) {
showCuteAlert('åˆ©ç”¨è¦ç´„ã«åŒæ„ã—ã¦ãã ã•ã„ã€‚');
  document.getElementById('terms-modal').style.display = 'flex';
  return;
}
  finishBtn.disabled = true;
  finishBtn.textContent = 'ç”Ÿæˆä¸­...';
  await compressAllImagesBeforeSend(); 
  document.querySelectorAll('#background-list img').forEach(img => {
  img.remove();
});
// å…¥åŠ›å€¤ã‚’è¡¨ç¤ºç”¨ã®è¦ç´ ã«åæ˜ 
// å…¥åŠ›å€¤ã‚’è¡¨ç¤ºã‚¨ãƒªã‚¢ã«åæ˜ ã™ã‚‹ï¼ˆå®Œæˆå‰ã«å¿…è¦ï¼ï¼‰
// å…¥åŠ›å€¤ã‚’ value å±æ€§ã«åæ˜ ï¼ˆFirebaseã«åæ˜ ã•ã‚Œã‚‹ã‚ˆã†ã«ï¼‰
function escapeHTML(str) {
  return str.replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#39;");
}

const editableTexts = document.querySelectorAll('.editable-text, textarea');
editableTexts.forEach(input => {
  const val = input.value.trim();
  input.setAttribute('value', escapeHTML(val));
  if (input.tagName === 'TEXTAREA') {
    input.textContent = escapeHTML(val);
  }
});

editableTexts.forEach((input) => {
  input.setAttribute('value', input.value.trim());
});

// è¨˜å…¥æ¬„ï¼ˆtextareaï¼‰ã®å€¤ã‚’ value ã«åæ˜ 
const extraInput = document.getElementById('extra-text');
if (extraInput) {
  const text = extraInput.value.trim();
  extraInput.setAttribute('value', text);

  let hidden = document.getElementById('hidden-extra-text');
  if (!hidden) {
    hidden = document.createElement('input');
    hidden.type = 'hidden';
    hidden.id = 'hidden-extra-text';
    hidden.name = 'extra-text';
    extraInput.parentNode.appendChild(hidden); // âœ… ä¿®æ­£ï¼
  }
  hidden.value = text;
   extraInput.textContent = text;
}

  const toolbar = document.getElementById('toolbar');
  if (toolbar) toolbar.style.display = 'none';


  const youtubeBatsu = document.querySelector('.youtube-section .sns-delete-btn');
  if (youtubeBatsu) youtubeBatsu.style.display = 'none';
  // âœ… YouTubeå…¥åŠ›æ¬„ã¨åæ˜ ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã«ã™ã‚‹
const youtubeInput = document.getElementById('youtube-url');
const youtubeButton = document.querySelector('.youtube-section button');
if (youtubeInput) youtubeInput.style.display = 'none';
if (youtubeButton) youtubeButton.style.display = 'none';
// âœ… Spotifyå…¥åŠ›æ¬„ã¨åæ˜ ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã«ã™ã‚‹
const spotifyInput = document.getElementById('spotify-url');
const spotifyButton = document.querySelector('#spotify-section button');
if (spotifyInput) spotifyInput.style.display = 'none';
if (spotifyButton) spotifyButton.style.display = 'none';
const templateButton = document.querySelector('.deletable-templates');
if (templateButton) templateButton.style.display = 'none';
const selfPRTemplateButton = document.querySelector('.self-pr-template-section');
if (selfPRTemplateButton) selfPRTemplateButton.style.display = 'none';


  const extraBatsu = document.querySelector('#extra-text-wrapper .sns-delete-btn');
  if (extraBatsu) extraBatsu.style.display = 'none';
  const diagnosisBatsu = document.querySelector('#diagnosis-wrapper .sns-delete-btn');
  if (diagnosisBatsu) diagnosisBatsu.style.display = 'none';
  const externalBatsu = document.querySelector('#external-link-section .sns-delete-btn');
  if (externalBatsu) externalBatsu.style.display = 'none';
  const spotifyBatsu = document.querySelector('#spotify-section .sns-delete-btn');
  if (spotifyBatsu) spotifyBatsu.style.display = 'none';
  const selfPRBatsu = document.querySelector('#self-pr-section .sns-delete-btn');
  if (selfPRBatsu) selfPRBatsu.style.display = 'none';
  const snsExplain = document.getElementById('sns-explain');
  if (snsExplain) snsExplain.style.display = 'none';

 ['instagram', 'line', 'bereal', 'x', 'tiktok'].forEach(service => {
  const url = urls[service];
  if (url) {
    const icon = document.querySelector(`.sns-icon-bar img[onclick*="${service}"]`);
    if (icon) {
      const linkWrapper = document.createElement('a');
      linkWrapper.href = url;
      linkWrapper.target = '_blank';
      linkWrapper.appendChild(icon.cloneNode(true));
      icon.replaceWith(linkWrapper);
    }
  }
});

  // âœ… ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒãŒ blob: ã ã£ãŸã‚‰ä¿å­˜æ¸ˆã¿ã®URLã«æ›¸ãæ›ãˆã‚‹
  const profileImg = document.getElementById("profile-img");
  if (profileImg && profileImg.src.startsWith("blob:")) {
    profileImg.src = "/static/uploads/profile.jpeg";
  }
  if (profileImg && profileImg.src.startsWith("data:image/")) {
    profileImg.src = await compressImage(profileImg.src);
  }
    finishBtn.style.display = 'none';

    const html = document.documentElement.outerHTML;

  // âœ… base64ç”»åƒã®ã†ã¡ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã¨ãƒ‡ã‚³ç”»åƒã ã‘ã¯å‰Šé™¤å¯¾è±¡ã‹ã‚‰é™¤å¤–ï¼
  const cleanedHTML = html.replace(/<img[^>]+src="data:image\/[^"]+"[^>]*>/g, (match) => {
    if (match.includes('id="profile-img"') || match.includes('class="deco-img"')) {
      return match; // â†’ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ or ãƒ‡ã‚³ç”»åƒã¯ãã®ã¾ã¾æ®‹ã™
    } else {
      return match.replace(/src="data:image\/[^"]+"/, 'src="/static/deleted_image.jpeg"');
    }
  });

  const formData = new FormData();
  formData.append('html', cleanedHTML);

  const res = await fetch('/generate_url', {
    method: 'POST',
    body: formData
  });

  const data = await res.json();
  if (data.url) {
    finishBtn.textContent = 'ç”Ÿæˆå®Œäº†';
    finishBtn.style.display = 'block';

    const output = document.createElement('div');
    output.id = 'shared-url-box';
    output.innerHTML = `<p>ã“ã®URLã‚’å…±æœ‰ã§ãã¾ã™ğŸ‘‡</p><a href="${data.url}" target="_blank">${data.url}</a>`;
    output.style.cssText = `...`; // ã‚¹ã‚¿ã‚¤ãƒ«çœç•¥å¯
    document.body.appendChild(output);

    setTimeout(() => {
      const box = document.getElementById('shared-url-box');
      if (box) box.remove();
    }, 600000);
  } else {
    alert('URLã®ç™ºè¡Œã«å¤±æ•—ã—ã¾ã—ãŸ');
    finishBtn.disabled = false;
    finishBtn.textContent = 'å®Œæˆ';
    finishBtn.style.display = 'block';
  }
});

function embedYouTubeVideo() {
  const input = document.getElementById('youtube-url');
  const player = document.getElementById('youtube-player');
  let url = input.value.trim();

  // m.youtube â†’ www.youtube ã«å¤‰æ›
  url = url.replace("m.youtube.com", "www.youtube.com");

  const match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/);
  if (match && match[1]) {
    const videoId = match[1];
    player.innerHTML = `
      <div style="
        border-radius: 18px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.12);
        max-width: 90vw;
        margin: 0 auto 12px auto;
      ">
        <iframe width="100%" height="200" 
          src="https://www.youtube.com/embed/${videoId}" 
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
          allowfullscreen>
        </iframe>
      </div>
    `;
  } else {
    player.innerHTML = "<p style='color:red;'>æ­£ã—ã„YouTubeã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>";
  }
}

function embedSpotify() {
  const url = document.getElementById("spotify-url").value.trim();

  if (!url.includes("open.spotify.com")) {
    alert("Spotifyã®æ­£ã—ã„URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
    return;
  }

  try {
    const parsed = new URL(url);
    const cleanPath = parsed.pathname.replace('/intl-ja', '');  // â† ã“ã“ã§å–ã‚Šé™¤ã
    const embedUrl = "https://open.spotify.com/embed" + cleanPath;

    const iframe = `
      <iframe src="${embedUrl}" 
        style="width: calc(100% - 40px); height: 152px; border-radius:12px; display: block; margin: 0 auto;" 
        frameborder="0" allowtransparency="true" allow="encrypted-media">
      </iframe>
    `;
    document.getElementById("spotify-player").innerHTML = iframe;
  } catch {
    alert("URLã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚");
  }
}
function showTemplateButtons() {
  const btns = document.getElementById('template-buttons');
  btns.style.display = 'flex';
}
function insertTemplate(type) {
  const textarea = document.getElementById("extra-text");
  let template = "";

  switch(type) {
  case 'club':
    template = "é«˜æ ¡ã®ã¨ãã¯ã€‡ã€‡éƒ¨ã‚„ã£ã¦ã¦ã€æ”¾èª²å¾Œã¯ã ã„ãŸã„éƒ¨æ´»ã«ã„ãŸã‹ã‚‚ã€‚ã¾ã‚ã¾ã‚ã‚¬ãƒã§ã‚„ã£ã¦ãŸã‹ã‚‰ã€ä½“åŠ›ã¨ã‹æ°—åˆã„ã¯ãã‚Œãªã‚Šã«ã‚ã‚‹â€¦ã¯ãšï¼å…ˆè¼©å¾Œè¼©ã¨ã®ãƒãƒªã¨ã‹ã€åœ°å‘³ã«ã‚³ãƒŸãƒ¥åŠ›é›ãˆã‚‰ã‚ŒãŸæ°—ã‚‚ã™ã‚‹ç¬‘";
    break;

  case 'study':
    template = "ã€‡ã€‡ç³»ã‚’å‹‰å¼·ã—ã¦ã‚‹ã‘ã©ã€å†…å®¹ã¯ã‚ã‚Šã¨ãƒ‹ãƒƒãƒã§ãŠã‚‚ã—ã‚ã„ã‹ã‚‚ã€‚èª²é¡Œã¯ã‚¨ã‚°ã„æ™‚ã‚ã‚‹ã‘ã©ã€ç· åˆ‡ã«ã¯ä¸€å¿œã¡ã‚ƒã‚“ã¨é–“ã«åˆã‚ã›ã¦ã‚‹ç¬‘ã‚ã‚Šã¨è¨ˆç”»ç«‹ã¦ã¦ã‚³ãƒ„ã‚³ãƒ„ã‚„ã‚‹ã‚¿ã‚¤ãƒ—ã§ã™ã€å¤šåˆ†ã€‚";
    break;

  case 'circle':
    template = "ã€‡ã€‡ç³»ã®ã‚µãƒ¼ã‚¯ãƒ«å…¥ã£ã¦ã¦ã€ã‚¤ãƒ™ãƒ³ãƒˆã¨ã‹ã§é¨’ã„ã§ã‚‹ã“ã¨å¤šã„ã‹ã‚‚ã€‚é£²ã¿ã¨ã‹åˆå®¿ã¨ã‹ã€ã‚¨ãƒ¢ã„æ€ã„å‡ºã„ã‚ã„ã‚ã§ãã¦ã‚‹ï¼ã‚¬ãƒã‚ˆã‚Šã‚¨ãƒ³ã‚¸ãƒ§ã‚¤æ´¾ã ã‘ã©ã€äººã¨é–¢ã‚ã‚‹ã®ã¯ã‚ã‚Šã¨å¥½ãã€‚";
    break;

  case 'parttime':
    template = "ã€‡ã€‡ã®ãƒã‚¤ãƒˆã—ã¦ã‚‹ã‚“ã ã‘ã©ã€æ¥å®¢ã¨ã‹æ…£ã‚Œã‚‹ã¨æ„å¤–ã¨æ¥½ã—ã„ã€‚æœ€åˆã¯ç·Šå¼µã—ã¦ãŸã‘ã©ã€ä»Šã¯ãŠå®¢ã•ã‚“ã¨è»½ãé›‘è«‡ã¨ã‹ã‚‚ã—ã¦ã‚‹ç¬‘è²¬ä»»ã¨ã‹æ™‚é–“ã¨ã‹ã€ã¡ã‚‡ã£ã¨ã¯å¤§äººã«ãªã£ãŸæ°—ãŒã™ã‚‹ã€‚";
    break;

  case 'hobby':
    template = "ã€‡ã€‡ãŒè¶£å‘³ã§ã€ã‚¹ã‚­ã‚ã‚‰ã°ã‚„ã£ã¦ã‚‹ã‹ã‚‚ã€‚ã²ã¨ã‚Šã®æ™‚é–“ã«ãƒãƒã‚Œã‚‹ã®ãŒæœ€é«˜ãªã‚“ã‚ˆã€œï¼åŒã˜è¶£å‘³ã®äººã¨è©±ã›ãŸã‚‰ã‚ã£ã¡ã‚ƒç››ã‚Šä¸ŠãŒã‚‹ã‚¿ã‚¤ãƒ—ã€‚ãŸã¶ã‚“ã€ã‚ã£ã¡ã‚ƒèªã‚‹ç¬‘";
    break;
}


  textarea.value = template + '\n\nâ¸»\n\n'; // â† ä¸Šæ›¸ãï¼ˆå…¥ã‚Œæ›¿ãˆï¼‰
}
const textarea = document.getElementById("your-textarea-id"); // â†å®Ÿéš›ã®textareaã®IDã«ç½®ãæ›ãˆã¦ï¼
textarea.classList.remove("fade-in");
void textarea.offsetWidth; // â†å†ã‚¢ãƒ‹ãƒ¡ç”¨ã®ãƒˆãƒªãƒƒã‚¯
textarea.classList.add("fade-in");
function showTemplateButtons() {
  const btns = document.getElementById('template-buttons');
  if (btns.style.display === 'flex') {
    btns.style.display = 'none';
  } else {
    btns.style.display = 'flex';
  }
}
function showPRTemplateButtons() {
  const btnArea = document.getElementById('pr-template-buttons');
  btnArea.style.display = btnArea.style.display === 'flex' ? 'none' : 'flex';
}

function showPRTemplateButtons() {
  const btnArea = document.getElementById('pr-template-buttons');
  btnArea.style.display = btnArea.style.display === 'flex' ? 'none' : 'flex';
}

function insertPRTemplate(category) {
  const prTemplates = {
  study: "å‹‰å¼·ã§ã¯ã€‡ã€‡ã«ç‰¹ã«åŠ›ã‚’å…¥ã‚Œã¦ãã¾ã—ãŸã€‚æ—¥ã€…ã®ç©ã¿é‡ã­ã¨è¨ˆç”»çš„ãªå–ã‚Šçµ„ã¿ã§ã€çŸ¥è­˜ã ã‘ã§ãªãè€ƒãˆã‚‹åŠ›ã‚‚ä¼¸ã°ã›ãŸã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚ç‰¹ã«â–³â–³ã§ã¯è‹¦æ‰‹ãªåˆ†é‡ã‚‚é€ƒã’ãšã«å‘ãåˆã„ã€è‡ªåˆ†ãªã‚Šã®å·¥å¤«ã§ä¹—ã‚Šè¶Šãˆã¦ãã¾ã—ãŸã€‚",
  
  sports: "å­¦ç”Ÿæ™‚ä»£ã¯ã€‡ã€‡éƒ¨ã«æ‰€å±ã—ã¦ãŠã‚Šã€ç·´ç¿’ã‚’é€šã˜ã¦ä½“åŠ›ã ã‘ã§ãªãé›†ä¸­åŠ›ã‚„ç¤¼å„€ã‚‚èº«ã«ã¤ã‘ã¾ã—ãŸã€‚ä»²é–“ã¨æ”¯ãˆåˆã†çµŒé¨“ã‚‚å¤§ããªè²¡ç”£ã§ã™ã€‚è©¦åˆã‚„å¤§ä¼šã§ã¯è‡ªåˆ†ã®å½¹å‰²ã‚’æœãŸã™ã“ã¨ã«ã“ã ã‚ã‚Šã€å‹ã¡è² ã‘ä»¥ä¸Šã«ãƒãƒ¼ãƒ ã§å–ã‚Šçµ„ã‚€ã“ã¨ã®å¤§åˆ‡ã•ã‚’å®Ÿæ„Ÿã—ã¾ã—ãŸã€‚",
  
  communication: "äººã¨è©±ã™ã“ã¨ãŒå¥½ãã§ã€ã€‡ã€‡ã§ã¯å‘¨å›²ã¨å”åŠ›ã—ãªãŒã‚‰é€²ã‚ã‚‹ã“ã¨ãŒå¤šãã€è‡ªç„¶ã¨ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³åŠ›ãŒé›ãˆã‚‰ã‚ŒãŸã¨æ€ã„ã¾ã™ã€‚ç›¸æ‰‹ã®ç«‹å ´ã‚„æ°—æŒã¡ã‚’è€ƒãˆãªãŒã‚‰æ¥ã™ã‚‹ã‚ˆã†å¿ƒãŒã‘ã¦ã„ã¾ã™ã€‚å ´ã®é›°å›²æ°—ã‚’èª­ã¿å–ã‚Šã¤ã¤ã€è‡ªåˆ†ã®æ„è¦‹ã‚‚ã—ã£ã‹ã‚Šä¼ãˆã‚‹ãƒãƒ©ãƒ³ã‚¹ã‚’å¤§åˆ‡ã«ã—ã¦ã„ã¾ã™ã€‚",
  
  creativity: "ã€‡ã€‡ã®æ´»å‹•ã‚’é€šã˜ã¦ã€ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å‡ºã—ã¦å½¢ã«ã™ã‚‹é¢ç™½ã•ã‚’å­¦ã³ã¾ã—ãŸã€‚è‡ªç”±ãªç™ºæƒ³ã¨å·¥å¤«ã™ã‚‹åŠ›ãŒè‡ªåˆ†ã®å¼·ã¿ã ã¨æ€ã£ã¦ã„ã¾ã™ã€‚å‘¨å›²ã¨æ„è¦‹ã‚’å‡ºã—åˆã„ãªãŒã‚‰ã€ã‚ˆã‚Šè‰¯ã„å½¢ã«ãƒ–ãƒ©ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—ã—ã¦ã„ãéç¨‹ã«ã‚„ã‚ŠãŒã„ã‚’æ„Ÿã˜ã¾ã™ã€‚",
  
  patience: "ã€‡ã€‡ã®çµŒé¨“ã‹ã‚‰ã€ã†ã¾ãã„ã‹ãªã„æ™‚ã§ã‚‚æŠ•ã’å‡ºã•ãšã«å–ã‚Šçµ„ã‚€å§¿å‹¢ã‚’å¤§åˆ‡ã«ã—ã¦ãã¾ã—ãŸã€‚å°ã•ãªé€²æ­©ã‚’ç©ã¿ä¸Šã’ã‚‹åŠ›ãŒèº«ã«ã¤ãã¾ã—ãŸã€‚çµæœãŒå‡ºã‚‹ã¾ã§æ™‚é–“ãŒã‹ã‹ã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã—ãŸãŒã€ç²˜ã‚Šå¼·ãç¶šã‘ã‚‹ã“ã¨ã§è‡ªä¿¡ã«ã¤ãªãŒã£ã¦ã„ã¾ã™ã€‚"
};


  const textarea = document.querySelector('#self-pr-textarea');
  if (textarea) {
    textarea.value = prTemplates[category];
  }
}



  async function compressImage(base64, maxSize = 300) {
  return new Promise((resolve) => {
    const img = new Image();
    img.onload = () => {
      const canvas = document.createElement("canvas");
      const scale = Math.min(maxSize / img.width, maxSize / img.height, 1);
      canvas.width = img.width * scale;
      canvas.height = img.height * scale;

      const ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

      const mimeType = base64.startsWith("data:image/png") ? "image/png" : "image/jpeg";
      const compressed = canvas.toDataURL(mimeType, 0.6);
      resolve(compressed);
    };
    img.src = base64;
  });
}


  </script>
<!-- æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªèƒŒæ™¯ãƒ†ãƒ³ãƒ—ãƒ¬ä¸€è¦§ -->
<div id="bg-template-list" style="
  display: none;
  position: fixed;
  bottom: 70px;
  left: 50%;
  transform: translateX(-50%);
  background: white;
  padding: 10px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  z-index: 1100;
  max-width: 90vw;
  overflow-x: auto;
  gap: 10px;
  scrollbar-width: none; /* Firefoxç”¨ */
  -ms-overflow-style: none; /* IEç”¨ */
">
<!-- â–¼ ã‚«ãƒ¡ãƒ©ã‚¢ã‚¤ã‚³ãƒ³ä»˜ããƒ†ãƒ³ãƒ—ãƒ¬è¿½åŠ ã“ã“ã‹ã‚‰ -->
<img src="/static/camera.jpeg" onclick="document.getElementById('background-input').click()" 
     style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<!-- â–¼ ã‚«ãƒ¡ãƒ©ã‚¢ã‚¤ã‚³ãƒ³ä»˜ããƒ†ãƒ³ãƒ—ãƒ¬è¿½åŠ ã“ã“ã¾ã§ -->
  <img src="/static/haikei_1.jpeg" onclick="setBackground('/static/haikei_1.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_2.jpeg" onclick="setBackground('/static/haikei_2.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_3.jpeg" onclick="setBackground('/static/haikei_3.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_4.jpeg" onclick="setBackground('/static/haikei_4.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_5.jpeg" onclick="setBackground('/static/haikei_5.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_6.jpeg" onclick="setBackground('/static/haikei_6.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_7.jpeg" onclick="setBackground('/static/haikei_7.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_8.jpeg" onclick="setBackground('/static/haikei_8.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_9.jpeg" onclick="setBackground('/static/haikei_9.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_10.jpeg" onclick="setBackground('/static/haikei_10.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<!-- ã•ã‚‰ã«è¿½åŠ ã—ã¦ã‚‚OKï¼ -->
</div>
<!-- â–¼ å…ˆã«ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ï¼ -->
<style>
  #diagnosis-button {
    padding: 12px 24px;
    font-size: 17px;
    border-radius: 12px;
    background: rgb(255, 102, 153);
    color: #fff;
    border: none;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    letter-spacing: 1px;
    transition: all 0.2s ease-in-out;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3); /* â† ã“ã“ã§è¦–èªæ€§UP */
  }

  #diagnosis-button:hover {
    background: linear-gradient(135deg, #ffd1e9, #d6f2f9, #ffffff);
    transform: scale(1.05);
  }
</style>

<!-- â–¼ è¨ºæ–­ãƒœã‚¿ãƒ³ï¼ˆãƒãƒ„ä»˜ãï¼‰ -->
<div id="diagnosis-wrapper" style="position: relative; margin-top: 20px; text-align: center;">
  <img src="/static/batu.jpeg" alt="å‰Šé™¤" class="sns-delete-btn" onclick="hideDiagnosisButton()" style="
    position: absolute;
    top: -13px;
    right: 100px;
    width: 18px;
    height: 18px;
    cursor: pointer;
    z-index: 10;
  ">
  <button id="diagnosis-button" onclick="startDiagnosis()">ã€‡ã€‡ã•ã‚“ã®ç‰¹å¾´ï¼</button>
</div>
<!-- ğŸ”½ è‡ªå·±PRå…¥åŠ›ã¨åˆ†æãƒœã‚¿ãƒ³ -->
<div id="self-pr-section" style="margin-top: 40px; position: relative;">
  <img src="/static/batu.jpeg" alt="å‰Šé™¤" class="sns-delete-btn" onclick="hideSelfPRSection()" style="
    position: absolute;
    top: 38px;
    right: 20px;
    width: 18px;
    height: 18px;
    cursor: pointer;
    z-index: 10;
  ">

  <h3 style="text-align: center;">AIãŒè‡ªå·±PRã‚’åˆ†æï¼çµæœã‚’è¦‹ã¦ã¿ã‚ˆã†</h3>

  <!-- âœ… è‡ªç”±è¨˜å…¥æ¬„ã«å¯„ã›ãŸtextarea -->
  <textarea id="self-pr-textarea" rows="4" placeholder="ä¾‹ï¼šç§ã¯ç›®æ¨™ã«å‘ã‹ã£ã¦åŠªåŠ›ã™ã‚‹ã®ãŒå¾—æ„ã§â€¦"
    style="
      margin-top: 3px;
      margin-left: 20px;
      padding: 14px 18px;
      border-radius: 14px;
      border: 1px solid #ccc;
      width: 90vw;
      max-width: 650px;
      height: 160px;
      font-size: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
      resize: none;
      line-height: 1.6;
      background-color: #fff;
      box-sizing: border-box;
    "></textarea>
<!-- è‡ªå·±PRãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæŒ¿å…¥ãƒœã‚¿ãƒ³ -->
<div class="deletable-templates self-pr-template-section" style="text-align: center; margin-top: 13px;">
  <button onclick="showPRTemplateButtons()" style="
    font-size: 14px;
    padding: 6px 14px;
    border-radius: 8px;
    border: none;
    background: rgb(255, 224, 136); 
    color: #333;
    font-weight: bold;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: background-color 0.2s ease;
  ">âœï¸ è‡ªå·±PRãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</button>
</div>

<!-- è‡ªå·±PRãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé …ç›®ãƒœã‚¿ãƒ³ -->
<div id="pr-template-buttons" style="
  margin: 12px auto 0;
  display: none;
  justify-content: center;
  flex-wrap: wrap;
  gap: 6px;
  max-width: 90%;
">
  <button onclick="insertPRTemplate('study')" class="template-btn">å‹‰å­¦</button>
  <button onclick="insertPRTemplate('sports')" class="template-btn">ã‚¹ãƒãƒ¼ãƒ„</button>
  <button onclick="insertPRTemplate('communication')" class="template-btn">ã‚³ãƒŸãƒ¥åŠ›</button>
  <button onclick="insertPRTemplate('creativity')" class="template-btn">å‰µé€ åŠ›</button>
  <button onclick="insertPRTemplate('patience')" class="template-btn">å¿è€åŠ›</button>
</div>


 <!-- âœ… è‡ªç”±è¨˜å…¥æ¬„ã¨èª¿å’Œã•ã›ãŸãƒœã‚¿ãƒ³ -->
<button onclick="analyzeSelfPR()" style="
  display: block;
  margin: 10px auto;
  padding: 10px 20px;
  font-size: 15px;
  border-radius: 10px;
  background: rgb(255, 224, 136); 
  color: black; /* æ–‡å­—ã‚’é»’ã« */
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  border: 1px solid #ccc;
">åˆ†æã—ã¦è¡¨ç¤º</button>
</div>


<!-- è‡ªå·±PRåˆ†æãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="self-pr-modal" style="
  display: none; /* åˆæœŸã¯éè¡¨ç¤ºï¼ */
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background-color: rgba(0, 0, 0, 0.6);
  z-index: 10000;
  box-sizing: border-box;
">
  <!-- âœ… ãƒ¢ãƒ¼ãƒ€ãƒ«ä¸­èº«ã‚’flexã§ä¸­å¤®å¯„ã› -->
  <div style="
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
  ">
    <!-- ç™½ã„ãƒœãƒƒã‚¯ã‚¹ -->
    <div style="
      background: white;
      padding: 30px 20px;
      border-radius: 16px;
      max-width: 90%;
      width: 340px;
      text-align: center;
      position: relative;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    ">
      <!-- é–‰ã˜ã‚‹ -->
      <div onclick="document.getElementById('self-pr-modal').style.display='none'" style="
        position: absolute;
        top: 12px;
        right: 16px;
        font-size: 20px;
        font-weight: bold;
        cursor: pointer;
      ">Ã—</div>

     <!-- ãƒãƒ£ãƒ¼ãƒˆ -->
<canvas id="resultChart" width="220" height="220" style="
  display: block;
  margin: 0 auto 20px;
  background: linear-gradient(to bottom, #ffffff, #e0f0ff);
  border-radius: 20px;
  transform: translateX(80px); /* ğŸ‘ˆ å³ã«ãšã‚‰ã™ */
"></canvas>

<!-- ã‚³ãƒ¡ãƒ³ãƒˆ -->
<h3 style="margin-bottom: -40px 0 5px;">ã‚ãªãŸã®å¼·ã¿è¨ºæ–­çµæœ</h3> <!-- ğŸ‘ˆ ä¸‹ã«ãšã‚‰ã™ -->
<div id="self-pr-comment" style="text-align: left; font-size: 15px; margin-top: 10px;"></div>
    </div>
  </div>
</div>





<!-- â–¼ ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºéƒ¨åˆ† -->
<div id="diagnosis-modal" style="
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background-color: rgba(0,0,0,0.7);
  z-index: 9999;
  align-items: center;
  justify-content: center;
">
  <div style="
    background: white;
    padding: 28px 24px;
    border-radius: 20px;
    max-width: 90vw;
    font-size: 13px;
    font-weight: bold;
    text-align: center;
    font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', sans-serif;
    animation: fadeIn 0.6s ease-in-out;
    line-height: 1.6;
  " id="diagnosis-result"></div>
</div>

<style>
@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1); }
}
</style>

<script>
function startDiagnosis() {
  const textInputs = Array.from(document.querySelectorAll('.editable-text')).map(i => i.value).join(' ');
  const extra = document.getElementById('extra-text')?.value || '';
  const combined = (textInputs + ' ' + extra).toLowerCase();
  const barColor = getComputedStyle(document.documentElement).getPropertyValue('--bar-color').trim().toLowerCase();

  let type = '';

  // I / E åˆ¤å®š
  if (
    combined.match(/ã²ã¨ã‚Š|é™ã‹|æœ¬|ã‚½ãƒ­|å®¶|è½ã¡ç€ã|ã‚¢ãƒ‹ãƒ¡|å†…çœ|é»™ã‚‹|ãƒã‚¤ãƒšãƒ¼ã‚¹|çœã‚¨ãƒ|è¦³å¯Ÿ|èãå½¹|è‡ªåˆ†æ™‚é–“|ã²ãã‹|ä¸€äººæ—…/) ||
    combined.match(/ç§ã¯ä¸€äººã§éã”ã™æ™‚é–“ã«å¿ƒåœ°ã‚ˆã•ã‚’æ„Ÿã˜ã¾ã™ã€‚é™ã‹ãªå ´æ‰€ã§æœ¬ã‚’èª­ã‚“ã ã‚Šã€æ€ç´¢ã«ãµã‘ã‚‹ã“ã¨ã§ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒå›å¾©ã—ã¾ã™ã€‚äººã¨è©±ã™ã‚ˆã‚Šã‚‚ã€ã¾ãšè‡ªåˆ†ã®ä¸­ã§è€ƒãˆã‚’æ•´ç†ã™ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚/)
  ) {
    type += 'I';
  } else if (
    combined.match(/ä»²é–“|ã¿ã‚“ãª|ã‚«ãƒ©ã‚ªã‚±|ã‚¤ãƒ™ãƒ³ãƒˆ|æ—…è¡Œ|é£²ã¿ä¼š|ãŠã—ã‚ƒã¹ã‚Š|é¨’ã|SNS|ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼|ç››ã‚Šä¸ŠãŒã‚Š|è³‘ã‚„ã‹|å¤–å‡º|éŠã¶|ãƒ†ãƒ³ã‚·ãƒ§ãƒ³/) ||
    combined.match(/äººã¨è©±ã—ãŸã‚Šã€èª°ã‹ã¨ä¸€ç·’ã«éã”ã™ã“ã¨ã§å…ƒæ°—ãŒå‡ºã¾ã™ã€‚ã‚¤ãƒ™ãƒ³ãƒˆã‚„é›†ã¾ã‚ŠãŒå¥½ãã§ã€æ–°ã—ã„äººã¨å‡ºä¼šã†ã“ã¨ã«ãƒ¯ã‚¯ãƒ¯ã‚¯ã—ã¾ã™ã€‚é»™ã£ã¦ã„ã‚‹ã‚ˆã‚Šã‚‚ã€ä¼šè©±ã®ä¸­ã§è‡ªåˆ†ã‚’è¡¨ç¾ã—ãŸã„ã§ã™ã€‚/)
  ) {
    type += 'E';
  } else {
    type += 'I';
  }

  // N / S åˆ¤å®š
  if (
    combined.match(/ç©ºæƒ³|ã²ã‚‰ã‚ã|æƒ³åƒ|ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–|ã‚¢ãƒ¼ãƒˆ|å‰µä½œ|å“²å­¦|ç›´æ„Ÿ|å¤¢|æœªæ¥|ç†æƒ³|å¯èƒ½æ€§|ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³|æŠ½è±¡|æ¦‚å¿µ/) ||
    combined.match(/ç§ã¯ã‚¢ã‚¤ãƒ‡ã‚¢ã‚„ç©ºæƒ³ã‚’è†¨ã‚‰ã¾ã›ã‚‹ã®ãŒå¥½ãã§ã€ç¾å®Ÿã‚ˆã‚Šã‚‚æœªæ¥ã®å¯èƒ½æ€§ã«ç›®ã‚’å‘ã‘ãŒã¡ã§ã™ã€‚ç›´æ„Ÿçš„ã«ç‰©äº‹ã‚’æ‰ãˆã‚‹å ´é¢ã‚‚å¤šãã€æŠ½è±¡çš„ãªè©±é¡Œã«æƒ¹ã‹ã‚Œã‚‹ã“ã¨ãŒã‚ˆãã‚ã‚Šã¾ã™ã€‚/)
  ) {
    type += 'N';
  } else if (
    combined.match(/ç¾å®Ÿ|å®Ÿç”¨|æ—…è¡Œ|é‹å‹•|æ–™ç†|ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢|å…·ä½“|ä½“é¨“|äº”æ„Ÿ|äº‹å®Ÿ|åœ°ã«è¶³|çµŒé¨“|ç¾å ´|è¨¼æ‹ /) ||
    combined.match(/è‡ªåˆ†ãŒå®Ÿéš›ã«ä½“é¨“ã—ãŸã“ã¨ã‚„ã€ç¾å ´ã§å¾—ãŸæ„Ÿè¦šã‚’å¤§äº‹ã«ã—ã¦ã„ã¾ã™ã€‚å…·ä½“çš„ãªäº‹å®Ÿã‚’ã‚‚ã¨ã«åˆ¤æ–­ã™ã‚‹å‚¾å‘ãŒã‚ã‚Šã€æŠ½è±¡çš„ãªè©±ã‚ˆã‚Šã‚‚ç›®ã®å‰ã®ç¾å®Ÿã‚’é‡è¦–ã™ã‚‹æ–¹ã§ã™ã€‚/)
  ) {
    type += 'S';
  } else {
    type += 'N';
  }

  // T / F åˆ¤å®šï¼ˆã‚¹ã‚³ã‚¢å¼ï¼‰
  let tfScore = 0;
  if (
    combined.match(/è«–ç†|åˆ†æ|åŠ¹ç‡|æ•°å­—|ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°|ç†å±ˆ|æˆ¦ç•¥|ãƒ‡ãƒ¼ã‚¿|åˆç†|å®¢è¦³|åˆ¤æ–­|ç«¶äº‰|è­°è«–/) ||
    combined.match(/ç‰©äº‹ã‚’åˆ¤æ–­ã™ã‚‹ã¨ãã¯æ„Ÿæƒ…ã‚ˆã‚Šã‚‚è«–ç†çš„ãªæ€è€ƒã‚’å„ªå…ˆã—ã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã‚„äº‹å®Ÿã«åŸºã¥ã„ã¦åŠ¹ç‡çš„ã«é€²ã‚ãŸã„ã¨ã„ã†æ„è­˜ãŒå¼·ãã€æ„Ÿæƒ…ã«æµã•ã‚Œãªã„ã‚ˆã†å¿ƒãŒã‘ã¦ã„ã¾ã™ã€‚/)
  ) tfScore += 1;

  if (
    combined.match(/å…±æ„Ÿ|ã‚„ã•ã—ã„|å¿œæ´|æ€ã„ã‚„ã‚Š|ã‚±ã‚¢|æ„Ÿæƒ…|æ¶™|ç›¸è«‡|æ°—æŒã¡|ã¬ãã‚‚ã‚Š|æ„›æƒ…|æ”¯ãˆã‚‹|å¯„ã‚Šæ·»ã†/) ||
    combined.match(/äººã®æ°—æŒã¡ã«æ•æ„Ÿã§ã€å›°ã£ã¦ã„ã‚‹äººã‚’è¦‹ã‚‹ã¨æ”¾ã£ã¦ãŠã‘ã¾ã›ã‚“ã€‚ç›¸æ‰‹ã«å…±æ„Ÿã—ãªãŒã‚‰æ¥ã™ã‚‹ã“ã¨ã‚’å¤§åˆ‡ã«ã—ã¦ãŠã‚Šã€æ„Ÿæƒ…ã‚’å…±æœ‰ã™ã‚‹ã“ã¨ã§é–¢ä¿‚ã‚’æ·±ã‚ã‚ˆã†ã¨ã—ã¾ã™ã€‚/)
  ) tfScore -= 1;

  if (barColor.includes('pink') || barColor.includes('#f')) tfScore -= 1;
  if (barColor.includes('blue') || barColor.includes('#00f') || barColor.includes('navy')) tfScore += 1;

  type += tfScore >= 0 ? 'T' : 'F';

  // J / P åˆ¤å®š
  if (
    combined.match(/è¨ˆç”»|æ•´ç†|ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«|æ™‚é–“ç®¡ç†|ãƒªã‚¹ãƒˆ|æº–å‚™|ç®¡ç†|ç›®æ¨™|æ®µå–ã‚Š|ç· åˆ‡|ã—ã£ã‹ã‚Š|è¨ˆç®—|å®‰å®š|æ§‹é€ /) ||
    combined.match(/ã‚ã‚‰ã‹ã˜ã‚è¨ˆç”»ã‚’ç«‹ã¦ã¦è¡Œå‹•ã™ã‚‹æ–¹ãŒå®‰å¿ƒã—ã¾ã™ã€‚ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’çµ„ã‚“ã§é€²ã‚ãŸã‚Šã€æ®µå–ã‚Šã‚’æ•´ãˆã‚‹ã“ã¨ã§æ°—æŒã¡ã«ä½™è£•ãŒç”Ÿã¾ã‚Œã‚‹ã‚¿ã‚¤ãƒ—ã§ã™ã€‚çªç„¶ã®å¤‰æ›´ã¯è‹¦æ‰‹ã§ã™ã€‚/)
  ) {
    type += 'J';
  } else if (
    combined.match(/è‡ªç”±|æ°—ã¾ã¾|æŸ”è»Ÿ|ãƒã‚¤ãƒšãƒ¼ã‚¹|ãã®å ´|æ€ã„ã¤ã|å³èˆˆ|å¯¾å¿œåŠ›|å¤‰åŒ–|æµã‚Œ|å‹¢ã„|ã‚†ã‚‹ã„|ç›´æ„Ÿçš„/) ||
    combined.match(/ãã®æ™‚ã®æ°—åˆ†ã‚„çŠ¶æ³ã«å¿œã˜ã¦æŸ”è»Ÿã«å‹•ãã“ã¨ãŒå¤šã„ã§ã™ã€‚ç´°ã‹ã„è¨ˆç”»ã‚ˆã‚Šã‚‚ã€æµã‚Œã«ä¹—ã£ã¦å³èˆˆã§å¯¾å¿œã™ã‚‹æ–¹ãŒå¾—æ„ã§ã€è‡ªåˆ†ã‚‰ã—ã•ã‚’å¤§åˆ‡ã«ã—ãŸã„ã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚/)
  ) {
    type += 'P';
  } else {
    type += 'P';
  }




  const mbtiDescriptions = {
  INFP: "ç†æƒ³å®¶ã§ã‚„ã•ã—ã„ç™’ã—ç³»ï¼",
  INTP: "è«–ç†æ´¾ã®çŸ¥çš„æ¢ç©¶ã‚¿ã‚¤ãƒ—ï¼",
  INFJ: "å…±æ„ŸåŠ›ã‚ã‚‹é™ã‹ãªã‚«ãƒªã‚¹ãƒï¼",
  INTJ: "æœªæ¥ã‚’èª­ã‚€æˆ¦ç•¥å®¶ã‚¿ã‚¤ãƒ—ï¼",
  ENFP: "ç›´æ„Ÿã§å‹•ãå†’é™ºã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ï¼",
  ENTP: "æ©Ÿè»¢ã¨è¡Œå‹•åŠ›ã‚ã‚‹æŒ‘æˆ¦è€…ï¼",
  ENFJ: "äººã‚’å°ãå·»ãè¾¼ã¿ä¸Šæ‰‹ï¼",
  ENTJ: "ç›®æ¨™ä¸€ç›´ç·šãªãƒªãƒ¼ãƒ€ãƒ¼è‚Œï¼",
  ISFP: "æ„Ÿæ€§è±Šã‹ãªç©ã‚„ã‹ã‚¿ã‚¤ãƒ—ï¼",
  ISTP: "å†·é™ã§å®Ÿè·µæ´¾ãªè·äººè‚Œï¼",
  ISFJ: "å„ªã—ãæ”¯ãˆã‚‹ç¸ã®ä¸‹ã®åŠ›æŒã¡ï¼",
  ISTJ: "çœŸé¢ç›®ã§ä¿¡é ¼ã•ã‚Œã‚‹å …å®Ÿå®¶ï¼",
  ESFP: "é™½æ°—ãªãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ï¼",
  ESTP: "è¡Œå‹•æ´¾ãªãƒªã‚¢ãƒªã‚¹ãƒˆï¼",
  ESFJ: "ä¸–è©±å¥½ãã§è¦ªã—ã¿ã‚„ã™ã„ï¼",
  ESTJ: "é ¼ã‚Œã‚‹å®Ÿå‹™ã®ãƒ—ãƒ­ï¼"
};


  const displayName = "ã€‡ã€‡ã•ã‚“";
  const resultLines = [];

  resultLines.push(`<div style="font-size: 20px;">${displayName}ã¯ã€Œ${type}ã‚¿ã‚¤ãƒ—ã€ã‹ã‚‚ï¼ï¼Ÿ</div>`);
  resultLines.push(`<div>MBTIçš„ã«ã¯ï¼š${mbtiDescriptions[type] || "ãƒãƒ©ãƒ³ã‚¹å‹ã‚¿ã‚¤ãƒ—ï¼"}</div>`);

  if (barColor.includes('pink') || barColor.includes('#f') || barColor.includes('rose')) {
  resultLines.push("<div>è‰²è¨ºæ–­ï¼šãƒ”ãƒ³ã‚¯ç³» â†’ æ„Ÿå—æ€§è±Šã‹ã§ã‚„ã•ã—ã„æ€§æ ¼ï¼</div>");
} else if (barColor.includes('blue') || barColor.includes('navy') || barColor.includes('#00f') || barColor.includes('sky')) {
  resultLines.push("<div>è‰²è¨ºæ–­ï¼šé’ç³» â†’ å†·é™ã§èª å®Ÿã€çŸ¥çš„ãªæ€§æ ¼ï¼</div>");
} else if (barColor.includes('green') || barColor.includes('lime') || barColor.includes('olive')) {
  resultLines.push("<div>è‰²è¨ºæ–­ï¼šç·‘ç³» â†’ è‡ªç„¶ã‚„å¹³å’Œã‚’å¤§åˆ‡ã«ã™ã‚‹ç©ã‚„ã‹ã‚¿ã‚¤ãƒ—ï¼</div>");
} else if (barColor.includes('yellow') || barColor.includes('gold') || barColor.includes('#ff0')) {
  resultLines.push("<div>è‰²è¨ºæ–­ï¼šé»„è‰²ç³» â†’ æ˜ã‚‹ãå‰å‘ãã§ç¤¾äº¤çš„ãªæ€§æ ¼ï¼</div>");
} else if (barColor.includes('orange') || barColor.includes('#ffa')) {
  resultLines.push("<div>è‰²è¨ºæ–­ï¼šã‚ªãƒ¬ãƒ³ã‚¸ç³» â†’ æ´»å‹•çš„ã§äººæ‡ã£ã“ã„ã‚¨ãƒãƒ«ã‚®ãƒ¼æ´¾ï¼</div>");
} else if (barColor.includes('red') || barColor.includes('crimson') || barColor.includes('#f00')) {
  resultLines.push("<div>è‰²è¨ºæ–­ï¼šèµ¤ç³» â†’ æƒ…ç†±çš„ã§ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’æŒã¤äººï¼</div>");
} else if (barColor.includes('purple') || barColor.includes('violet') || barColor.includes('indigo')) {
  resultLines.push("<div>è‰²è¨ºæ–­ï¼šç´«ç³» â†’ æ„Ÿæ€§è±Šã‹ã§ãƒŸã‚¹ãƒ†ãƒªã‚¢ã‚¹ãªé­…åŠ›ï¼</div>");
} else if (barColor.includes('black') || barColor.includes('#000')) {
  resultLines.push("<div>è‰²è¨ºæ–­ï¼šé»’ç³» â†’ æ„å¿—ãŒå¼·ãã€è½ã¡ç€ã„ãŸé›°å›²æ°—ï¼</div>");
} else if (barColor.includes('white') || barColor.includes('#fff') || barColor.includes('ivory')) {
  resultLines.push("<div>è‰²è¨ºæ–­ï¼šç™½ç³» â†’ ç´”ç²‹ã§ç´ ç›´ã€èª¿å’Œã‚’å¤§åˆ‡ã«ã™ã‚‹ã‚¿ã‚¤ãƒ—ï¼</div>");
} else if (barColor.includes('gray') || barColor.includes('grey') || barColor.includes('#888')) {
  resultLines.push("<div>è‰²è¨ºæ–­ï¼šã‚°ãƒ¬ãƒ¼ç³» â†’ å†·é™ã§å¤§äººã³ãŸãƒãƒ©ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ï¼</div>");
} else {
  resultLines.push("<div>è‰²è¨ºæ–­ï¼šä¸­é–“è‰² â†’ å¤šæ§˜æ€§ã‚’å—ã‘å…¥ã‚Œã‚‹æŸ”è»Ÿãªã‚¿ã‚¤ãƒ—ï¼</div>");
}


 const hobbyTags = {
  'ã‚²ãƒ¼ãƒ ': 'æˆ¦ç•¥æ´¾ or ãƒã‚¤ãƒšãƒ¼ã‚¹æ´¾',
  'ã‚¢ãƒ‹ãƒ¡': 'æ„Ÿæ€§è±Šã‹ã§å†…å‘å‹å¯„ã‚Š',
  'æ—…è¡Œ': 'å¥½å¥‡å¿ƒæ—ºç››ãªå†’é™ºå¥½ã',
  'ã‚«ãƒ•ã‚§': 'ç™’ã—é‡è¦–ãƒ»æ„Ÿæ€§ã‚¿ã‚¤ãƒ—',
  'éŸ³æ¥½': 'æ„Ÿæƒ…ã¨çµã³ã¤ããŒå¼·ã„äºº',
  'èª­æ›¸': 'æ€ç´¢å‹ãƒ»æƒ³åƒåŠ›ãŒè±Šã‹',
  'ã‚¹ãƒãƒ¼ãƒ„': 'å¤–å‘çš„ã§ã‚¨ãƒãƒ«ã‚®ãƒƒã‚·ãƒ¥',
  'ç¾è¡“': 'ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–å¿—å‘',
  'æ–™ç†': 'ç¹Šç´°ã§å®¶åº­çš„ãªæ°—è³ª',
  'ç­‹ãƒˆãƒ¬': 'è‡ªå·±æˆé•·æ„è­˜ãŒå¼·ã„ã‚¿ã‚¤ãƒ—',
  'ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³': 'è‡ªå·±è¡¨ç¾ã¨æµè¡Œã«æ•æ„Ÿãªã‚¿ã‚¤ãƒ—',
  'ãƒ€ãƒ³ã‚¹': 'èº«ä½“ã§æ„Ÿæƒ…ã‚’è¡¨ç¾ã™ã‚‹æƒ…ç†±æ´¾',
  'ã‚«ãƒ©ã‚ªã‚±': 'ç¤¾äº¤çš„ã§è¡¨ç¾ãŒå¥½ããªç››ã‚Šä¸Šã’å½¹',
  'ãƒœãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ': 'é ­è„³æ´¾ã§ã¿ã‚“ãªã¨æ¥½ã—ã‚€ã“ã¨ãŒå¥½ã',
  'ãƒšãƒƒãƒˆ': 'æ„›æƒ…æ·±ãã€ç™’ã—ã‚„ã¤ãªãŒã‚Šã‚’å¤§äº‹ã«ã™ã‚‹äºº',
  'ã‚¤ãƒ©ã‚¹ãƒˆ': 'ç¹Šç´°ã§æ„Ÿå—æ€§ãŒè±Šã‹ã€æƒ³åƒåŠ›ã‚‚é«˜ã„',
  'ã‚«ãƒ¡ãƒ©': 'è¦³å¯Ÿçœ¼ã«å„ªã‚Œã€æ„Ÿæƒ…ã‚’å†™çœŸã§è¡¨ç¾ã—ãŸã„ã‚¿ã‚¤ãƒ—',
  'æ˜ ç”»': 'ç‰©èªã‚„ä¸–ç•Œè¦³ã«æ²¡å…¥ã™ã‚‹ã‚¨ãƒ¢æ´¾',
  'ã‚«ãƒ©ãƒ•ãƒ«ãªé›‘è²¨': 'æ˜ã‚‹ãå€‹æ€§çš„ãªã‚»ãƒ³ã‚¹ã®æŒã¡ä¸»',
  'æ‰‹èŠ¸': 'ä¸å¯§ã§é›†ä¸­åŠ›ãŒé«˜ãã€ã‚‚ã®ã¥ãã‚Šå¥½ã',
  'æ•£æ­©': 'è‡ªç„¶ã¨ã®èª¿å’Œã‚’å¤§åˆ‡ã«ã™ã‚‹ãƒã‚¤ãƒšãƒ¼ã‚¹æ´¾',
  'ã‚­ãƒ£ãƒ³ãƒ—': 'è‡ªç„¶ã¨ã®ä¸€ä½“æ„Ÿã‚’æ±‚ã‚ã‚‹ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢æ´¾',
  'é‡£ã‚Š': 'å¿è€å¼·ãé™ã‹ãªæ™‚é–“ã‚’æ¥½ã—ã‚ã‚‹ã‚¿ã‚¤ãƒ—',
  'æ—¥è¨˜': 'è‡ªå·±å†…çœå‹ã§æ„Ÿæƒ…ã®æ•´ç†ãŒå¾—æ„',
  'ãƒ–ãƒ­ã‚°': 'ç™ºä¿¡åŠ›ãŒã‚ã‚Šã€æ€è€ƒã‚’è¨€èªåŒ–ã™ã‚‹ã®ãŒå¾—æ„',
  'ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°': 'ã‚³ãƒ„ã‚³ãƒ„åŠªåŠ›å‹ãƒ»é”æˆæ„Ÿé‡è¦–ã‚¿ã‚¤ãƒ—',
  'DIY': 'æ‰‹ã‚’å‹•ã‹ã—ã¦è€ƒãˆã‚‹ã‚¯ãƒ©ãƒ•ãƒˆãƒãƒ³ã‚¿ã‚¤ãƒ—',
  'è»Š': 'æ©Ÿæ¢°ã‚„ã‚¹ãƒ”ãƒ¼ãƒ‰ã«ãƒ­ãƒãƒ³ã‚’æ„Ÿã˜ã‚‹äºº',
  'ãƒã‚¤ã‚¯': 'åˆºæ¿€ã¨è‡ªç”±ã‚’æ±‚ã‚ã‚‹ã‚¢ã‚¦ãƒˆãƒ­ãƒ¼æ°—è³ª',
  'ã‚¹ã‚¤ãƒ¼ãƒ„ä½œã‚Š': 'å‰µæ„å·¥å¤«ã¨ä¸å¯§ã•ã‚’æ¥½ã—ã‚€ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼',
  'æ¨ã—æ´»': 'æƒ…ç†±ã‚’æ³¨ã’ã‚‹å¯¾è±¡ãŒã‚ã‚‹æ„›æƒ…æ·±ã„ã‚¿ã‚¤ãƒ—',
  'Vlog': 'æ—¥å¸¸ã®ç¾ã—ã•ã‚„æ„Ÿå‹•ã‚’ç™ºä¿¡ã—ãŸã„ã‚¿ã‚¤ãƒ—',
  'èˆå°': 'è¡¨ç¾èŠ¸è¡“ã«æ„Ÿå‹•ã§ãã‚‹æ„Ÿæ€§æ´¾'
};

const detectedHobbies = Object.keys(hobbyTags).filter(word => combined.includes(word));
if (detectedHobbies.length > 0) {
  resultLines.push(`<div>${displayName}ã¯ ${detectedHobbies.join('ãƒ»')} ãŒå¥½ããªå‚¾å‘ãŒã‚ã‚‹ã‚ˆï¼</div>`);
  resultLines.push(`<div>â†’ å‚¾å‘ï¼š${detectedHobbies.map(h => hobbyTags[h]).join(' ï¼ ')}</div>`);
}

const hobbyExtensions = [];

// è‡ªç„¶æ–‡ï¼‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ä¸¡æ–¹ã«å¯¾å¿œ
const hobbyExtensionPatterns = [
  { keyword: 'ã‚²ãƒ¼ãƒ ', pattern: /ã‚²ãƒ¼ãƒ |æš‡(ãª|ãªã¨ãã«)?(ã¨ã|æ™‚é–“)ã¯(ã ã„ãŸã„)?ã‚²ãƒ¼ãƒ |FPS|RPG|ã‚¹ãƒ—ãƒ©|ã‚¨ãƒ¼ãƒšãƒƒã‚¯ã‚¹|ãƒãƒªã‚ª|ä»»å¤©å ‚|Steam|Switch|ã‚¹ãƒãƒ›ã‚²ãƒ¼ãƒ |ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒ /, msg: "\ud83c\udfae ã‚µãƒã‚²ãƒ¼ã‚„ãƒœãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ã‚‚å¥½ããªå¯èƒ½æ€§ã‚ã‚Šï¼" },
  { keyword: 'éŸ³æ¥½', pattern: /éŸ³æ¥½|é€šå­¦(ä¸­)?ã«(ã‚ˆã)?éŸ³æ¥½ã‚’è´ã|ãƒ©ã‚¤ãƒ–(ã«è¡Œã|å‚æˆ¦)|ãƒ•ã‚§ã‚¹|æ¨ã—ã®æ›²|BGM|ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ|ã‚¤ãƒ¤ãƒ›ãƒ³|Spotify|é‚¦ãƒ­ãƒƒã‚¯|J-POP|æ´‹æ¥½|ãƒ­ãƒƒã‚¯ãƒãƒ³ãƒ‰/, msg: "\ud83c\udfb5 ä½œæ›²ã‚„ãƒ©ã‚¤ãƒ–å‚æˆ¦ã«ã‚‚èˆˆå‘³ã‚ã‚‹ã‹ã‚‚ï¼" },
  { keyword: 'ã‚«ãƒ•ã‚§', pattern: /ã‚«ãƒ•ã‚§|ã‚«ãƒ•ã‚§å·¡ã‚Š|ã‚¤ãƒ³ã‚¹ã‚¿æ˜ ãˆã™ã‚‹ã‚«ãƒ•ã‚§|ã‚«ãƒ•ã‚§ã§ã‚†ã£ãã‚Š|ãŠã—ã‚ƒã‚Œãªã‚«ãƒ•ã‚§|ãŠæ°—ã«å…¥ã‚Šã®ã‚«ãƒ•ã‚§|ã‚³ãƒ¼ãƒ’ãƒ¼|ãƒ©ãƒ†ã‚¢ãƒ¼ãƒˆ|ãƒ‰ãƒªãƒƒãƒ—|ã‚¹ã‚¿ãƒ|å–«èŒ¶åº—/, msg: "\u2615\ufe0f ã‚«ãƒ•ã‚§å·¡ã‚Šãƒ–ãƒ­ã‚°å§‹ã‚ã¦ã‚‹ã‹ã‚‚ï¼Ÿ" },
  { keyword: 'èª­æ›¸', pattern: /èª­æ›¸|æœ¬ã‚’èª­ã‚€|æš‡(ãªã¨ã)?ã«èª­æ›¸|å›³æ›¸é¤¨é€šã„|å°èª¬|æ–‡åº«æœ¬|ãƒ“ã‚¸ãƒã‚¹æ›¸|ãƒãƒ³ã‚¬|æœ¬å±‹ã«é€šã†|Kindle|èª­æ›¸å¥½ã|ãƒ–ãƒƒã‚¯ã‚«ãƒ•ã‚§/, msg: "\ud83d\udcda æœ€è¿‘èª­ã‚“ã æœ¬ã®è©±ã‚’ã—ã¦ã¿ã‚‹ã¨ç››ã‚Šä¸ŠãŒã‚‹ã‹ã‚‚ï¼" },
  { keyword: 'ã‚¢ãƒ‹ãƒ¡', pattern: /ã‚¢ãƒ‹ãƒ¡|æ·±å¤œã‚¢ãƒ‹ãƒ¡|æ¯é€±æ¬ ã‹ã•ãšã‚¢ãƒ‹ãƒ¡|æ¨ã—ã‚¢ãƒ‹ãƒ¡|ã‚ªã‚¿ã‚¯|ã‚¢ãƒ‹ãƒ¡æ˜ ç”»|ã‚¸ãƒ£ãƒ³ãƒ—ç³»|äº¬ã‚¢ãƒ‹|ã‚¢ãƒ‹ãƒ¡å¥½ã|2æ¬¡å…ƒ|æ¨ã—ã‚­ãƒ£ãƒ©|U-NEXT|ã‚¢ãƒ‹ã‚ªã‚¿/, msg: "\ud83d\udcfa æ¨ã—ã‚­ãƒ£ãƒ©ã‚„ã‚¢ãƒ‹ãƒ¡ã‚ã‚‹ï¼Ÿã£ã¦èãã¨å–œã¶ã‚¿ã‚¤ãƒ—ã‹ã‚‚ï¼" },
  { keyword: 'ã‚¹ãƒãƒ¼ãƒ„', pattern: /ã‚¹ãƒãƒ¼ãƒ„|(ä½“è‚²ä¼šç³»|é‹å‹•éƒ¨|éƒ¨æ´»ã§é‹å‹•)|ä½“ã‚’å‹•ã‹ã™ã®ãŒå¥½ã|ç­‹ãƒˆãƒ¬|é‡çƒ|ã‚µãƒƒã‚«ãƒ¼|ãƒã‚¹ã‚±|ãƒ†ãƒ‹ã‚¹|ãƒ©ã‚°ãƒ“ãƒ¼|é™¸ä¸Š|ä½“è‚²|å¤§ä¼š|è©¦åˆ|è¦³æˆ¦|èµ°ã‚‹ã®ãŒå¥½ã/, msg: "\u26bd è¦³æˆ¦æ´¾ã‹ãƒ—ãƒ¬ã‚¤æ´¾ã‹èã„ã¦ã¿ã‚‹ã¨æ„å¤–ãªè©±ãŒèã‘ã‚‹ã‹ã‚‚ï¼" },
  { keyword: 'æ—…è¡Œ', pattern: /æ—…è¡Œ|é€±æœ«ã¯(ã‚ˆã)?æ—…è¡Œã«å‡ºã‹ã‘ã‚‹|æµ·å¤–æ—…è¡Œ|ä¸€äººæ—…|æ¸©æ³‰æ—…è¡Œ|å›½å†…æ—…è¡Œ|æ—…å¥½ã|è¦³å…‰åœ°å·¡ã‚Š|æ—…è¡Œè¨ˆç”»/, msg: "\u2708\ufe0f è¡Œã£ã¦ã¿ãŸã„å›½ã¨ã‹èªã‚Šåˆã†ã¨æ¥½ã—ã„ã‹ã‚‚ï¼" },
  { keyword: 'ç¾è¡“', pattern: /ç¾è¡“|ã‚¢ãƒ¼ãƒˆ|ç¾è¡“é¤¨å·¡ã‚Š|å±•è¦§ä¼šã«è¡Œã|çµµç”»é‘‘è³|èŠ¸è¡“ä½œå“|ç¾ä»£ã‚¢ãƒ¼ãƒˆ|æ¨ã—ç”»å®¶/, msg: "\ud83c\udfa8 ç¾è¡“é¤¨ãƒˆãƒ¼ã‚¯ã‚„æ¨ã—ç”»å®¶ã®è©±ãŒãƒãƒã‚‹ã‹ã‚‚ï¼" },
  { keyword: 'æ–™ç†', pattern: /æ–™ç†|è‡ªç‚Š|ã‚¯ãƒƒã‚­ãƒ³ã‚°|ã”ã¯ã‚“ä½œã‚Š|ãƒ¬ã‚·ãƒ”|å®¶åº­æ–™ç†|ãŠè“å­ä½œã‚Š|é£Ÿäº‹ã®æº–å‚™|ã‚­ãƒƒãƒãƒ³/, msg: "\ud83c\udf73 å¾—æ„æ–™ç†ã¨ã‹èãã¨ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ä¸ŠãŒã‚Šãã†ï¼" },
  { keyword: 'ç­‹ãƒˆãƒ¬', pattern: /ç­‹ãƒˆãƒ¬|ã‚¸ãƒ ã«é€šã†|ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³|è…¹ç­‹|ãƒ€ãƒ³ãƒ™ãƒ«|ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹|é›ãˆã‚‹|ç­‹è‚‰å¢—ã‚„ã™|ä½“ã‚’é›ãˆã‚‹/, msg: "\ud83d\udcaa ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³ã®è©±ã§ç››ã‚Šä¸ŠãŒã‚Œã‚‹ã‹ã‚‚â€¦ï¼ï¼Ÿ" },
  { keyword: 'ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³', pattern: /ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³|æœé¸ã³ãŒå¥½ã|ãŠã—ã‚ƒã‚Œ|ãƒ–ãƒ©ãƒ³ãƒ‰ã«è©³ã—ã„|ã‚»ãƒ¬ã‚¯ãƒˆã‚·ãƒ§ãƒƒãƒ—å·¡ã‚Š|æ´‹æœã‚³ãƒ¼ãƒ‡|æœã®ç³»çµ±/, msg: "\ud83d\udc57 å¥½ããªãƒ–ãƒ©ãƒ³ãƒ‰ã‚„æœã®ç³»çµ±ã€è©±ã—ã¦ã¿ã‚ˆã†ï¼" },
  { keyword: 'ã‚«ãƒ©ã‚ªã‚±', pattern: /ã‚«ãƒ©ã‚ªã‚±|æ­Œã†ã®ãŒå¥½ã|åå…«ç•ªã®æ›²ãŒã‚ã‚‹|ãƒ’ãƒˆã‚«ãƒ©|æ­Œå”±åŠ›|DAM|JOYSOUND|ã‚«ãƒ©ã‚ªã‚±ã§ç››ã‚Šä¸ŠãŒã‚‹/, msg: "\ud83c\udfa4 å®šç•ªã‚½ãƒ³ã‚°ã‚ã‚‹ï¼Ÿã£ã¦èãã¨ä¸€æ°—ã«è·é›¢ç¸®ã¾ã‚‹ã‹ã‚‚ï¼" },
  { keyword: 'ãƒšãƒƒãƒˆ', pattern: /ãƒšãƒƒãƒˆ|çŠ¬|çŒ«|ã†ã•ã|é£¼ã£ã¦ã‚‹å‹•ç‰©|ãƒšãƒƒãƒˆè‡ªæ…¢|ç™’ã•ã‚Œã‚‹å­˜åœ¨|ãƒšãƒƒãƒˆã¨ã®æ™‚é–“|ãƒ¢ãƒ•ãƒ¢ãƒ•/, msg: "\ud83d\udc3e é£¼ã£ã¦ã‚‹å‹•ç‰©ã®è©±ã‚’ã™ã‚‹ã¨å¬‰ã—ãã†ã«è©±ã—ã¦ãã‚Œã‚‹ã‹ã‚‚ï¼" },
  { keyword: 'ã‚¤ãƒ©ã‚¹ãƒˆ', pattern: /ã‚¤ãƒ©ã‚¹ãƒˆ|çµµã‚’æã|ãƒ‡ã‚¸çµµ|ã‚¢ãƒŠãƒ­ã‚°çµµ|ãŠçµµã‹ã|SNSã«æŠ•ç¨¿|Pixiv|ã‚¹ã‚±ãƒƒãƒãƒ–ãƒƒã‚¯/, msg: "\ud83d\udd8c\ufe0f SNSã«æŠ•ç¨¿ã—ã¦ã‚‹ã‹ã‚‚ï¼Ÿè¦‹ã›ã¦ã‚‚ã‚‰ã£ã¦ã¿ã‚ˆã†ï¼" },
  { keyword: 'æ˜ ç”»', pattern: /æ˜ ç”»|æ˜ ç”»é¤¨ã«è¡Œã|æ˜ ç”»ä¸‰æ˜§|ã‚µãƒ–ã‚¹ã‚¯ã§æ˜ ç”»|æ¨ã—ä¿³å„ª|æ´‹ç”»|é‚¦ç”»|åä½œæ˜ ç”»/, msg: "\ud83c\udfa5 å¥½ããªã‚¸ãƒ£ãƒ³ãƒ«ã‚„æ¨ã—ä¿³å„ªã®è©±ã§ç››ã‚Šä¸ŠãŒã‚Œã‚‹ã‹ã‚‚ï¼" },
  { keyword: 'ãƒ€ãƒ³ã‚¹', pattern: /ãƒ€ãƒ³ã‚¹|è¸Šã‚‹ã®ãŒå¥½ã|æŒ¯ã‚Šä»˜ã‘è¦šãˆã‚‹|K-POPãƒ€ãƒ³ã‚¹|ãƒ€ãƒ³ã‚¹ã‚µãƒ¼ã‚¯ãƒ«|ã‚¹ãƒ†ãƒ¼ã‚¸çµŒé¨“/, msg: "\ud83d\udd7a\fe0f å¥½ããªã‚¸ãƒ£ãƒ³ãƒ«ã‚„æŒ¯ã‚Šä»˜ã‘ã®è©±ã‚’ã™ã‚‹ã¨ç››ã‚Šä¸ŠãŒã‚Šãã†ï¼" },
  { keyword: 'ãƒœãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ', pattern: /ãƒœãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ |ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ |äººç‹¼|äººç”Ÿã‚²ãƒ¼ãƒ |ã¿ã‚“ãªã§éŠã¹ã‚‹ã‚²ãƒ¼ãƒ |é ­è„³æˆ¦/, msg: "\ud83c\udfb2 ã©ã®ã‚²ãƒ¼ãƒ æ´¾ã‹èãã¨ç››ã‚Šä¸ŠãŒã‚Œã‚‹ã‹ã‚‚ï¼" },
  { keyword: 'æ‰‹èŠ¸', pattern: /æ‰‹èŠ¸|è£ç¸«|ç·¨ã¿ç‰©|ãƒãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ‰|æ‰‹ä½œã‚Š|ãƒŸã‚·ãƒ³ä½œæ¥­|å¸ƒå°ç‰©ä½œã‚Š/, msg: "\ud83e\uddf5 ãƒãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ‰ä½œå“ã®è©±ã‚’ã™ã‚‹ã¨å¬‰ã—ãã†ã«è©±ã™ã‹ã‚‚ï¼" },
  { keyword: 'æ•£æ­©', pattern: /æ•£æ­©|ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°|è‡ªç„¶ã®ä¸­ã‚’æ­©ã|æœã®æ•£æ­©|æ°—åˆ†è»¢æ›ã«æ­©ã|è¿‘æ‰€ã‚’ã¶ã‚‰ã¶ã‚‰/, msg: "\ud83d\udeb6\u200d æ•£æ­©ã‚³ãƒ¼ã‚¹ã®è©±ã‹ã‚‰è‡ªç„¶ãƒˆãƒ¼ã‚¯ã«åºƒãŒã‚‹ã‹ã‚‚ï¼" },
  { keyword: 'ã‚«ãƒ¡ãƒ©', pattern: /ã‚«ãƒ¡ãƒ©|å†™çœŸã‚’æ’®ã‚‹|ä¸€çœ¼ãƒ¬ãƒ•|æ§‹å›³|é¢¨æ™¯æ’®å½±|ãƒ•ã‚©ãƒˆã‚³ãƒ³ãƒ†ã‚¹ãƒˆ|å†™çœŸé›†ã‚|ãƒ•ã‚£ãƒ«ãƒ ã‚«ãƒ¡ãƒ©/, msg: "\ud83d\udcf7 æ’®ã£ãŸå†™çœŸã‚’è¦‹ã›ã¦ã‚‚ã‚‰ã†ã¨ä¼šè©±ãŒå¼¾ã‚€ã‹ã‚‚ï¼" },
  { keyword: 'ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°', pattern: /ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°|ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã|ã‚¢ãƒ—ãƒªé–‹ç™º|Python|JavaScript|Webåˆ¶ä½œ|ãƒãƒƒã‚«ã‚½ãƒ³/, msg: "\ud83d\udcbb ã©ã‚“ãªã‚¢ãƒ—ãƒªã‚„ã‚³ãƒ¼ãƒ‰æ›¸ã„ã¦ã‚‹ã‹èã„ã¦ã¿ã‚ˆã†ï¼" },
  { keyword: 'DIY', pattern: /DIY|æ—¥æ›œå¤§å·¥|å®¶å…·ã‚’è‡ªä½œ|å·¥å…·ã‚’ä½¿ã†ã®ãŒå¾—æ„|ã‚¤ãƒ³ãƒ†ãƒªã‚¢ä½œã‚Š|æ”¹é€ /, msg: "\ud83d\udd27 æœ€è¿‘ä½œã£ãŸã‚‚ã®ã‚„ã“ã ã‚ã‚Šãƒã‚¤ãƒ³ãƒˆã‚’èã„ã¦ã¿ã‚ˆã†ï¼" },
  { keyword: 'è»Š', pattern: /è»Š|ãƒ‰ãƒ©ã‚¤ãƒ–|è»Šã„ã˜ã‚Š|ã‚«ã‚¹ã‚¿ãƒ |è»Šå¥½ã|æ„›è»Šè‡ªæ…¢|è»Šã®å†™çœŸ/, msg: "\ud83d\ude97 æ„›è»Šã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‚„ã‚«ã‚¹ã‚¿ãƒ ã®è©±ãŒå¼¾ã¿ãã†ï¼" },
  { keyword: 'ãƒã‚¤ã‚¯', pattern: /ãƒã‚¤ã‚¯|ãƒ„ãƒ¼ãƒªãƒ³ã‚°|ãƒã‚¤ã‚¯æ—…|ã‚«ã‚¹ã‚¿ãƒ |ãƒã‚¤ã‚¯æ„›å¥½å®¶|ã‚¨ãƒ³ã‚¸ãƒ³éŸ³/, msg: "\ud83d\ude97 æ„›è»Šã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‚„ã‚«ã‚¹ã‚¿ãƒ ã®è©±ãŒå¼¾ã¿ãã†ï¼" },
  { keyword: 'ã‚¹ã‚¤ãƒ¼ãƒ„ä½œã‚Š', pattern: /ã‚¹ã‚¤ãƒ¼ãƒ„ä½œã‚Š|ãŠè“å­ä½œã‚Š|ã‚±ãƒ¼ã‚­ä½œã‚‹|ã‚¯ãƒƒã‚­ãƒ¼ç„¼ã|ãƒ¬ã‚·ãƒ”æ¢ã—/, msg: "\ud83c\udf70 å¾—æ„ãªã‚¹ã‚¤ãƒ¼ãƒ„ã‚„ãƒ¬ã‚·ãƒ”ã«ã¤ã„ã¦èã„ã¦ã¿ã‚ˆã†ï¼" },
  { keyword: 'æ¨ã—æ´»', pattern: /æ¨ã—æ´»|ã‚¢ã‚¤ãƒ‰ãƒ«å¿œæ´|ã‚°ãƒƒã‚ºé›†ã‚|ãƒ©ã‚¤ãƒ–å‚æˆ¦|å¥½ããªã‚­ãƒ£ãƒ©ã«å…¨åŠ›|æ²¼ã‚‹/, msg: "\ud83d\udc96 æ¨ã—ã®é­…åŠ›ã‚’ç†±ãèªã£ã¦ã‚‚ã‚‰ã†ã¨å–œã¶ã‹ã‚‚ï¼" },
  { keyword: 'Vlog', pattern: /Vlog|æ˜ åƒæ—¥è¨˜|å‹•ç”»ç·¨é›†|æ—¥å¸¸è¨˜éŒ²|YouTubeæŠ•ç¨¿|ç·¨é›†ã‚½ãƒ•ãƒˆ|æ—¥å¸¸ã‚’åˆ‡ã‚Šå–ã‚‹/, msg: "\ud83d\udcc9 ç·¨é›†ã‚½ãƒ•ãƒˆã‚„ã“ã ã‚ã‚Šãƒã‚¤ãƒ³ãƒˆã‚’èãã¨è©±ãŒåºƒãŒã‚‹ã‹ã‚‚ï¼" },
  { keyword: 'èˆå°', pattern: /èˆå°|æ¼”åŠ‡|åŠ‡å›£|èˆå°ä¿³å„ª|è¦³åŠ‡|2.5æ¬¡å…ƒ|ãƒŸãƒ¥ãƒ¼ã‚¸ã‚«ãƒ«/, msg: "\ud83c\udfad æœ€è¿‘è¦³ãŸä½œå“ã¨ã‹ã€å½¹è€…ã•ã‚“ã®è©±é¡ŒãŒãƒãƒã‚‹ã‹ã‚‚ï¼" }
];

// â†“ æ¤œå‡ºå‡¦ç†
for (const item of hobbyExtensionPatterns) {
  if (combined.includes(item.keyword) || item.pattern.test(combined)) {
    hobbyExtensions.push(item.msg);
  }
}

if (hobbyExtensions.length > 0) {
  resultLines.push(`<div style="margin-top:12px;">ã“ã®è©±é¡Œã‚’æŒ¯ã£ã¦ã¿ã‚ˆã†ğŸ‘‡</div>`);
  resultLines.push(`
    <div style="
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 8px 4px;
      line-height: 1.7;
      word-break: keep-all;
      overflow-wrap: break-word;
    ">
      ${hobbyExtensions.map(line => `<div style="white-space: normal;">${line}</div>`).join('')}
    </div>
  `);
}


  localStorage.setItem('my_mbti', type);
  const mbtiEl = document.getElementById('mbti-type');
if (mbtiEl) mbtiEl.innerText = type;

  document.getElementById('diagnosis-result').innerHTML = resultLines.join('');
  document.getElementById('diagnosis-modal').style.display = 'flex';

  document.getElementById('diagnosis-modal').addEventListener('click', () => {
    document.getElementById('diagnosis-modal').style.display = 'none';
  });
}
window.dispatchEvent(new Event('DOMContentLoaded'));

</script>

<!-- â†“ ã“ã“ãŒMBTIã‚¿ã‚¤ãƒ—ãŒè¡¨ç¤ºã•ã‚Œã‚‹éè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
<div id="mbti-type" style="display:none;"></div>

<!-- â–¼ ç›¸æ€§è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
<script>
window.addEventListener('DOMContentLoaded', () => {
  const myMbti = localStorage.getItem('my_mbti');
  const otherMbti = document.getElementById('mbti-type')?.innerText ||
                    document.getElementById('hidden-mbti')?.value || '';

  if (myMbti && otherMbti && myMbti.length === 4 && otherMbti.length === 4) {
    const compatibility = getCompatibility(myMbti, otherMbti);
    const score = getCompatibilityScore(myMbti, otherMbti);
    showCompatibilityModal(myMbti, otherMbti, compatibility, score);
  }
});

function getCompatibility(mbti1, mbti2) {
  const perfectPairs = [
    ['INFP', 'ENFJ'], ['ENFP', 'INFJ'], ['INFJ', 'INTP'], ['INFP', 'INFJ'],
    ['ENFP', 'INTP'], ['ENTP', 'INFJ'], ['ENFJ', 'INFP'], ['ISFJ', 'ENFP'],
    ['ISTJ', 'ISFJ'], ['ISFP', 'INFP'], ['ESTP', 'ENFP'], ['ESFP', 'ENFJ'],
    ['ISTP', 'INFP'], ['INTP', 'ENTJ'], ['ENTP', 'INTJ'], ['ISFP', 'ESFJ'],
    ['ISTP', 'ESTJ'], ['ISFJ', 'ESFP'], ['ISTJ', 'ESTP'], ['INTJ', 'ENFP'],
    ['INTP', 'INFJ'], ['ESFJ', 'ISFP'], ['ESTJ', 'ISTP'], ['ESFP', 'ISFJ'],
    ['ESTP', 'ISTJ'], ['ENFJ', 'ISFP'], ['ENFP', 'ISFJ'], ['ENTJ', 'INFP'],
    ['INTJ', 'ENFJ'], ['ENFP', 'ENFP'], ['ENTP', 'ENTP'], ['INFP', 'INTP'],
    // â¬‡ æ‹¡å¼µã“ã“ã‹ã‚‰
    ['ISFJ', 'ISTP'], ['INFJ', 'ENFJ'], ['ISFP', 'ENFP'], ['ENFP', 'ISFP'],
    ['ISTJ', 'ENTP'], ['ISTP', 'ENFP'], ['ESTJ', 'ENFJ'], ['INTP', 'ENTP'],
    ['ENTP', 'ISFJ'], ['ESFP', 'ISFP'], ['ISFP', 'ISFP'], ['INTP', 'ISFP'],
    ['INFP', 'INFP'], ['ENFJ', 'ENFJ'], ['ESTJ', 'ISTJ'], ['ISTP', 'ISFJ'],
    ['INFJ', 'ISFP'], ['ISFJ', 'INFJ'], ['ENFP', 'ISTP'], ['INTJ', 'INFP']
  ];


  if (mbti1 === mbti2) return 'ä¼¼ãŸã‚‚ã®åŒå£«ã§å®‰å¿ƒæ„Ÿãƒãƒƒãƒãƒªï¼';
  for (const [a, b] of perfectPairs) {
    if ((mbti1 === a && mbti2 === b) || (mbti1 === b && mbti2 === a)) {
      return 'ãƒãƒ©ãƒ³ã‚¹æœ€é«˜ï¼ç†æƒ³ã®ãƒšã‚¢ï¼';
    }
  }
  return 'ä¾¡å€¤è¦³ã®é•ã„ã‚‚æ¥½ã—ã‚ã‚‹é–¢ä¿‚ï¼';
}


function getCompatibilityScore(m1, m2) {
  let score = 50;
  if (m1 === m2) return 90;
  const pairs = ['IE', 'NS', 'TF', 'JP'];
  for (let i = 0; i < 4; i++) {
    if (m1[i] === m2[i]) score += 10;
    else score -= 5;
  }
  return Math.max(0, Math.min(100, score));
}
function getCompatibilityComment(mbti1, mbti2) {
  const key = [mbti1, mbti2].sort().join('-');

  const commentMap = {
    'INFP-ENFJ': 'ãŠäº’ã„ã®æ„Ÿæ€§ã«æƒ¹ã‹ã‚Œåˆã„ã€è‡ªç„¶ã¨æ”¯ãˆåˆãˆã‚‹é–¢ä¿‚ï¼',
    'ENFP-INFJ': 'è‡ªç”±ã¨æ·±ã•ã®ãƒãƒ©ãƒ³ã‚¹ãŒçµ¶å¦™ãªç›¸æ€§ï¼',
    'INFJ-INTP': 'ç†æƒ³ã¨è«–ç†ã®èåˆã§ã€æ·±ã„å¯¾è©±ãŒæ­¢ã¾ã‚‰ãªã„ï¼',
    'INFP-INFJ': 'æ„Ÿå—æ€§ã®æ³¢é•·ãŒã´ã£ãŸã‚Šåˆã†ç™’ã—ç³»ã‚³ãƒ³ãƒ“ï¼',
    'ENFP-INTP': 'çªé£›ãªã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ä¸€ç·’ã«é£›èºã•ã›ã‚‰ã‚Œã‚‹é–¢ä¿‚ï¼',
    'ENTP-INFJ': 'ç™ºæƒ³åŠ›ã¨å…±æ„ŸåŠ›ãŒäº¤å·®ã™ã‚‹åˆºæ¿€çš„ãªé–¢ä¿‚ï¼',
    'ENFJ-INFP': 'æ€ã„ã‚„ã‚Šã¨æŸ”ã‚‰ã‹ã•ãŒå…±é³´ã™ã‚‹ã‚ã£ãŸã‹ãƒšã‚¢ï¼',
    'ISFJ-ENFP': 'æ…é‡ã•ã¨å†’é™ºå¿ƒã®ã„ã„ãƒãƒ©ãƒ³ã‚¹ï¼',
    'ISTJ-ISFJ': 'å®‰å®šã¨å®‰å¿ƒã‚’ç”Ÿã‚€ç‹é“ãƒšã‚¢ï¼',
    'ISFP-INFP': 'å…±æ„ŸåŠ›ã«æº¢ã‚ŒãŸã‚„ã•ã—ã•å…¨é–‹ã‚³ãƒ³ãƒ“ï¼',
    'ESTP-ENFP': 'è¡Œå‹•æ´¾ã¨å¤¢æƒ³å®¶ãŒã¶ã¤ã‹ã‚ŠãªãŒã‚‰ã‚‚æƒ¹ã‹ã‚Œåˆã†ï¼',
    'ESFP-ENFJ': 'æ˜ã‚‹ã•ã¨é¢å€’è¦‹ã®è‰¯ã•ã§å‘¨ã‚Šã‚‚ç¬‘é¡”ã«ï¼',
    'ISTP-INFP': 'é™ã¨å‹•ã®çµ„ã¿åˆã‚ã›ãŒæ„å¤–ã¨å¿ƒåœ°ã„ã„ï¼',
    'INTP-ENTJ': 'è¨ˆç”»ã¨æ§‹æƒ³ãŒå™›ã¿åˆã†æˆ¦ç•¥çš„ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ï¼',
    'ENTP-INTJ': 'æœªæ¥ã‚’èªã‚ŠãŸããªã‚‹çŸ¥çš„ãƒšã‚¢ï¼',
    'ISFP-ESFJ': 'è‡ªç„¶ä½“ã¨æ°—é…ã‚Šã®çµ¶å¦™ãªã‚³ãƒ³ãƒ“ï¼',
    'ISTP-ESTJ': 'ç¾å®Ÿçš„ã‹ã¤ä¿¡é ¼ã§ãã‚‹ã‚¿ãƒƒã‚°ï¼',
    'ISFJ-ESFP': 'ç©ã‚„ã‹Ã—ç¤¾äº¤çš„ã®ç™’ã—ã¨å…ƒæ°—ã‚»ãƒƒãƒˆï¼',
    'ISTJ-ESTP': 'å†·é™ã¨æƒ…ç†±ã®é–“ã«æ„å¤–ãªèª¿å’Œï¼',
    'INTJ-ENFP': 'å†…ãªã‚‹æƒ…ç†±ã‚’å…±æœ‰ã§ãã‚‹å¤‰åŒ–æ¨é€²ã‚³ãƒ³ãƒ“ï¼',
    'INTP-INFJ': 'æ·±ã„æ€ç´¢ã‚’æ¥½ã—ã‚ã‚‹ç²¾ç¥çš„ã¤ãªãŒã‚Šï¼',
    'ESFJ-ISFP': 'æŸ”ã‚‰ã‹ãã¦å®‰å¿ƒã§ãã‚‹åŒ…å®¹åŠ›ãƒšã‚¢ï¼',
    'ESTJ-ISTP': 'é ¼ã‚Œã‚‹å®Ÿå‹™å®¶åŒå£«ã§ä»•äº‹ãƒãƒƒãƒãƒªï¼',
    'ESFP-ISFJ': 'æ„Ÿæƒ…ã¨å®‰å®šæ„ŸãŒå¯„ã‚Šæ·»ã†ã‚ãŸãŸã‹ãƒšã‚¢ï¼',
    'ESTP-ISTJ': 'ä¿¡é ¼ã¨ã‚¹ãƒ”ãƒ¼ãƒ‰ã®ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—ï¼',
    'ENFJ-ISFP': 'é¢å€’è¦‹ã®è‰¯ã•ã¨æ„Ÿæ€§ãŒæº¶ã‘åˆã†ï¼',
    'ENFP-ISFJ': 'å†’é™ºã¨å®‰å¿ƒãŒäº¤å·®ã™ã‚‹ã»ã®ã¼ã®é–¢ä¿‚ï¼',
    'ENTJ-INFP': 'ã‚«ãƒªã‚¹ãƒã¨ç™’ã—ã®ä¸æ€è­°ãªåŒ–å­¦åå¿œï¼',
    'INTJ-ENFJ': 'è«–ç†ã¨äººæƒ…ã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ï¼',
    'ENFP-ENFP': 'ãƒãƒªã¨å‹¢ã„ãŒæ­¢ã¾ã‚‰ãªã„ç„¡é™ãƒ«ãƒ¼ãƒ—ï¼',
    'ENTP-ENTP': 'è©±ãŒå°½ããªã„åˆºæ¿€çš„ãªãƒšã‚¢ï¼',
    'INFP-INTP': 'ç¹Šç´°ã•ã¨æ¢ç©¶å¿ƒã§é™ã‹ã«ç››ã‚Šä¸ŠãŒã‚‹ï¼'
  };

  return commentMap[key] || 'ç›¸æ‰‹ã®é•ã„ã‚’ç†è§£ã—ãªãŒã‚‰ã€æˆé•·ã§ãã‚‹é–¢ä¿‚ï¼';
}
function getDetailData(my, other) {
  const key = [my, other].sort().join('-');

  const detailMap = {
    'INFP-ENFJ': {
      scores: [90, 85, 80, 95, 70],
      texts: [
        'è‡ªç„¶ä½“ã§è©±ã›ã‚‹å‹é”æ„Ÿè¦šãŒâ—',
        'ä¸€ç·’ã«ã„ã‚‹ã ã‘ã§ãƒ‰ã‚­ãƒ‰ã‚­ã§ãã‚‹ç›¸æ€§ï¼',
        'å…±ã«æˆé•·ã—åˆãˆã‚‹æœ€é«˜ã®ç›¸æ£’ï¼',
        'ä¾¡å€¤è¦³ãŒä¼¼ã¦ã„ã¦å±…å¿ƒåœ°ãŒã¨ã¦ã‚‚è‰¯ã„',
        'ç››ã‚Šä¸ŠãŒã‚Šã™ããšã€å¿ƒåœ°ã‚ˆã„ãƒ†ãƒ³ã‚·ãƒ§ãƒ³æ„Ÿ'
      ]
    },
    'ENFP-INFJ': {
      scores: [88, 84, 79, 92, 75],
      texts: [
        'ç›´æ„ŸåŒå£«ã§å…±é³´ã—ã‚„ã™ãä¼šè©±ãŒå°½ããªã„ï¼',
        'ã¡ã‚‡ã£ã¨ã—ãŸè¡¨æƒ…ã§ã‚‚å¿ƒã‚’èª­ã¿å–ã‚Œã‚‹ä»²ã«',
        'ä¸€ç·’ã«å¤¢ã‚’èªã‚Œã‚‹ç†æƒ³çš„ãªã‚³ãƒ³ãƒ“',
        'ç›¸æ‰‹ã®æ„Ÿæƒ…ã‚’è‡ªç„¶ã¨å¯Ÿã—åˆãˆã‚‹é–¢ä¿‚æ€§',
        'æ°—åˆ†ã®ç››ã‚Šä¸ŠãŒã‚Šæ–¹ã‚‚æ³¢é•·ãƒ”ãƒƒã‚¿ãƒªï¼'
      ]
    },
    'INTP-ENTP': {
      scores: [78, 70, 85, 80, 82],
      texts: [
        'ã‚¢ã‚¤ãƒ‡ã‚¢ãŒæ­¢ã¾ã‚‰ãªã„çŸ¥çš„ãƒšã‚¢ï¼',
        'ä¸€ç·’ã«æœªæ¥ã®è©±ã‚’ã™ã‚‹ã®ãŒæ¥½ã—ã„',
        'è«–ç†çš„ã ã‘ã©è‡ªç”±ã§ãƒ©ãƒ•ãªé–¢ä¿‚ãŒç¯‰ã‘ã‚‹',
        'ç„¡ç†ã«å¹²æ¸‰ã—ãªã„å¿ƒåœ°ã‚ˆã•ãŒâ—',
        'ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã®é«˜ã•ã‚‚æ„å¤–ã¨åˆã†ï¼'
      ]
    },
    'ISFP-ESFJ': {
      scores: [84, 76, 78, 88, 80],
      texts: [
        'å†…å‘ã¨å¤–å‘ã®ãƒãƒ©ãƒ³ã‚¹ãŒçµ¶å¦™ï¼',
        'è¡¨æƒ…ã‚„ã—ãã•ã§é€šã˜åˆãˆã‚‹å®‰å¿ƒæ„Ÿã‚ã‚Š',
        'ãŠäº’ã„ã«æ”¯ãˆåˆã„ãŸããªã‚‹çµ„ã¿åˆã‚ã›',
        'ãµã¨ã—ãŸå„ªã—ã•ã«ç™’ã•ã‚Œã‚‹é–¢ä¿‚',
        'ãŠäº’ã„ã®é•ã„ã‚’æ¥½ã—ã‚ã‚‹æŸ”ã‚‰ã‹ãƒšã‚¢'
      ]
    },
    'INTJ-ENFP': {
      scores: [82, 79, 90, 76, 74],
      texts: [
        'å†…å‘Ã—å¤–å‘ã ã‘ã©ç›®çš„æ„è­˜ãŒåˆã†ï¼',
        'ç›´æ„Ÿæ´¾åŒå£«ã§åˆºæ¿€ã—åˆãˆã‚‹ç›¸æ€§',
        'ã—ã£ã‹ã‚Šè€…ã¨è‡ªç”±äººã®çµ¶å¦™ã‚³ãƒ³ãƒ“',
        'æ„å¤–ãªå…±é€šç‚¹ã«é©šãã“ã¨ãŒå¤šã„ã‹ã‚‚ï¼Ÿ',
        'ãƒ†ãƒ³ã‚·ãƒ§ãƒ³å·®ã‚‚æ„å¤–ã¨å¿ƒåœ°ã‚ˆã„'
      ]
    },
    'ISTJ-ISFJ': {
      scores: [85, 68, 74, 88, 70],
      texts: [
        'å®‰å®šæ„ŸæŠœç¾¤ï¼ä¾¡å€¤è¦³ãŒè¿‘ãã¦å®‰å¿ƒã§ãã‚‹',
        'ç©ã‚„ã‹ãªæ™‚é–“ã‚’å…±æœ‰ã§ãã‚‹é–¢ä¿‚',
        'ãŠäº’ã„ã®ãƒšãƒ¼ã‚¹ã‚’å¤§åˆ‡ã«ã§ãã‚‹',
        'æ—¥å¸¸ã®å°ã•ãªå¹¸ã›ã‚’æ„Ÿã˜ã‚„ã™ã„ãƒšã‚¢',
        'æ´¾æ‰‹ã•ã¯ãªã„ã‘ã©ã€ä¿¡é ¼åº¦ã¯æœ€é«˜'
      ]
    },
    'ENFP-ISTP': {
      scores: [76, 72, 85, 70, 78],
      texts: [
        'æ€§æ ¼ã¯çœŸé€†ã ã‘ã©ãªãœã‹æ°—ã«ãªã‚‹å­˜åœ¨',
        'ä¸€ç·’ã«ã„ã‚‹ã¨æ–°ã—ã„ä¾¡å€¤è¦³ã«è§¦ã‚Œã‚‰ã‚Œã‚‹',
        'ãŠäº’ã„ã®é•·æ‰€ã‚’è£œãˆã‚‹ç›¸æ€§',
        'ã¨ãã«æ„è¦‹ãŒã¶ã¤ã‹ã‚‹ã‘ã©æˆé•·ã«ã¤ãªãŒã‚‹',
        'ãƒãƒªã¨å†·é™ã•ã®ã‚®ãƒ£ãƒƒãƒ—ãŒé¢ç™½ã„ï¼'
      ]
    },
    'ENTJ-INFP': {
      scores: [79, 80, 82, 76, 70],
      texts: [
        'ç›®æ¨™ã«å‘ã‹ã£ã¦é€²ã¿ãŸã„æ´¾ã¨æ”¯ãˆãŸã„æ´¾',
        'æ„è¦‹ã®é•ã„ã‚‚åˆºæ¿€ã¨ã—ã¦æ¥½ã—ã‚ã‚‹ï¼',
        'å¯¾ç­‰ãªç«‹å ´ã§å°Šé‡ã—åˆãˆã‚‹é–¢ä¿‚',
        'å¼±ã•ã‚’è¦‹ã›ã¦ã‚‚å—ã‘å…¥ã‚Œã¦ã‚‚ã‚‰ãˆã‚‹å®‰å¿ƒæ„Ÿ',
        'å‹¢ã„ã¨å„ªã—ã•ã®ãƒãƒ©ãƒ³ã‚¹ãŒã„ã„'
      ]
    },
    'ISFP-INFP': {
      scores: [85, 75, 70, 85, 76],
      texts: [
        'æ„Ÿå—æ€§ãŒä¼¼ã¦ã„ã¦å®‰å¿ƒã§ãã‚‹ç›¸æ€§',
        'ç©ºæ°—æ„Ÿã§é€šã˜åˆãˆã‚‹ã‚ˆã†ãªé–¢ä¿‚',
        'ç„¡ç†ã›ãšè‡ªç„¶ä½“ã§ã„ã‚‰ã‚Œã‚‹ã‚³ãƒ³ãƒ“',
        'ã¡ã‚‡ã£ã¨ã—ãŸä»•è‰ã«ã‚­ãƒ¥ãƒ³ã¨ã™ã‚‹ã“ã¨ã‚‚',
        'é™ã‹ã ã‘ã©æ·±ã„ã¤ãªãŒã‚Šã‚’æ„Ÿã˜ã‚‰ã‚Œã‚‹'
      ]
    },
    'ESTP-ENFJ': {
      scores: [88, 84, 83, 80, 82],
      texts: [
        'ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ã¨ãƒªãƒ¼ãƒ€ãƒ¼ã®æœ€å¼·ã‚¿ãƒƒã‚°ï¼',
        'ã©ã‚“ãªå ´é¢ã§ã‚‚ç››ã‚Šä¸ŠãŒã‚Œã‚‹ã‚³ãƒ³ãƒ“',
        'ç›¸æ‰‹ã‚’å¼•ã£å¼µã‚‹åŠ›ã¨æ”¯ãˆã‚‹åŠ›ã®ç›¸ä¹—åŠ¹æœ',
        'è¨€è‘‰ã‚ˆã‚Šè¡Œå‹•ã§æ°—æŒã¡ãŒä¼ã‚ã‚‹é–¢ä¿‚',
        'ä¸€ç·’ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚„ä¼ç”»ã‚‚æ¥½ã—ãã§ãã‚‹ï¼'
      ]
    },
    'ENFP-ISTJ': {
      scores: [0, 0, 0, 0, 0],
      texts: [
        'è‡ªç”±äººã¨å …å®Ÿæ´¾ã€ä¾¡å€¤è¦³ãŒã™ã‚Œé•ã„ãŒã¡â€¦ï¼',
        'ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã®å·®ã§å™›ã¿åˆã‚ãªã„ã“ã¨ã‚‚å¤šã„ã‹ã‚‚',
        'ã§ã‚‚é€†ã«ã€ãŠäº’ã„ã«ãªã„ã‚‚ã®ã‚’æŒã£ã¦ã„ã‚‹é–¢ä¿‚ï¼',
        'è©±ã—åˆã„ãŒå¤§äº‹ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œãªã„ç›¸æ€§ï¼',
        'ã“ã“ã‹ã‚‰ä»²è‰¯ããªã‚ŒãŸã‚‰æœ€å¼·èª¬ã‚¢ãƒª'
      ]
    },
    'ESTJ-INFP': {
      scores: [0, 0, 0, 0, 0],
      texts: [
        'ç†æƒ³ã¨ç¾å®ŸãŒçœŸã£å‘ã‹ã‚‰ã¶ã¤ã‹ã‚‹ã‹ã‚‚â€¦ï¼ï¼Ÿ',
        'è¨ˆç”»æ€§ã®é•ã„ãŒã™ã‚Œé•ã„ã‚’ç”Ÿã‚€å¯èƒ½æ€§å¤§',
        'è©±ãŒå™›ã¿åˆã‚ãªã„ã“ã¨ã‚‚å¤šã„ã‘ã©ã€ãã‚Œã‚‚å€‹æ€§ï¼',
        'ä¸€ç·’ã«ã„ã‚‹ã¨ã€ãŠäº’ã„ã®ä¾¡å€¤è¦³ã‚’å­¦ã¹ã‚‹é–¢ä¿‚ã‹ã‚‚',
        'é€†ã«ã“ã“ã‹ã‚‰ä»²è‰¯ããªã£ãŸã‚‰ãƒ‰ãƒ©ãƒãƒãƒƒã‚¯ï¼ï¼Ÿ'
      ]
    }
  };

  return detailMap[key] || {
    scores: [72, 72, 72, 72, 72],
    comments: [
      'ä¼šè©±ã‚’é€šã˜ã¦å¾ã€…ã«æ‰“ã¡è§£ã‘ã‚‹é–¢ä¿‚ï¼',
      'ãŠäº’ã„ã®é•ã„ã‚’æ¥½ã—ã‚ã‚‹ç›¸æ€§ï¼',
      'ä¸€ç·’ã«æ–°ã—ã„ç™ºè¦‹ãŒã§ããã†ï¼',
      'å®‰å¿ƒæ„Ÿã¯ã“ã‚Œã‹ã‚‰ä½œã£ã¦ã„ãæ„Ÿã˜ï¼',
      'åˆºæ¿€ã‚ˆã‚Šå®‰å®šæ„Ÿé‡è¦–ãªé›°å›²æ°—ï¼'
    ]
  };
}

function showCompatibilityModal(my, other, message, score) {
  const comment = getCompatibilityComment(my, other); 
  const modal = document.createElement('div');
  modal.id = 'compat-modal';
  modal.style.cssText = `
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    opacity: 0;
    transition: opacity 0.8s ease;
  `;

  modal.innerHTML = `
    <div style="
      background: #fff;
      padding: 24px;
      border-radius: 16px;
      font-family: 'Comic Sans MS', cursive;
      text-align: center;
      box-shadow: 0 8px 16px rgba(0,0,0,0.25);
      max-width: 90vw;
      animation: popIn 0.6s ease forwards;
    ">
      <div style="font-size: 20px; font-weight: bold; color: #e91e63; margin-bottom: 6px;">
        2äººã®ç›¸æ€§åº¦
      </div>

      <div style="font-size: 36px; font-weight: bold; color: #ff3366; margin-bottom: 12px;">
        ${score}% 
      </div>

      <div style="font-size: 16px; margin-bottom: 6px;">
        ã‚ãªãŸï¼ˆ${my}ï¼‰ã¨ã“ã®äººï¼ˆ${other}ï¼‰ã®ç›¸æ€§ã¯â€¦
      </div>

      <div style="font-size: 20px; color: #e91e63; font-weight: bold; margin-bottom: 8px;">
        ${message}
      </div>

      <div style="font-size: 16px; color: #555; font-style: italic;">
        ${comment}
      </div>

      <div style="margin-top: 24px;">
        <button onclick="document.getElementById('compat-modal').remove()" style="
          padding: 8px 16px;
          background: #ccc;
          color: #333;
          border: none;
          border-radius: 8px;
          cursor: pointer;
        ">é–‰ã˜ã‚‹</button>

        <button onclick="showDetailModal('${my}', '${other}')" style="
          margin-left: 12px;
          padding: 8px 16px;
          background: #2196f3;
          color: white;
          border: none;
          border-radius: 8px;
          cursor: pointer;
        ">è©³ç´°ã‚’è¦‹ã‚‹</button>
      </div>
    </div>
  `;

  document.body.appendChild(modal);

  // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³
  setTimeout(() => {
    modal.style.opacity = '1';
  }, 50);
}

function getDetailData(my, other) {
  const key = [my, other].sort().join('-');

  const detailMap = {
    'INFP-ENFJ': {
      scores: [90, 85, 80, 95, 70],
      texts: [
        'è‡ªç„¶ä½“ã§è©±ã›ã‚‹å‹é”æ„Ÿè¦šãŒâ—',
        'ä¸€ç·’ã«ã„ã‚‹ã ã‘ã§ãƒ‰ã‚­ãƒ‰ã‚­ã§ãã‚‹ç›¸æ€§ï¼',
        'å…±ã«æˆé•·ã—åˆãˆã‚‹æœ€é«˜ã®ç›¸æ£’ï¼',
        'ä¾¡å€¤è¦³ãŒä¼¼ã¦ã„ã¦å±…å¿ƒåœ°ãŒã¨ã¦ã‚‚è‰¯ã„',
        'ç››ã‚Šä¸ŠãŒã‚Šã™ããšã€å¿ƒåœ°ã‚ˆã„ãƒ†ãƒ³ã‚·ãƒ§ãƒ³æ„Ÿ'
      ]
    },
    'ENFP-INFJ': {
      scores: [88, 84, 79, 92, 75],
      texts: [
        'ç›´æ„ŸåŒå£«ã§å…±é³´ã—ã‚„ã™ãä¼šè©±ãŒå°½ããªã„ï¼',
        'ã¡ã‚‡ã£ã¨ã—ãŸè¡¨æƒ…ã§ã‚‚å¿ƒã‚’èª­ã¿å–ã‚Œã‚‹ä»²ã«',
        'ä¸€ç·’ã«å¤¢ã‚’èªã‚Œã‚‹ç†æƒ³çš„ãªã‚³ãƒ³ãƒ“',
        'ç›¸æ‰‹ã®æ„Ÿæƒ…ã‚’è‡ªç„¶ã¨å¯Ÿã—åˆãˆã‚‹é–¢ä¿‚æ€§',
        'æ°—åˆ†ã®ç››ã‚Šä¸ŠãŒã‚Šæ–¹ã‚‚æ³¢é•·ãƒ”ãƒƒã‚¿ãƒªï¼'
      ]
    },
    'INTP-ENTP': {
      scores: [78, 70, 85, 80, 82],
      texts: [
        'ã‚¢ã‚¤ãƒ‡ã‚¢ãŒæ­¢ã¾ã‚‰ãªã„çŸ¥çš„ãƒšã‚¢ï¼',
        'ä¸€ç·’ã«æœªæ¥ã®è©±ã‚’ã™ã‚‹ã®ãŒæ¥½ã—ã„',
        'è«–ç†çš„ã ã‘ã©è‡ªç”±ã§ãƒ©ãƒ•ãªé–¢ä¿‚ãŒç¯‰ã‘ã‚‹',
        'ç„¡ç†ã«å¹²æ¸‰ã—ãªã„å¿ƒåœ°ã‚ˆã•ãŒâ—',
        'ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã®é«˜ã•ã‚‚æ„å¤–ã¨åˆã†ï¼'
      ]
    },
    'ISFP-ESFJ': {
      scores: [84, 76, 78, 88, 80],
      texts: [
        'å†…å‘ã¨å¤–å‘ã®ãƒãƒ©ãƒ³ã‚¹ãŒçµ¶å¦™ï¼',
        'è¡¨æƒ…ã‚„ã—ãã•ã§é€šã˜åˆãˆã‚‹å®‰å¿ƒæ„Ÿã‚ã‚Š',
        'ãŠäº’ã„ã«æ”¯ãˆåˆã„ãŸããªã‚‹çµ„ã¿åˆã‚ã›',
        'ãµã¨ã—ãŸå„ªã—ã•ã«ç™’ã•ã‚Œã‚‹é–¢ä¿‚',
        'ãŠäº’ã„ã®é•ã„ã‚’æ¥½ã—ã‚ã‚‹æŸ”ã‚‰ã‹ãƒšã‚¢'
      ]
    },
    'INTJ-ENFP': {
      scores: [82, 79, 90, 76, 74],
      texts: [
        'å†…å‘Ã—å¤–å‘ã ã‘ã©ç›®çš„æ„è­˜ãŒåˆã†ï¼',
        'ç›´æ„Ÿæ´¾åŒå£«ã§åˆºæ¿€ã—åˆãˆã‚‹ç›¸æ€§',
        'ã—ã£ã‹ã‚Šè€…ã¨è‡ªç”±äººã®çµ¶å¦™ã‚³ãƒ³ãƒ“',
        'æ„å¤–ãªå…±é€šç‚¹ã«é©šãã“ã¨ãŒå¤šã„ã‹ã‚‚ï¼Ÿ',
        'ãƒ†ãƒ³ã‚·ãƒ§ãƒ³å·®ã‚‚æ„å¤–ã¨å¿ƒåœ°ã‚ˆã„'
      ]
    },
    'ISTJ-ISFJ': {
      scores: [85, 68, 74, 88, 70],
      texts: [
        'å®‰å®šæ„ŸæŠœç¾¤ï¼ä¾¡å€¤è¦³ãŒè¿‘ãã¦å®‰å¿ƒã§ãã‚‹',
        'ç©ã‚„ã‹ãªæ™‚é–“ã‚’å…±æœ‰ã§ãã‚‹é–¢ä¿‚',
        'ãŠäº’ã„ã®ãƒšãƒ¼ã‚¹ã‚’å¤§åˆ‡ã«ã§ãã‚‹',
        'æ—¥å¸¸ã®å°ã•ãªå¹¸ã›ã‚’æ„Ÿã˜ã‚„ã™ã„ãƒšã‚¢',
        'æ´¾æ‰‹ã•ã¯ãªã„ã‘ã©ã€ä¿¡é ¼åº¦ã¯æœ€é«˜'
      ]
    },
    'ENFP-ISTP': {
      scores: [76, 72, 85, 70, 78],
      texts: [
        'æ€§æ ¼ã¯çœŸé€†ã ã‘ã©ãªãœã‹æ°—ã«ãªã‚‹å­˜åœ¨',
        'ä¸€ç·’ã«ã„ã‚‹ã¨æ–°ã—ã„ä¾¡å€¤è¦³ã«è§¦ã‚Œã‚‰ã‚Œã‚‹',
        'ãŠäº’ã„ã®é•·æ‰€ã‚’è£œãˆã‚‹ç›¸æ€§',
        'ã¨ãã«æ„è¦‹ãŒã¶ã¤ã‹ã‚‹ã‘ã©æˆé•·ã«ã¤ãªãŒã‚‹',
        'ãƒãƒªã¨å†·é™ã•ã®ã‚®ãƒ£ãƒƒãƒ—ãŒé¢ç™½ã„ï¼'
      ]
    },
    'ENTJ-INFP': {
      scores: [79, 80, 82, 76, 70],
      texts: [
        'ç›®æ¨™ã«å‘ã‹ã£ã¦é€²ã¿ãŸã„æ´¾ã¨æ”¯ãˆãŸã„æ´¾',
        'æ„è¦‹ã®é•ã„ã‚‚åˆºæ¿€ã¨ã—ã¦æ¥½ã—ã‚ã‚‹ï¼',
        'å¯¾ç­‰ãªç«‹å ´ã§å°Šé‡ã—åˆãˆã‚‹é–¢ä¿‚',
        'å¼±ã•ã‚’è¦‹ã›ã¦ã‚‚å—ã‘å…¥ã‚Œã¦ã‚‚ã‚‰ãˆã‚‹å®‰å¿ƒæ„Ÿ',
        'å‹¢ã„ã¨å„ªã—ã•ã®ãƒãƒ©ãƒ³ã‚¹ãŒã„ã„'
      ]
    },
    'ISFP-INFP': {
      scores: [85, 75, 70, 85, 76],
      texts: [
        'æ„Ÿå—æ€§ãŒä¼¼ã¦ã„ã¦å®‰å¿ƒã§ãã‚‹ç›¸æ€§',
        'ç©ºæ°—æ„Ÿã§é€šã˜åˆãˆã‚‹ã‚ˆã†ãªé–¢ä¿‚',
        'ç„¡ç†ã›ãšè‡ªç„¶ä½“ã§ã„ã‚‰ã‚Œã‚‹ã‚³ãƒ³ãƒ“',
        'ã¡ã‚‡ã£ã¨ã—ãŸä»•è‰ã«ã‚­ãƒ¥ãƒ³ã¨ã™ã‚‹ã“ã¨ã‚‚',
        'é™ã‹ã ã‘ã©æ·±ã„ã¤ãªãŒã‚Šã‚’æ„Ÿã˜ã‚‰ã‚Œã‚‹'
      ]
    },
    'ESTP-ENFJ': {
      scores: [88, 84, 83, 80, 82],
      texts: [
        'ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ã¨ãƒªãƒ¼ãƒ€ãƒ¼ã®æœ€å¼·ã‚¿ãƒƒã‚°ï¼',
        'ã©ã‚“ãªå ´é¢ã§ã‚‚ç››ã‚Šä¸ŠãŒã‚Œã‚‹ã‚³ãƒ³ãƒ“',
        'ç›¸æ‰‹ã‚’å¼•ã£å¼µã‚‹åŠ›ã¨æ”¯ãˆã‚‹åŠ›ã®ç›¸ä¹—åŠ¹æœ',
        'è¨€è‘‰ã‚ˆã‚Šè¡Œå‹•ã§æ°—æŒã¡ãŒä¼ã‚ã‚‹é–¢ä¿‚',
        'ä¸€ç·’ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚„ä¼ç”»ã‚‚æ¥½ã—ãã§ãã‚‹ï¼'
      ]
    },
    'ENFP-ISTJ': {
      scores: [0, 0, 0, 0, 0],
      texts: [
        'è‡ªç”±äººã¨å …å®Ÿæ´¾ã€ä¾¡å€¤è¦³ãŒã™ã‚Œé•ã„ãŒã¡â€¦ï¼',
        'ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã®å·®ã§å™›ã¿åˆã‚ãªã„ã“ã¨ã‚‚å¤šã„ã‹ã‚‚',
        'ã§ã‚‚é€†ã«ã€ãŠäº’ã„ã«ãªã„ã‚‚ã®ã‚’æŒã£ã¦ã„ã‚‹é–¢ä¿‚ï¼',
        'è©±ã—åˆã„ãŒå¤§äº‹ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œãªã„ç›¸æ€§ï¼',
        'ã“ã“ã‹ã‚‰ä»²è‰¯ããªã‚ŒãŸã‚‰æœ€å¼·èª¬ã‚¢ãƒª'
      ]
    },
    'ESTJ-INFP': {
      scores: [0, 0, 0, 0, 0],
      texts: [
        'ç†æƒ³ã¨ç¾å®ŸãŒçœŸã£å‘ã‹ã‚‰ã¶ã¤ã‹ã‚‹ã‹ã‚‚â€¦ï¼ï¼Ÿ',
        'è¨ˆç”»æ€§ã®é•ã„ãŒã™ã‚Œé•ã„ã‚’ç”Ÿã‚€å¯èƒ½æ€§å¤§',
        'è©±ãŒå™›ã¿åˆã‚ãªã„ã“ã¨ã‚‚å¤šã„ã‘ã©ã€ãã‚Œã‚‚å€‹æ€§ï¼',
        'ä¸€ç·’ã«ã„ã‚‹ã¨ã€ãŠäº’ã„ã®ä¾¡å€¤è¦³ã‚’å­¦ã¹ã‚‹é–¢ä¿‚ã‹ã‚‚',
        'é€†ã«ã“ã“ã‹ã‚‰ä»²è‰¯ããªã£ãŸã‚‰ãƒ‰ãƒ©ãƒãƒãƒƒã‚¯ï¼ï¼Ÿ'
      ]
    }
  };

  return detailMap[key] || {
    scores: [72, 72, 72, 72, 72],
    comments: [
      'ä¼šè©±ã‚’é€šã˜ã¦å¾ã€…ã«æ‰“ã¡è§£ã‘ã‚‹é–¢ä¿‚ï¼',
      'ãŠäº’ã„ã®é•ã„ã‚’æ¥½ã—ã‚ã‚‹ç›¸æ€§ï¼',
      'ä¸€ç·’ã«æ–°ã—ã„ç™ºè¦‹ãŒã§ããã†ï¼',
      'å®‰å¿ƒæ„Ÿã¯ã“ã‚Œã‹ã‚‰ä½œã£ã¦ã„ãæ„Ÿã˜ï¼',
      'åˆºæ¿€ã‚ˆã‚Šå®‰å®šæ„Ÿé‡è¦–ãªé›°å›²æ°—ï¼'
    ]
  };
}


function showDetailModal(myMbti, otherMbti) {
  const modal = document.getElementById('compat-detail-modal');
  modal.style.display = 'flex';

  const ctx = document.getElementById('compat-radar').getContext('2d');
  const data = getDetailData(myMbti, otherMbti);
  const labels = ['ä»²è‰¯ã—', 'ã¨ãã‚ã', 'ç›¸æ£’åŠ›', 'è½ã¡ç€ã', 'ç››ã‚Šä¸ŠãŒã‚Š'];

  if (window.currentRadarChart) {
    window.currentRadarChart.destroy();
  }

  window.currentRadarChart = new Chart(ctx, {
    type: 'radar',
    data: {
      labels: labels,
      datasets: [{
        label: 'ç›¸æ€§ã‚¹ã‚³ã‚¢',
        data: data.scores,
        backgroundColor: 'rgba(255, 99, 132, 0.2)',
        borderColor: '#e91e63',
        pointBackgroundColor: '#e91e63'
      }]
    },
    options: {
      responsive: false,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false }
      },
      scales: {
        r: {
          suggestedMin: 0,
          suggestedMax: 100,
          ticks: { display: false },
          pointLabels: {
            font: { size: 10, family: 'Comic Sans MS' },
            color: '#e91e63',
            padding: 5
          },
          grid: { color: 'rgba(0,0,0,0.1)' },
          angleLines: { display: true }
        }
      }
    }
  });

  const detailText = labels.map((label, i) => `
    <div style="margin-bottom: 16px;">
      <div style="font-weight: bold; color: #e91e63; font-size: 16px;">
        ${label}ï¼š${data.scores[i]}%
      </div>
      <div style="color: #555; font-size: 14px;">
        ${data.comments[i]}
      </div>
    </div>
  `).join('');

  const detailBox = document.getElementById('compat-detail-text');
  if (detailBox) {
    detailBox.innerHTML = detailText;
    detailBox.style.textAlign = 'left';
    detailBox.style.paddingLeft = '16px';
  } else {
    console.error('compat-detail-text ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸã‚ˆï¼');
  }
}

</script>

<!-- â–¼ ç›¸æ€§ã®è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="compat-detail-modal" style="
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background-color: rgba(0, 0, 0, 0.7);
  z-index: 10000;
  overflow-y: auto;
  padding: 40px 16px;
  box-sizing: border-box;
  align-items: center;
  justify-content: flex-start;
  flex-direction: column;
">

 <!-- ğŸ”´ ãƒãƒ£ãƒ¼ãƒˆãƒœãƒƒã‚¯ã‚¹ -->
<div style="
  background: #ffe6f0;
  border-radius: 20px;
  padding: 32px 20px;
  margin-bottom: 24px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.2);
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: flex-start;  /* â† ä¸­å¤® â†’ å·¦ä¸Šå¯„ã›ã«å¤‰æ›´ */
  max-width: 90vw;
  width: 100%;
  min-height: 170px;
  box-sizing: border-box;
">
  <canvas id="compat-radar" width="220" height="220" style="
    display: block;
    transform: translate(80px, 10px);  /* â† ã“ã‚Œã§å³ä¸‹ã«ãšã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ */
  "></canvas>
</div>

  <!-- ğŸ’¬ è©³ç´°ãƒ†ã‚­ã‚¹ãƒˆ -->
  <div style="
    background: linear-gradient(to right, #d3f2f9, #fcd8ee);
    border-radius: 24px;
    padding: 12px 20px;
    margin-top: -12px;
    max-width: 360px;
    width: 100%;
    font-family: 'Kosugi Maru', 'Noto Sans JP', sans-serif;
    box-shadow: 0 6px 18px rgba(0,0,0,0.25);
    color: #333;
    position: relative;
    text-align: left;
  ">
    <!-- âŒ é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ -->
    <div onclick="document.getElementById('compat-detail-modal').style.display='none'" style="
      position: absolute;
      top: 12px;
      right: 12px;
      background: #fff;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
      color: #e91e63;
    ">Ã—</div>

    <div id="compat-detail-text" style="font-size: 15px;">
      <!-- JavaScriptã§å†…å®¹ãŒå…¥ã‚‹ -->
    </div>
  </div>
</div>


<script>



  // ğŸ” ãƒ—ãƒ­ãƒ•ãƒ»èƒŒæ™¯ç”¨ï¼ˆé€éä¸è¦ â†’ JPEGï¼‰
  async function compressToJPEG(base64, maxSize = 180) {
    return new Promise((resolve) => {
      const img = new Image();
      img.onload = () => {
        const canvas = document.createElement("canvas");
        const scale = Math.min(maxSize / img.width, maxSize / img.height, 1);
        canvas.width = img.width * scale;
        canvas.height = img.height * scale;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        resolve(canvas.toDataURL("image/jpeg", 0.6));
      };
      img.src = base64;
    });
  }

  // ğŸ”„ ãƒšãƒ¼ã‚¸å†…ã®ç”»åƒã‚’é€ä¿¡å‰ã«åœ§ç¸®ï¼ˆbase64ã®ã¾ã¾ï¼‰
async function compressAllImagesBeforeSend() {
  const imageElements = document.querySelectorAll('img');

  for (const img of imageElements) {
    if (!img.src.startsWith('data:image/')) continue;

   const compressFn = compressToJPEG;

    try {
      const compressed = await compressFn(img.src, 180);
      img.src = compressed;
    } catch (err) {
      console.error('ç”»åƒã®åœ§ç¸®ã«å¤±æ•—ã—ã¾ã—ãŸ:', err);
    }
  }
}

</script>

<!-- Chart.js èª­ã¿è¾¼ã¿ -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- â–¼ åˆ©ç”¨è¦ç´„ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="terms-modal" style="
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background-color: rgba(0,0,0,0.6);
  z-index: 9999;
  padding: 40px 16px;
  box-sizing: border-box;
  justify-content: center;
  align-items: center;
">
  <!-- âœ… ç™½ã„è¦ç´„ãƒœãƒƒã‚¯ã‚¹ -->
  <div style="
    background: white;
    border-radius: 12px;
    width: 100%;
    max-width: 600px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    font-size: 14px;
    font-family: sans-serif;
    box-shadow: 0 4px 16px rgba(0,0,0,0.3);
  ">

    <!-- â–¼ è¦ç´„æœ¬æ–‡ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ï¼‰ -->
    <div style="
      padding: 24px;
      overflow-y: auto;
      max-height: 70vh;
      line-height: 1.8;
    ">
      <h2 style="text-align: center;">åˆ©ç”¨è¦ç´„</h2>
      <p>ã“ã®åˆ©ç”¨è¦ç´„ï¼ˆä»¥ä¸‹ã€Œæœ¬è¦ç´„ã€ã¨ã„ã„ã¾ã™ï¼‰ã¯ã€[ã‚µãƒ¼ãƒ“ã‚¹å]ï¼ˆä»¥ä¸‹ã€Œæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã€ã¨ã„ã„ã¾ã™ï¼‰ã‚’åˆ©ç”¨ã™ã‚‹å…¨ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆä»¥ä¸‹ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã¨ã„ã„ã¾ã™ï¼‰ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨ã«ã‚ãŸã£ã¦ã¯ã€æœ¬è¦ç´„ã«åŒæ„ã—ãŸã‚‚ã®ã¨ã¿ãªã—ã¾ã™ã€‚</p>

      <p><strong>ç¬¬1æ¡ï¼ˆé©ç”¨ç¯„å›²ï¼‰</strong><br>æœ¬è¦ç´„ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹éš›ã®ã™ã¹ã¦ã®è¡Œç‚ºã«é©ç”¨ã•ã‚Œã¾ã™ã€‚</p>
      <p><strong>ç¬¬2æ¡ï¼ˆã‚µãƒ¼ãƒ“ã‚¹å†…å®¹ï¼‰</strong><br>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã‚„ç”»åƒç­‰ã‚’è‡ªç”±ã«å…¥åŠ›ãƒ»ç·¨é›†ã—ã€ååˆºé¢¨ã‚«ãƒ¼ãƒ‰ã‚’ä½œæˆãƒ»å…±æœ‰ã™ã‚‹ãŸã‚ã®Webãƒ„ãƒ¼ãƒ«ã§ã™ã€‚</p>
      <p><strong>ç¬¬3æ¡ï¼ˆç¦æ­¢äº‹é …ï¼‰</strong><br>
        1. è™šå½ã®æƒ…å ±ã‚’å…¥åŠ›ã™ã‚‹è¡Œç‚º<br>
        2. ä»–è€…ã®æ¨©åˆ©ã‚’ä¾µå®³ã™ã‚‹è¡Œç‚ºï¼ˆè‘—ä½œæ¨©ã€è‚–åƒæ¨©ã€å•†æ¨™æ¨©ãªã©ï¼‰<br>
        3. ã‚ã„ã›ã¤ã€æš´åŠ›çš„ã€å·®åˆ¥çš„ã€ãã®ä»–å…¬åºè‰¯ä¿—ã«åã™ã‚‹æƒ…å ±ã®æŠ•ç¨¿<br>
        4. æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®é‹å–¶ã‚’å¦¨ã’ã‚‹è¡Œç‚º<br>
        5. æ³•ä»¤é•åã¨ãªã‚‹ä¸€åˆ‡ã®è¡Œç‚º
      </p>
      <p><strong>ç¬¬4æ¡ï¼ˆè‡ªå·±è²¬ä»»ï¼‰</strong><br>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€è‡ªã‚‰ã®è²¬ä»»ã«ãŠã„ã¦æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ã‚‚ã®ã¨ã—ã€æŠ•ç¨¿ãƒ»å…¥åŠ›ãƒ»ç”Ÿæˆã•ã‚ŒãŸå†…å®¹ã‚„ç¬¬ä¸‰è€…ã¨ã®é–“ã§ç”Ÿã˜ãŸãƒˆãƒ©ãƒ–ãƒ«ãƒ»æå®³ã«ã¤ã„ã¦ã€å½“æ–¹ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</p>
      <p><strong>ç¬¬5æ¡ï¼ˆã‚µãƒ¼ãƒ“ã‚¹ã®åœæ­¢ãƒ»å¤‰æ›´ï¼‰</strong><br>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€äºˆå‘Šãªãå†…å®¹ã®å¤‰æ›´ãƒ»åœæ­¢ãƒ»çµ‚äº†ã‚’è¡Œã†å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ç¬¬ä¸‰è€…ã«æå®³ãŒç™ºç”Ÿã—ãŸå ´åˆã§ã‚‚ã€å½“æ–¹ã¯ä¸€åˆ‡è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</p>
      <p><strong>ç¬¬6æ¡ï¼ˆè‘—ä½œæ¨©ãƒ»çŸ¥çš„è²¡ç”£æ¨©ï¼‰</strong><br>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã«é–¢é€£ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ã¯ã€å½“æ–¹ã¾ãŸã¯æ­£å½“ãªæ¨©åˆ©ã‚’æœ‰ã™ã‚‹ç¬¬ä¸‰è€…ã«å¸°å±ã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»ç”Ÿæˆã—ãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«é–¢ã—ã¦ã¯ã€å½“æ–¹ãŒã‚µãƒ¼ãƒ“ã‚¹é‹å–¶ä¸Šã®ç¯„å›²å†…ã§ä½¿ç”¨ã§ãã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚</p>
      <p><strong>ç¬¬7æ¡ï¼ˆå…è²¬äº‹é …ï¼‰</strong><br>å½“æ–¹ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã«äº‹å®Ÿä¸Šã¾ãŸã¯æ³•å¾‹ä¸Šã®ç‘•ç–µï¼ˆå®‰å…¨æ€§ã€ä¿¡é ¼æ€§ã€æ­£ç¢ºæ€§ã€å®Œå…¨æ€§ã€ç‰¹å®šã®ç›®çš„ã¸ã®é©åˆæ€§ãªã©ï¼‰ãŒãªã„ã“ã¨ã‚’æ˜ç¤ºçš„ã«ã‚‚é»™ç¤ºçš„ã«ã‚‚ä¿è¨¼ã—ã¾ã›ã‚“ã€‚ã¾ãŸã€ã‚·ã‚¹ãƒ†ãƒ éšœå®³ã‚„ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ç­‰ã«ã‚ˆã£ã¦ç™ºç”Ÿã—ãŸæå®³ã«ã¤ã„ã¦ã‚‚è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</p>
      <p><strong>ç¬¬8æ¡ï¼ˆå€‹äººæƒ…å ±ï¼‰</strong><br>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€å€‹äººæƒ…å ±ã®åé›†ãƒ»ä¿å­˜ã¯åŸå‰‡ã¨ã—ã¦è¡Œã„ã¾ã›ã‚“ã€‚ãŸã ã—ã€å¿…è¦ã«å¿œã˜ã¦ä¿å­˜ã•ã‚Œã‚‹æƒ…å ±ã«ã¤ã„ã¦ã¯ã€é©åˆ‡ã«ç®¡ç†ã—ç¬¬ä¸‰è€…ã«æä¾›ã—ã¾ã›ã‚“ã€‚</p>
      <p><strong>ç¬¬9æ¡ï¼ˆè¦ç´„ã®å¤‰æ›´ï¼‰</strong><br>æœ¬è¦ç´„ã¯ã€å½“æ–¹ã®åˆ¤æ–­ã«ã‚ˆã‚Šå¤‰æ›´ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚å¤‰æ›´å¾Œã®è¦ç´„ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ä¸Šã«æ²è¼‰ã•ã‚ŒãŸæ™‚ç‚¹ã§åŠ¹åŠ›ã‚’æŒã¡ã¾ã™ã€‚</p>
      <p><strong>ç¬¬10æ¡ï¼ˆæº–æ‹ æ³•ãƒ»ç®¡è½„ï¼‰</strong><br>æœ¬è¦ç´„ã®è§£é‡ˆãŠã‚ˆã³é©ç”¨ã¯æ—¥æœ¬æ³•ã«æº–æ‹ ã—ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã«é–¢é€£ã™ã‚‹ç´›äº‰ã¯ã€[é‹å–¶æ‹ ç‚¹ã‚’ç½®ãåœ°åŸŸ]ã®ç®¡è½„è£åˆ¤æ‰€ã‚’ç¬¬ä¸€å¯©ã®å°‚å±çš„åˆæ„ç®¡è½„è£åˆ¤æ‰€ã¨ã—ã¾ã™ã€‚</p>
      <p><strong>ç¬¬11æ¡ï¼ˆå•†ç”¨åˆ©ç”¨ã®ç¦æ­¢ã¨äº‹å‰é€£çµ¡ï¼‰</strong><br>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯åŸå‰‡ã¨ã—ã¦éå–¶åˆ©ç›®çš„ã§ã®å€‹äººåˆ©ç”¨ã®ã¿ã‚’è¨±å¯ã—ã¾ã™ã€‚ä¼æ¥­ã€æ³•äººã€å›£ä½“ã€ã¾ãŸã¯ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ç­‰ãŒå•†ç”¨ç›®çš„ã§åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€å¿…ãšäº‹å‰ã«å½“æ–¹ã«é€£çµ¡ã—ã€æ›¸é¢ç­‰ã«ã‚ˆã‚‹è¨±å¯ã‚’å¾—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚ç„¡æ–­ã§å•†ç”¨åˆ©ç”¨ãŒè¡Œã‚ã‚ŒãŸå ´åˆã«ã¯ã€å½“æ–¹ã¯åˆ©ç”¨ã®å·®æ­¢ã‚ã‚„æå®³è³ å„Ÿè«‹æ±‚ç­‰ã®æ³•çš„æªç½®ã‚’ã¨ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</p>

      <p style="text-align: right;">åˆ¶å®šæ—¥ï¼š2025å¹´7æœˆ10æ—¥</p>
    </div>

   <!-- âœ… ä¸‹éƒ¨ãƒœã‚¿ãƒ³ãƒãƒ¼ -->
    <div style="
      padding: 16px 24px 40px 24px; 
      border-top: 1px solid #ccc;
      background: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 24px;
    ">
      <label style="display: flex; align-items: center; flex: 1;">
        <input type="checkbox" id="agree-checkbox" style="margin-right: 10px;">
        åˆ©ç”¨è¦ç´„ã«åŒæ„ã—ã¾ã™
      </label>
  <button onclick="closeTermsModal()" style="
  padding: 10px 20px;
  border-radius: 8px;
  background: linear-gradient(135deg, #ffe6f0, #d6f2f9);
  color: #c2185b;
  font-weight: bold;
  font-family: 'Rounded Mplus 1c', 'Hiragino Maru Gothic ProN', sans-serif;
  border: none;
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  transition: all 0.2s ease-in-out;
  cursor: pointer;
">é–‰ã˜ã‚‹</button>
    </div>

  </div>
</div>
<!-- ğŸŒ¸ åˆ©ç”¨è¦ç´„é€šçŸ¥ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆå…ˆã«å‡ºã‚‹ã‚„ã¤ï¼‰ -->
<!-- ğŸŒ¸ åˆ©ç”¨è¦ç´„é€šçŸ¥ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆå…ˆã«å‡ºã‚‹ã‚„ã¤ï¼‰ -->
<div id="terms-notice" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.6); z-index: 10000; justify-content: center; align-items: center;">
  <div style="background: #fff0f4; padding: 24px; border-radius: 20px; box-shadow: 0 6px 20px rgba(0,0,0,0.2); text-align: center; max-width: 280px;">
    <div style="font-weight: bold; font-size: 18px; margin-bottom: 16px;">åˆ©ç”¨è¦ç´„ã«åŒæ„ã—ã¦ãã ã•ã„ã€‚</div>
    <div style="display: flex; justify-content: space-between;">
      <button id="notice-agree-btn" style="flex: 1; margin-right: 10px; background: #ffa5ba; color: white; border: none; border-radius: 8px; padding: 10px 0;">åŒæ„ã™ã‚‹</button>
      <button id="notice-close-btn" style="flex: 1; background: #aaa; color: white; border: none; border-radius: 8px; padding: 10px 0;">é–‰ã˜ã‚‹</button>
    </div>
  </div>
</div>


<script>
  function closeTermsModal() {
    document.getElementById('terms-modal').style.display = 'none';
  }

  function showCuteAlert(message) {
    document.getElementById('cute-alert-message').textContent = message;
    document.getElementById('cute-alert').style.display = 'flex';
  }

  function closeCuteAlert() {
    document.getElementById('cute-alert').style.display = 'none';
  }

  document.addEventListener('DOMContentLoaded', () => {
    // ä½œæˆãƒœã‚¿ãƒ³ï¼ˆï¼finish-buttonï¼‰ã‚’æŠ¼ã—ãŸã¨ã
    document.getElementById('finish-button').addEventListener('click', () => {
      const checkbox = document.getElementById('agree-checkbox');
      if (checkbox && checkbox.checked) {
        // âœ… ãƒã‚§ãƒƒã‚¯ãŒå…¥ã£ã¦ãŸã‚‰ç›´æ¥ä½œæˆãƒœã‚¿ãƒ³å‡¦ç†ã¸ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«é–‹ã‹ãšï¼‰
        document.getElementById('terms-modal').style.display = 'none';
        document.getElementById('create-button').click(); // â† ğŸ”´ ã“ã‚ŒãŒè¿½åŠ ã•ã‚ŒãŸéƒ¨åˆ†ï¼
      } else {
        // âŒ ãƒã‚§ãƒƒã‚¯ãŒãªã‘ã‚Œã°ã¾ãšé€šçŸ¥ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
        document.getElementById('terms-notice').style.display = 'flex';
      }
    });

    // é€šçŸ¥ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã€ŒåŒæ„ã™ã‚‹ã€ â†’ é€šçŸ¥é–‰ã˜ã¦è¦ç´„ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
    document.getElementById('notice-agree-btn').addEventListener('click', () => {
      document.getElementById('terms-notice').style.display = 'none';
      document.getElementById('terms-modal').style.display = 'flex';
    });

    // é€šçŸ¥ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã€Œé–‰ã˜ã‚‹ã€ â†’ é€šçŸ¥ã ã‘éè¡¨ç¤ºã«
    document.getElementById('notice-close-btn').addEventListener('click', () => {
      document.getElementById('terms-notice').style.display = 'none';
    });
  });
</script>
</div> <!-- ğŸ‘ˆ ãƒšãƒ¼ã‚¸å†…ã®æœ€å¾Œã® </div> ã®ç›´å‰ã¨ã‹ -->

<div id="text-tools">
  <div class="tool-row">
    <span class="tool-label">è‰²ï¼š</span>
    <input type="color" id="text-color-picker" value="#000000" style="width: 30px; height: 30px; border-radius: 50%; border: none;">
  </div>
</div>

<script>
  const colorPicker = document.getElementById("text-color-picker");
  if (colorPicker) {
    colorPicker.addEventListener("input", () => {
      document.querySelectorAll(".text-sticker").forEach(sticker => {
        sticker.style.color = colorPicker.value;
      });
    });
  }

  // åˆæœŸè¨­å®šã§ãƒ•ã‚©ãƒ³ãƒˆé©ç”¨ï¼ˆã¡ã‚‡ã„ä¸¸ã¿ç³»ï¼‰
  document.querySelectorAll(".text-sticker").forEach(sticker => {
    sticker.style.fontFamily = "'Rounded Mplus 1c', 'Noto Sans JP', sans-serif";
  });



  
function analyzeSelfPR() {
  const textarea = document.getElementById('self-pr-textarea');
  const text = textarea.value.trim().toLowerCase();
  if (!text) {
    alert('è‡ªå·±PRã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼');
    return;
  }

  const labels = ['å‹‰å­¦', 'ã‚¹ãƒãƒ¼ãƒ„', 'ã‚³ãƒŸãƒ¥åŠ›', 'å‰µé€ åŠ›', 'å¿è€åŠ›'];
  const baseScore = 70;
  const maxScore = 120;

  // å„é …ç›®ã®åˆæœŸã‚¹ã‚³ã‚¢
  let scores = labels.map(() => baseScore);

 const wordModifiers = {
  'å‹‰å­¦': [
    { word: 'å­¦æ¥­', value: 10 },
    { word: 'å‹‰å¼·', value: 10 },
    { word: 'è³‡æ ¼', value: 15 },
    { word: 'çœŸé¢ç›®', value: 5 },
    { word: 'é…åˆ»', value: -10 },
    { word: 'æˆæ¥­', value: 10 },
    { word: 'å‡ºå¸­', value: 10 },
    { word: 'ãƒ¬ãƒãƒ¼ãƒˆ', value: 5 },
    { word: 'äºˆç¿’', value: 10 },
    { word: 'å¾©ç¿’', value: 10 },
    { word: 'åŠªåŠ›å®¶', value: 10 },
    { word: 'å‹‰å­¦ã«åŠ±ã‚€', value: 10 },
    { word: 'èª²é¡Œæå‡º', value: 10 },
    { word: 'ã‚¼ãƒŸ', value: 5 },
    { word: 'ç ”ç©¶å®¤', value: 10 },
    { word: 'æˆç¸¾', value: 10 },
    { word: 'ãƒ†ã‚¹ãƒˆå‹‰å¼·', value: 10 },
    { word: 'ç†è§£åŠ›', value: 10 }
  ],
  'ã‚¹ãƒãƒ¼ãƒ„': [
    { word: 'é‹å‹•', value: 10 },
    { word: 'ã‚¹ãƒãƒ¼ãƒ„', value: 15 },
    { word: 'éƒ¨æ´»', value: 10 },
    { word: 'ã‚¤ãƒ³ã‚¿ãƒ¼ãƒã‚¤', value: 20 },
    { word: 'ä½“åŠ›ãŒãªã„', value: -10 },
    { word: 'ä½“è‚²ä¼š', value: 10 },
    { word: 'ç­‹ãƒˆãƒ¬', value: 10 },
    { word: 'æŒä¹…åŠ›', value: 10 },
    { word: 'å‹è² ', value: 5 },
    { word: 'ãƒãƒ¼ãƒ ãƒ—ãƒ¬ãƒ¼', value: 10 },
    { word: 'å¤§ä¼š', value: 10 },
    { word: 'é‹å‹•ç¿’æ…£', value: 5 },
    { word: 'èµ°ã‚‹ã®ãŒå¥½ã', value: 10 },
    { word: 'ã‚¹ãƒãƒ¼ãƒ„è¦³æˆ¦', value: 5 },
    { word: 'ãƒ•ã‚£ã‚¸ã‚«ãƒ«', value: 10 },
    { word: 'æœç·´', value: 10 }
  ],
  'ã‚³ãƒŸãƒ¥åŠ›': [
    { word: 'äººã¨è©±ã™ã®ãŒå¥½ã', value: 10 },
    { word: 'åˆå¯¾é¢', value: 5 },
    { word: 'ç·Šå¼µã—ã‚„ã™ã„', value: -10 },
    { word: 'ç©æ¥µçš„ã«ä¼šè©±', value: 15 },
    { word: 'èãä¸Šæ‰‹', value: 10 },
    { word: 'é›‘è«‡', value: 5 },
    { word: 'ä¼šè©±åŠ›', value: 10 },
    { word: 'ç››ã‚Šä¸Šã’å½¹', value: 10 },
    { word: 'ç©ºæ°—ã‚’èª­ã‚€', value: 10 },
    { word: 'è©±ã—ã‹ã‘ã‚‹', value: 10 },
    { word: 'ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¾—æ„', value: 10 },
    { word: 'å¯¾è©±', value: 10 },
    { word: 'è©±ã™ã®ãŒè‹¦æ‰‹', value: -10 },
    { word: 'ä»²é–“ã¨å”åŠ›', value: 10 },
    { word: 'ä¼šè©±ã«å…¥ã‚Œãªã„', value: -5 },
    { word: 'å¸ä¼šçµŒé¨“', value: 10 }
  ],
  'å‰µé€ åŠ›': [
    { word: 'ã‚¢ã‚¤ãƒ‡ã‚¢', value: 10 },
    { word: 'ç‹¬è‡ª', value: 10 },
    { word: 'ç™ºæƒ³', value: 15 },
    { word: 'ä¼ç”»', value: 10 },
    { word: 'æŸ”è»Ÿãªæ€è€ƒ', value: 15 },
    { word: 'å‰µä½œ', value: 10 },
    { word: 'è¡¨ç¾', value: 10 },
    { word: 'ãƒ‡ã‚¶ã‚¤ãƒ³', value: 10 },
    { word: 'æ§‹æƒ³', value: 10 },
    { word: 'è©¦è¡ŒéŒ¯èª¤', value: 10 },
    { word: 'ã‚¼ãƒ­ã‹ã‚‰è€ƒãˆã‚‹', value: 15 },
    { word: 'ã²ã‚‰ã‚ã', value: 10 },
    { word: 'ç™ºæ˜', value: 10 },
    { word: 'å‰µæ„å·¥å¤«', value: 15 },
    { word: 'è‡ªç”±ãªç™ºæƒ³', value: 10 }
  ],
  'å¿è€åŠ›': [
    { word: 'æˆ‘æ…¢å¼·ã„', value: 15 },
    { word: 'ç²˜ã‚Šå¼·ã„', value: 15 },
    { word: 'ç¶™ç¶š', value: 10 },
    { word: 'é›†ä¸­åŠ›', value: 10 },
    { word: 'ã™ãè«¦ã‚ã‚‹', value: -15 },
    { word: 'è² ã‘ãšå«Œã„', value: 10 },
    { word: 'åŠªåŠ›', value: 10 },
    { word: 'è€ãˆã‚‹', value: 10 },
    { word: 'å¤±æ•—ã—ã¦ã‚‚æŒ‘æˆ¦', value: 15 },
    { word: 'ã‚³ãƒ„ã‚³ãƒ„', value: 10 },
    { word: 'é•·æœŸé–“ã®å–ã‚Šçµ„ã¿', value: 10 },
    { word: 'ç¶™ç¶šã¯åŠ›ãªã‚Š', value: 15 },
    { word: 'ç²¾ç¥çš„ã«ã‚¿ãƒ•', value: 10 },
    { word: 'è«¦ã‚ãšã«ç¶šã‘ãŸ', value: 15 }
  ]
};


  // è£œæ­£ã‚’åŠ ãˆã‚‹
  labels.forEach((label, i) => {
    wordModifiers[label].forEach(({ word, value }) => {
      if (text.includes(word)) scores[i] += value;
    });
    if (scores[i] > maxScore) scores[i] = maxScore;
    if (scores[i] < 0) scores[i] = 0;
  });

  const goldData = scores.map(s => s > 100 ? s : 0);

  // ã‚³ãƒ¡ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®šç¾©
  const commentTemplates = {
  'å‹‰å­¦': score => {
    if (score >= 100) return 'çŸ¥è­˜ã®æ¢ç©¶è€…ï¼å­¦ã³ã«è²ªæ¬²ã§æˆç¸¾å„ªç§€ï¼';
    if (score >= 85) return 'å­¦ã¶å§¿å‹¢ãŒã—ã£ã‹ã‚Šã—ã¦ã„ã‚‹ã‚¿ã‚¤ãƒ—ï¼';
    if (score >= 70) return 'ã¾ã˜ã‚ã«å­¦æ¥­ã«å–ã‚Šçµ„ã‚€ã‚¿ã‚¤ãƒ—ï¼';
    return 'åŠªåŠ›æ¬¡ç¬¬ã§å¤§ããä¼¸ã³ã‚‹ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã‚ã‚Šï¼';
  },
  'ã‚¹ãƒãƒ¼ãƒ„': score => {
    if (score >= 100) return 'é‹å‹•ç¥çµŒæŠœç¾¤ï¼ã‚¢ã‚¹ãƒªãƒ¼ãƒˆæ°—è³ªï¼';
    if (score >= 85) return 'èº«ä½“ã‚’å‹•ã‹ã™ã®ãŒå¾—æ„ãªã‚¿ã‚¤ãƒ—ï¼';
    if (score >= 70) return 'åŸºæœ¬çš„ãªé‹å‹•ã¯ã“ãªã›ã‚‹ã‚¿ã‚¤ãƒ—ï¼';
    return 'é‹å‹•ã¯å°‘ã—è‹¦æ‰‹ã ãŒåŠªåŠ›ã§ã‚«ãƒãƒ¼ï¼';
  },
  'ã‚³ãƒŸãƒ¥åŠ›': score => {
    if (score >= 100) return 'èª°ã¨ã§ã‚‚ä»²è‰¯ããªã‚Œã‚‹å¤©æ‰çš„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚¿ãƒ¼ï¼';
    if (score >= 85) return 'äººã¨ã®è·é›¢ã‚’ç¸®ã‚ã‚‹ã®ãŒå¾—æ„ï¼';
    if (score >= 70) return 'å¿…è¦ã«å¿œã˜ã¦ä¼šè©±ã‚’åºƒã’ã‚‰ã‚Œã‚‹ã‚¿ã‚¤ãƒ—ï¼';
    return 'ä¼šè©±ã¯ã‚„ã‚„è‹¦æ‰‹ã ãŒã€èª å®Ÿã«å‘ãåˆãˆã‚‹ï¼';
  },
  'å‰µé€ åŠ›': score => {
    if (score >= 100) return 'ç‹¬å‰µçš„ãªç™ºæƒ³ã§å‘¨å›²ã‚’é©šã‹ã›ã‚‹ç™ºæ˜å®¶ï¼';
    if (score >= 85) return 'æŸ”è»Ÿã§è±Šã‹ãªç™ºæƒ³ãŒã§ãã‚‹ã‚¿ã‚¤ãƒ—ï¼';
    if (score >= 70) return 'æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å‡ºã™ã®ãŒå¥½ããªã‚¿ã‚¤ãƒ—ï¼';
    return 'è€ƒãˆã‚‹åŠ›ã‚’ç£¨ã‘ã°ã€æ‰èƒ½ãŒé–‹èŠ±ã™ã‚‹ã‚¿ã‚¤ãƒ—ï¼';
  },
  'å¿è€åŠ›': score => {
    if (score >= 100) return 'ã©ã‚“ãªå›°é›£ã«ã‚‚ç«‹ã¡å‘ã‹ã†é‰„ã®ãƒ¡ãƒ³ã‚¿ãƒ«ï¼';
    if (score >= 85) return 'ã‚³ãƒ„ã‚³ãƒ„åŠªåŠ›ã‚’ç©ã¿é‡ã­ã‚‹ã‚¿ã‚¤ãƒ—ï¼';
    if (score >= 70) return 'ç²˜ã‚Šå¼·ãå–ã‚Šçµ„ã‚ã‚‹ã‚¿ã‚¤ãƒ—ï¼';
    return 'æŒç¶šåŠ›ã‚’ã¤ã‘ã‚Œã°å¤§ããªåŠ›ã«å¤‰ã‚ã‚‹ï¼';
  }
};

  // ãƒãƒ£ãƒ¼ãƒˆæç”»
  if (window.selfPrChart) window.selfPrChart.destroy();
  const ctx = document.getElementById('resultChart').getContext('2d');
  window.selfPrChart = new Chart(ctx, {
    type: 'radar',
    data: {
      labels: labels,
      datasets: [
        {
          label: 'åˆ†æçµæœ',
          data: scores,
          fill: true,
          borderColor: 'rgba(54, 162, 235, 1)',
          backgroundColor: 'rgba(54, 162, 235, 0.3)',
          pointBackgroundColor: 'rgba(54, 162, 235, 1)'
        },
        {
          label: '100ç‚¹è¶…ãˆå¼·èª¿',
          data: goldData,
          fill: true,
          borderColor: 'gold',
          backgroundColor: 'rgba(255, 215, 0, 0.4)',
          pointBackgroundColor: 'gold',
          borderWidth: 3
        }
      ]
    },
    options: {
      responsive: false,
      scales: {
        r: {
          min: 0,
          max: 120,
          ticks: {
            stepSize: 20,
            display: false
          }
        }
      },
      plugins: {
        legend: { display: false }
      }
    }
  });
  document.getElementById('self-pr-comment').innerHTML = '';

  let commentHTML = '';
  const addedLabels = new Set(); // ğŸ‘ˆ é‡è¤‡é˜²æ­¢ã®ãŸã‚ã«Setã‚’ä½¿ã†

  labels.forEach((label, i) => {
    if (addedLabels.has(label)) return; // ğŸ‘ˆ ã™ã§ã«è¡¨ç¤ºã—ãŸãƒ©ãƒ™ãƒ«ã¯ã‚¹ã‚­ãƒƒãƒ—
    addedLabels.add(label);

    const score = scores[i];
    const comment = commentTemplates[label](score);

    const scoreStyle = score > 100
      ? 'color: gold; text-shadow: 0 0 5px gold; font-weight: bold;'
      : '';

    commentHTML += `
      <div style="margin-bottom: 6px;">
        <strong>${label}ï¼š</strong><span style="${scoreStyle}">${score}ç‚¹</span><br>
        <span style="font-size: 14px;">${comment}</span>
      </div>
    `;
  });

  document.getElementById('self-pr-comment').innerHTML = commentHTML;

  // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
  document.getElementById('self-pr-modal').style.display = 'flex';
  }
</script>
<script>
  // Enterã‚­ãƒ¼ã§æ¬¡ã®æ¬„ã¸ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’ç§»å‹•ï¼ˆãŸã ã— textarea ã¯é™¤ãï¼‰
  document.addEventListener('DOMContentLoaded', function () {
    const inputs = Array.from(document.querySelectorAll('.editable-text'));

    inputs.forEach((input, index) => {
      input.addEventListener('keydown', function (e) {
        // textarea ã ã£ãŸã‚‰æ”¹è¡Œã•ã›ã‚‹ï¼ˆå‡¦ç†ã—ãªã„ï¼‰
        if (input.tagName.toLowerCase() === 'textarea') return;

        if (e.key === 'Enter') {
          e.preventDefault();
          const next = inputs[index + 1];
          if (next) {
            next.focus();
          }
        }
      });
    });
  });
<!-- ğŸ”½ JavaScriptã¯ã“ã® <script> ã®ä¸­ã«å…¨éƒ¨å…¥ã‚Œã‚‹ï¼ -->

document.addEventListener('DOMContentLoaded', () => {
  const isFinalPage = window.location.href.includes('/user_cards/');
  let editMode = !isFinalPage; // å®Œæˆãƒšãƒ¼ã‚¸ã§ã¯falseã€é€šå¸¸ãƒšãƒ¼ã‚¸ã¯true

  const editToggle = document.getElementById('edit-toggle');
  const returnToggle = document.getElementById('return-toggle');
  const toolbars = document.querySelectorAll('.toolbar, .text-style-toolbar');
  const deleteButtons = document.querySelectorAll('.sns-delete-btn, .deco-delete-btn, .text-stamp-delete-btn');
  const templateSection = document.querySelector('.deletable-templates');
  const youtubeButton = document.querySelector('.youtube-section button');
  const spotifyButton = document.querySelector('#spotify-section button');
  const youtubeInput = document.getElementById('youtube-url');
  const spotifyInput = document.getElementById('spotify-url');
  const prTemplateSection = document.querySelector('.self-pr-template-section');
  const snsExplain = document.getElementById('sns-explain');
  const updateEditMode = () => {
    toolbars.forEach(el => el.style.display = editMode ? 'flex' : 'none');
    deleteButtons.forEach(el => el.style.display = editMode ? 'block' : 'none');
    if (editToggle) editToggle.src = editMode ? '/static/open_eye.jpeg' : '/static/closed_eye.jpeg';

    if (youtubeButton) youtubeButton.style.display = editMode ? 'block' : 'none';
    if (spotifyButton) spotifyButton.style.display = editMode ? 'block' : 'none';
    if (templateSection) templateSection.style.display = editMode ? 'block' : 'none';
    if (youtubeInput) youtubeInput.style.display = editMode ? 'block' : 'none';
    if (spotifyInput) spotifyInput.style.display = editMode ? 'block' : 'none';
    if (prTemplateSection) prTemplateSection.style.display = editMode ? 'block' : 'none';
    if (snsExplain) snsExplain.style.display = editMode ? 'block' : 'none';
    // æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºåˆ‡æ›¿
    if (returnToggle) {
      returnToggle.style.display = editMode ? 'none' : 'block';
    }

    // ğŸ‘‡ å®Œæˆãƒšãƒ¼ã‚¸ã ã£ãŸã‚‰ã‚¢ã‚¤ã‚³ãƒ³ã‚‚ãƒœã‚¿ãƒ³ã‚‚å…¨éƒ¨æ¶ˆã™ï¼ˆå¿µã®ãŸã‚ï¼‰
    if (isFinalPage) {
      if (editToggle) editToggle.style.display = 'none';
      if (returnToggle) returnToggle.style.display = 'none';
    }
  };

  // å®Œæˆãƒšãƒ¼ã‚¸ã§ã¯ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ã‚‚ä¸è¦
  if (!isFinalPage) {
    editToggle.addEventListener('click', () => {
      editMode = !editMode;
      updateEditMode();
    });

    returnToggle.addEventListener('click', () => {
      editMode = true;
      updateEditMode();
    });
  }

  updateEditMode(); // åˆæœŸåŒ–
});


</script>

</script>
<!-- èƒŒæ™¯ç”»åƒ -->
<img id="background-img" src="/static/box.jpeg" style="
  display: none;
  position: absolute;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  object-fit: cover;
  z-index: 9990;
">
</div>
<!-- âœ… ç”»åƒãƒœã‚¿ãƒ³ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ï¼‰ -->
<img id="toggle-background-btn" src="/static/box.jpeg" style="
  display: none;
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 48px;
  height: 48px;
  cursor: pointer;
  z-index: 9999;
">


<script>
  document.addEventListener('DOMContentLoaded', () => {
    const toggleBtn = document.getElementById('toggle-background-btn');
    const mainWrapper = document.querySelector('.main-wrapper');
    const backgroundImg = document.getElementById('background-img');
    let showingBackground = false;

    // âœ… å®Œæˆãƒšãƒ¼ã‚¸ã®ã¨ãã ã‘ãƒœã‚¿ãƒ³è¡¨ç¤º
    const isFinalPage = window.location.href.includes('/user_cards/');
    if (isFinalPage && toggleBtn) {
      toggleBtn.style.display = 'block';
    }

    toggleBtn?.addEventListener('click', () => {
      showingBackground = !showingBackground;
      if (mainWrapper) mainWrapper.style.display = showingBackground ? 'none' : 'block';
      if (backgroundImg) backgroundImg.style.display = showingBackground ? 'block' : 'none';
      toggleBtn.src = showingBackground ? "/static/box.jpeg" : "/static/box.jpeg";
    });
  });
</script>

</body>
</html>

