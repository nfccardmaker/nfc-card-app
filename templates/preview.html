<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ååˆºãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Helvetica Neue', sans-serif;
      background-color: #ffffff;
      overflow: auto;
    }

    body {
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  overflow-x: hidden; /* ğŸ‘ˆ æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¦æ­¢ï¼ */
  padding-bottom: 0px; 
}
    .main-wrapper {
      min-height: 100vh;
      padding-bottom: 140px; /* ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã‚’è€ƒæ…® */
      box-sizing: border-box;
    }
    .card {
      width: 90%;
      max-width: 700px;
      margin: 30px auto;
      border: 2px solid #ccc;
      border-radius: 10px;
      background-color: white;
      overflow-y: auto;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
    }

    .header-bar {
      background-color: var(--bar-color, #6a1b9a);
      height: 40px;
    }

    .student-id {
      display: flex;
      flex-direction: row;
      padding: 20px;
      gap: 20px;
    }

    .left-section {
      width: 40%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .left-section img {
      width: 125px;
      height: 125px;
      object-fit: cover;
      border-radius: 15px;
      cursor: pointer;
    }

    .info-section {
      width: 60%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      font-size: 14px;
      line-height: 1.6;
    }

    .editable-text {
      border: none;
      background: transparent;
      border-bottom: 1px solid #ccc;
      font-size: 14px;
      width: 100%;
    }
body {
  padding-bottom: 10px;
  box-sizing: border-box;
}

    .toolbar {
      position: fixed;
      bottom: 5px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 10px 16px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      display: flex;
      gap: 16px;
      z-index: 1000;
      align-items: center;
      
    }

    .toolbar img {
      width: 28spx;
      height: 28px;
      cursor: pointer;
    }

    .toolbar button {
      padding: 4px 12px;
      border: none;
      background: #eee;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }

        .hidden-input {
      opacity: 0;
      position: absolute;
      pointer-events: auto;
    }


    .sns-bar {
      margin: 20px auto;
      padding-left: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      z-index: 900;
    }

    .sns-item {
      background: white;
      border-radius: 12px;
      padding: 10px 16px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 16px;
      max-width: fit-content;
    }

    .sns-item img {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    .sns-input {
      margin-left: 36px;
      margin-top: 8px;
      display: none;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 5px 10px;
      width: 220px;
      font-size: 14px;
    }

    .sns-wrapper {
      display: flex;
      flex-direction: column;
    }

    canvas {
      position: fixed;
      top: 0;
      left: 0;
      z-index: 800;
      display: none;
    }

    .deco-img {
      position: absolute;
      width: 100px;
      height: auto;
      cursor: move;
      z-index: 950;
      user-select: none;
      touch-action: none;
    }
  .text-sticker {
  position: absolute;
  font-size: 20px;
  font-weight: bold;
  color: #222;
  background: transparent;
  border: none;
  padding: 0;
  z-index: 970;
  max-width: 80vw;
  word-break: break-word;
  user-select: none;
  cursor: move;
}
.sns-item {
  position: relative; /* ãƒœã‚¿ãƒ³ã‚’ä¸Šã«é‡ã­ã‚‹ãŸã‚ã«å¿…è¦ */
}

.sns-delete-btn {
  position: absolute;
  top: -8px;
  right: -8px;
  width: 18px;
  height: 18px;
  cursor: pointer;
  z-index: 10;
}
#bg-template-list::-webkit-scrollbar {
  display: none;
}
.youtube-section {
  margin-top: 10px;
  margin-bottom: 60px; /* â† è¿½åŠ ï¼ */
  text-align: center;
}
#youtube-url {
  width: 70%;
  max-width: 500px;
  padding: 5px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 14px;
  margin-top: 5px;
}
#youtube-player {
  margin: 0;
  padding: 0;
  line-height: 0;
}
iframe {
  width: 100%;
  height: 200px; /* â† aspect-ratioã¨ä½µç”¨ã›ãšæ˜ç¤ºæŒ‡å®šã§é«˜ã•å›ºå®š */
  border: none;
  margin: 0 auto;
  padding: 0;
}
body {
  box-sizing: border-box;
}
body {
  overscroll-behavior: contain; /* â† iOSã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è·³ã­è¿”ã‚Šã‚’æŠ‘åˆ¶ */
  padding-bottom: 80px;
}

  </style>
</head>
<body>
  <div class="card">
    <div class="header-bar"></div>
    <div class="student-id">
      <div class="left-section">
        <img id="profile-img" src="{{ image_data or '/static/profile_icon.jpeg' }}" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ">
        <input type="file" accept="image/*" id="profile-input" class="hidden-input">
      </div>
      <div class="info-section">
        <input type="text" class="editable-text" placeholder="åå‰">
        <input type="text" class="editable-text" placeholder="èª•ç”Ÿæ—¥">
        <input type="text" class="editable-text" placeholder="å¹´é½¢">
        <input type="text" class="editable-text" placeholder="å‡ºèº«åœ°">
        <input type="text" class="editable-text" placeholder="è¶£å‘³">
      </div>
    </div>
  </div>

 <!-- â–¼ SNSã‚¢ã‚¤ã‚³ãƒ³ã¨å…¥åŠ›æ¬„ -->
<div class="sns-bar">
  <div class="sns-wrapper">
    <div class="sns-item" style="position: relative;">
      <img src="/static/instagram_icon.jpeg" alt="Instagram" onclick="handleIconClick('instagram')">
      Instagram
      <img src="/static/batu.jpeg" alt="å‰Šé™¤" class="sns-delete-btn" onclick="hideSNS('instagram')" style="
        position: absolute;
        top: -8px;
        right: -8px;
        width: 18px;
        height: 18px;
        cursor: pointer;
        z-index: 10;
      ">
    </div>
    <input id="input-instagram" class="sns-input" placeholder="https://www.instagram.com/yourid" onblur="handleBlur('instagram')">
  </div>

  <div class="sns-wrapper">
    <div class="sns-item" style="position: relative;">
      <img src="/static/X_icon.jpeg" alt="X" onclick="handleIconClick('x')">
      Xï¼ˆæ—§Twitterï¼‰
      <img src="/static/batu.jpeg" alt="å‰Šé™¤" class="sns-delete-btn" onclick="hideSNS('x')" style="
        position: absolute;
        top: -8px;
        right: -8px;
        width: 18px;
        height: 18px;
        cursor: pointer;
        z-index: 10;
      ">
    </div>
    <input id="input-x" class="sns-input" placeholder="https://twitter.com/yourid" onblur="handleBlur('x')">
  </div>

  <div class="sns-wrapper">
    <div class="sns-item" style="position: relative;">
      <img src="/static/tiktok_icon.jpeg" alt="TikTok" onclick="handleIconClick('tiktok')">
      TikTok
      <img src="/static/batu.jpeg" alt="å‰Šé™¤" class="sns-delete-btn" onclick="hideSNS('tiktok')" style="
        position: absolute;
        top: -8px;
        right: -8px;
        width: 18px;
        height: 18px;
        cursor: pointer;
        z-index: 10;
      ">
    </div>
    <input id="input-tiktok" class="sns-input" placeholder="https://www.tiktok.com/@yourid" onblur="handleBlur('tiktok')">
  </div>
</div>


<!-- â–¼ è‡ªç”±è¨˜å…¥æ¬„ï¼ˆãƒãƒ„ä»˜ãï¼‰ -->
<div id="extra-text-wrapper" class="sns-wrapper" style="margin-top: 20px; position: relative;">
  <img src="/static/batu.jpeg" alt="å‰Šé™¤" class="sns-delete-btn" onclick="hideExtraText()" style="
    position: absolute;
    top: 0px;
    right: 30px;
    width: 18px;
    height: 18px;
    cursor: pointer;
    z-index: 10;
  ">
  <textarea id="extra-text" class="editable-text" placeholder="è¨˜å…¥æ¬„" style="
    margin-top: 3px;
    margin-left: 20px;
    padding: 14px 18px;
    border-radius: 14px;
    border: 1px solid #ccc;
    width: 85vw;
    max-width: 600px;
    height: 150px;
    font-size: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.12);
    resize: none;
    line-height: 1.6;
    background-color: #fff;
    box-sizing: border-box;
  "></textarea>
</div>




<!-- â–¼ YouTubeå…¥åŠ›æ¬„ -->
<div class="youtube-section" style="position: relative; margin-top: 20px;">
  <img src="/static/batu.jpeg" alt="å‰Šé™¤" class="sns-delete-btn" onclick="hideYouTubeSection()" style="
    position: absolute;
    top: 15px;
    right: 20px;
    width: 18px;
    height: 18px;
    cursor: pointer;
    z-index: 10;
  ">

  <!-- ã“ã“ã‚’å…ˆã« -->
  <div id="youtube-player" style="padding: 0; text-align: center;"></div>

  <!-- è¦‹å‡ºã— -->
  <div style="font-weight: bold; font-size: 14px; margin-bottom: 6px; text-align: left; padding-left: 5vw;">
    URL<br><span style="font-size: 12px; color: #555;">YouTube</span>
  </div>

  <!-- å…¥åŠ›æ¬„ã¨ãƒœã‚¿ãƒ³ -->
  <input type="text" id="youtube-url" placeholder="YouTubeã®URLã‚’å…¥åŠ›"
    style="width: 84vw; max-width: 500px; padding: 10px; border: 1px solid #ccc; border-radius: 10px; font-size: 14px;">
  <button onclick="embedYouTubeVideo()"
    style="margin-left: 20px; padding: 8px 12px; font-size: 14px; border-radius: 8px; background: #f0f0f0;">åæ˜ </button>
</div>


  <canvas id="draw-canvas"></canvas>
  <input type="file" id="background-input" class="hidden-input" accept="image/*" onchange="loadBackgroundImage(event)">
  <input type="file" id="deco-input" class="hidden-input" accept="image/*" onchange="addDecoImage(event)">
  <input type="color" id="color-picker" class="hidden-input" onchange="changeBarColor(event)">
<button id="finish-button" style="
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: #eee;
  border: none;
  padding: 6px 16px;
  font-size: 16px;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  z-index: 1001;
  cursor: pointer;
  display: none;
">
  å®Œæˆ
</button>
 <div class="toolbar" id="toolbar">
    <img src="/static/upload.jpeg" onclick="toggleBackgroundList()">
    <img src="/static/pen_off.jpeg" onclick="toggleTextMode()" id="text-toggle-icon">
    <div style="position: relative; width: 28px; height: 28px;">
  <img src="/static/student.jpeg" style="width: 100%; height: 100%; cursor: pointer;">
  <input type="color" id="color-picker"
         style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                opacity: 0; cursor: pointer;"
         onchange="changeBarColor(event)">
</div>
<img src="/static/restore.jpeg" onclick="restoreSNS()" style="width: 28px; height: 28px; cursor: pointer;">
    <img src="/static/photo_icon.jpeg" onclick="document.getElementById('deco-input').click()">
    <button onclick="togglePreview()" id="check-button">ç¢ºèª</button>
  </div>

  <script>
    const urls = { instagram: '', x: '', tiktok: '' };
    const canvas = document.getElementById('draw-canvas');
    const ctx = canvas.getContext('2d');
  function togglePreview() {
  const toolbar = document.getElementById('toolbar');
  const finalBtn = document.getElementById('finish-button');

  toolbar.style.display = 'none';
  finalBtn.style.display = 'block';
}
    let drawing = false, drawEnabled = false;
    let paths = [], currentPath = [];

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      redraw();
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function redraw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 2;
      for (const path of paths) {
        ctx.beginPath();
        path.forEach(([x, y], i) => i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y));
        ctx.stroke();
      }
      if (currentPath.length) {
        ctx.beginPath();
        currentPath.forEach(([x, y], i) => i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y));
        ctx.stroke();
      }
    }

    canvas.addEventListener('mousedown', e => {
      if (!drawEnabled) return;
      drawing = true;
      currentPath = [[e.offsetX, e.offsetY]];
    });

    canvas.addEventListener('mousemove', e => {
      if (!drawing || !drawEnabled) return;
      currentPath.push([e.offsetX, e.offsetY]);
      redraw();
    });

    canvas.addEventListener('mouseup', () => {
      if (!drawing || !drawEnabled) return;
      drawing = false;
      paths.push(currentPath);
      currentPath = [];
    });

    function toggleTextMode() {
      drawEnabled = !drawEnabled;
      canvas.style.display = drawEnabled ? 'block' : 'none';
      const icon = document.getElementById('text-toggle-icon');
      icon.src = drawEnabled ? '/static/pen_on.jpeg' : '/static/pen_off.jpeg';
    }

    function loadBackgroundImage(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        document.body.style.backgroundImage = `url('${reader.result}')`;
      };
      reader.readAsDataURL(file);
    }

    function changeBarColor(e) {
      document.documentElement.style.setProperty('--bar-color', e.target.value);
    }

    function handleIconClick(service) {
      const input = document.getElementById(`input-${service}`);
      if (urls[service]) {
        window.open(urls[service], '_blank');
      } else {
        input.style.display = 'block';
        input.focus();
      }
    }

    function handleBlur(service) {
      const input = document.getElementById(`input-${service}`);
      const value = input.value.trim();
      if (value) urls[service] = value;
      input.style.display = 'none';
    }

   function addDecoImage(e) {
  const file = e.target.files[0];
  if (!file) return;

  const img = document.createElement('img');
  const reader = new FileReader();
reader.onload = () => {
  img.src = reader.result;
};
reader.readAsDataURL(file);

 const scrollX = window.scrollX;
const scrollY = window.scrollY;

img.className = 'deco-img';
img.style.position = 'absolute'; // â† fixedã˜ã‚ƒãªãabsoluteï¼
img.style.left = (150 + scrollX) + 'px';
img.style.top = (300 + scrollY) + 'px';
img.style.transform = 'rotate(0deg) scale(1)';
img.style.touchAction = 'none';
img.draggable = false;

document.body.appendChild(img);

let posX = 150 + scrollX, posY = 300 + scrollY, scale = 1, rotation = 0;
let isDragging = false, offsetX = 0, offsetY = 0;
let longPressTimer = null;

  // PCç”¨ãƒã‚¦ã‚¹æ“ä½œ
  img.addEventListener('mousedown', e => {
    isDragging = true;
    offsetX = e.offsetX;
    offsetY = e.offsetY;
    longPressTimer = setTimeout(() => img.remove(), 1000);
  });

  document.addEventListener('mousemove', e => {
    if (!isDragging) return;
    clearTimeout(longPressTimer);
    posX = e.pageX - offsetX;
    posY = e.pageY - offsetY;
    img.style.left = `${posX}px`;
    img.style.top = `${posY}px`;
  });

  document.addEventListener('mouseup', () => {
    isDragging = false;
    clearTimeout(longPressTimer);
  });

  // ã‚¹ãƒãƒ›ç”¨ã‚¿ãƒƒãƒæ“ä½œ
  let initialDistance = null;
  let initialAngle = null;
  let startScale = 1;
  let startRotation = 0;

  img.addEventListener('touchstart', e => {
    if (e.touches.length === 1) {
      offsetX = e.touches[0].clientX - posX;
      offsetY = e.touches[0].clientY - posY;
      longPressTimer = setTimeout(() => img.remove(), 1000);
    } else if (e.touches.length === 2) {
      clearTimeout(longPressTimer);
      initialDistance = getDistance(e.touches[0], e.touches[1]);
      initialAngle = getAngle(e.touches[0], e.touches[1]);
      startScale = scale;
      startRotation = rotation;
    }
  }, { passive: false });

  img.addEventListener('touchmove', e => {
    e.preventDefault();
    if (e.touches.length === 1) {
      clearTimeout(longPressTimer);
      posX = e.touches[0].clientX - offsetX;
      posY = e.touches[0].clientY - offsetY;
      img.style.left = `${posX}px`;
      img.style.top = `${posY}px`;
    } else if (e.touches.length === 2) {
      const newDistance = getDistance(e.touches[0], e.touches[1]);
      const newAngle = getAngle(e.touches[0], e.touches[1]);

      scale = startScale * (newDistance / initialDistance);
      if (scale < 0.2) scale = 0.2;

      rotation = startRotation + (newAngle - initialAngle);
      img.style.transform = `rotate(${rotation}deg) scale(${scale})`;
    }
  }, { passive: false });

  img.addEventListener('touchend', () => {
    clearTimeout(longPressTimer);
  });

  function getDistance(t1, t2) {
    return Math.hypot(t2.clientX - t1.clientX, t2.clientY - t1.clientY);
  }

  function getAngle(t1, t2) {
    return Math.atan2(t2.clientY - t1.clientY, t2.clientX - t1.clientX) * 180 / Math.PI;
  }
}

    function downloadCard() {
      alert("ã“ã®éƒ¨åˆ†ã§ç”»åƒåŒ–ï¼†ZIPåŒ–ãªã©ã®å‡¦ç†ã‚’è¡Œã„ã¾ã™");
    }

    window.onload = () => {
      canvas.style.display = 'none';
      const profileImg = document.getElementById("profile-img");
      const profileInput = document.getElementById("profile-input");

      profileImg.addEventListener("click", () => {
        profileInput.click();
      });

      profileInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = () => {
          profileImg.src = reader.result;
        };
            fetch('/upload_profile_image', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ image: reader.result })
    })
    .then(response => response.json())
    .then(data => {
      console.log('ä¿å­˜æˆåŠŸ:', data);
    })
    .catch(error => {
      console.error('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—:', error);
    });

        reader.readAsDataURL(file);
      });
    };
let textEnabled = false;
let textFirstTapDone = false; // â† è¿½åŠ ï¼šåˆå›ã‚¹ã‚­ãƒƒãƒ—ãƒ•ãƒ©ã‚°

document.getElementById("text-toggle-icon").addEventListener("click", () => {
  textEnabled = !textEnabled;
  textFirstTapDone = false; // ONã«ã—ãŸã¨ãã«ãƒªã‚»ãƒƒãƒˆ
});

document.body.addEventListener("click", (e) => {
  if (!textEnabled) return;

  if (!textFirstTapDone) {
    textFirstTapDone = true;
    return; // â† åˆå›ã¯ã‚¹ã‚­ãƒƒãƒ—ã—ã¦åå¿œãªã—
  }

  if (e.target.tagName === "INPUT" || e.target.tagName === "TEXTAREA") return;
 const margin = 20;
const inputWidth = 150;
const maxX = window.innerWidth - inputWidth - margin;
const x = Math.min(e.pageX, maxX);
const y = e.pageY;

const input = document.createElement("input");
input.type = "text";
input.placeholder = "ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›";
input.className = "text-sticker";
input.style.position = "absolute";
input.style.left = `${x}px`;
input.style.top = `${y}px`;
input.style.width = '150px';  // å›ºå®šã‚µã‚¤ã‚ºã§æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢
input.style.maxWidth = 'calc(100vw - 40px)';  // å¿µã®ãŸã‚ã®å®‰å…¨ç­–
document.body.appendChild(input);
// å…¥åŠ›ãŒç©ºã®ã¾ã¾ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãŒå¤–ã‚ŒãŸã‚‰æ¶ˆã™å‡¦ç†
input.addEventListener("blur", () => {
  if (input.value.trim() === "") {
    input.remove();
  }
});
input.focus();
  let offsetX, offsetY, dragging = false;

  input.addEventListener("mousedown", (ev) => {
    dragging = true;
    offsetX = ev.offsetX;
    offsetY = ev.offsetY;
  });

  document.addEventListener("mousemove", (ev) => {
    if (!dragging) return;
    input.style.left = `${ev.pageX - offsetX}px`;
    input.style.top = `${ev.pageY - offsetY}px`;
  });

  document.addEventListener("mouseup", () => {
    dragging = false;
  });

  // é•·æŠ¼ã—ã§å‰Šé™¤ï¼ˆã‚¹ãƒãƒ›ç”¨ï¼‰
  let longPressTimer;
  input.addEventListener("touchstart", () => {
    longPressTimer = setTimeout(() => {
      input.remove();
    }, 1000);
  });

  input.addEventListener("touchend", () => {
    clearTimeout(longPressTimer);
  });
});
// SNSé …ç›®ã‚’éè¡¨ç¤ºã«ã™ã‚‹é–¢æ•°
function hideSNS(service) {
  const wrapper = document.querySelector(`.sns-wrapper:has(#input-${service})`);
  if (wrapper) wrapper.style.display = 'none';
}
function showHiddenSNS() {
  ['instagram', 'x', 'tiktok'].forEach(service => {
    const wrapper = document.querySelector(`.sns-wrapper:has(#input-${service})`);
    if (wrapper && wrapper.style.display === 'none') {
      wrapper.style.display = 'block';
    }
  });
}

function toggleBackgroundList() {
  const list = document.getElementById('bg-template-list');
  list.style.display = (list.style.display === 'none' || list.style.display === '') ? 'flex' : 'none';
}

function setBackground(url) {
  document.body.style.backgroundImage = `url('${url}')`;
  document.getElementById('bg-template-list').style.display = 'none';
}
function hideAddLink(event) {
  event.stopPropagation(); // ã€ŒshowHiddenSNS()ã€ãŒå‹•ã‹ãªã„ã‚ˆã†ã«
  const addBtn = document.getElementById('add-link-button');
  if (addBtn) addBtn.style.display = 'none';
}function restoreSNS() {
  ['instagram', 'x', 'tiktok'].forEach(service => {
    const wrapper = document.querySelector(`.sns-wrapper:has(#input-${service})`);
    if (wrapper) wrapper.style.display = 'flex';
  });

  const addBtn = document.getElementById('add-link-button');
  if (addBtn) addBtn.style.display = 'flex';
  const extraTextWrapper = document.getElementById('extra-text-wrapper');
  if (extraTextWrapper) extraTextWrapper.style.display = 'block';
  const youtubeSection = document.querySelector('.youtube-section');
  if (youtubeSection) youtubeSection.style.display = 'block';
}
function hideExtraText() {
  const wrapper = document.getElementById('extra-text-wrapper');
  if (wrapper) wrapper.style.display = 'none';
}
document.getElementById('finish-button').addEventListener('click', async () => {
  const finishBtn = document.getElementById('finish-button');
  finishBtn.disabled = true;
  finishBtn.textContent = 'ç”Ÿæˆä¸­...';
// å…¥åŠ›å€¤ã‚’è¡¨ç¤ºç”¨ã®è¦ç´ ã«åæ˜ 
// å…¥åŠ›å€¤ã‚’è¡¨ç¤ºã‚¨ãƒªã‚¢ã«åæ˜ ã™ã‚‹ï¼ˆå®Œæˆå‰ã«å¿…è¦ï¼ï¼‰
// å…¥åŠ›å€¤ã‚’ value å±æ€§ã«åæ˜ ï¼ˆFirebaseã«åæ˜ ã•ã‚Œã‚‹ã‚ˆã†ã«ï¼‰
const editableTexts = document.querySelectorAll('.editable-text');
editableTexts.forEach((input) => {
  input.setAttribute('value', input.value.trim());
});

// è¨˜å…¥æ¬„ï¼ˆtextareaï¼‰ã®å€¤ã‚’ value ã«åæ˜ 
const extraInput = document.getElementById('extra-text');
if (extraInput) {
  const text = extraInput.value.trim();
  extraInput.setAttribute('value', text);

  let hidden = document.getElementById('hidden-extra-text');
  if (!hidden) {
    hidden = document.createElement('input');
    hidden.type = 'hidden';
    hidden.id = 'hidden-extra-text';
    hidden.name = 'extra-text';
    extraInput.parentNode.appendChild(hidden); // âœ… ä¿®æ­£ï¼
  }
  hidden.value = text;
   extraInput.textContent = text;
}

  const toolbar = document.getElementById('toolbar');
  if (toolbar) toolbar.style.display = 'none';


  const youtubeBatsu = document.querySelector('.youtube-section .sns-delete-btn');
  if (youtubeBatsu) youtubeBatsu.style.display = 'none';
  // âœ… YouTubeå…¥åŠ›æ¬„ã¨åæ˜ ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã«ã™ã‚‹
const youtubeInput = document.getElementById('youtube-url');
const youtubeButton = document.querySelector('.youtube-section button');
if (youtubeInput) youtubeInput.style.display = 'none';
if (youtubeButton) youtubeButton.style.display = 'none';

// SNSãƒãƒ„å‰Šé™¤
document.querySelectorAll('.sns-wrapper .sns-delete-btn').forEach(btn => {
  if (btn.parentNode) {
    btn.parentNode.removeChild(btn);
  }
});

  const extraBatsu = document.querySelector('#extra-text-wrapper .sns-delete-btn');
  if (extraBatsu) extraBatsu.style.display = 'none';
  // SNSãƒªãƒ³ã‚¯ã‚’HTMLã«åŸ‹ã‚è¾¼ã‚€å‡¦ç†ï¼ˆå®Œæˆãƒœã‚¿ãƒ³å‡¦ç†ã®ä¸­ã«è¿½åŠ ï¼‰
['instagram', 'x', 'tiktok'].forEach(service => {
  const wrapper = document.querySelector(`.sns-wrapper:has(#input-${service})`);
  const link = urls[service];
  if (wrapper && link) {
    const snsItem = wrapper.querySelector('.sns-item');
    if (snsItem) {
      const img = snsItem.querySelector('img'); // ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒ
      const label = snsItem.childNodes[1]?.textContent?.trim() || service;

      // aã‚¿ã‚°ã§ãƒ©ãƒƒãƒ—ã—ã¦ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«
      const anchor = document.createElement('a');
      anchor.href = link;
      anchor.target = '_blank';
      anchor.style.display = 'flex';
      anchor.style.alignItems = 'center';
      anchor.style.gap = '10px';
      anchor.style.textDecoration = 'none';
      anchor.style.color = 'inherit';

      anchor.appendChild(img);
      anchor.appendChild(document.createTextNode(label));

      snsItem.innerHTML = '';
      snsItem.appendChild(anchor);
    }
  }
});


  // âœ… ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒãŒ blob: ã ã£ãŸã‚‰ä¿å­˜æ¸ˆã¿ã®URLã«æ›¸ãæ›ãˆã‚‹
  const profileImg = document.getElementById("profile-img");
  if (profileImg && profileImg.src.startsWith("blob:")) {
    profileImg.src = "/static/uploads/profile.jpeg";
  }
  if (profileImg && profileImg.src.startsWith("data:image/")) {
    profileImg.src = await compressImage(profileImg.src);
  }

  const decoImgs = document.querySelectorAll("img.deco-img");
  for (const img of decoImgs) {
    if (img.src.startsWith("data:image/")) {
      img.src = await compressImage(img.src);
    }
  }
    finishBtn.style.display = 'none';

    const html = document.documentElement.outerHTML;

  // âœ… base64ç”»åƒã®ã†ã¡ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã¨ãƒ‡ã‚³ç”»åƒã ã‘ã¯å‰Šé™¤å¯¾è±¡ã‹ã‚‰é™¤å¤–ï¼
  const cleanedHTML = html.replace(/<img[^>]+src="data:image\/[^"]+"[^>]*>/g, (match) => {
    if (match.includes('id="profile-img"') || match.includes('class="deco-img"')) {
      return match; // â†’ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ or ãƒ‡ã‚³ç”»åƒã¯ãã®ã¾ã¾æ®‹ã™
    } else {
      return match.replace(/src="data:image\/[^"]+"/, 'src="/static/deleted_image.jpeg"');
    }
  });

  const formData = new FormData();
  formData.append('html', cleanedHTML);

  const res = await fetch('/generate_url', {
    method: 'POST',
    body: formData
  });

  const data = await res.json();
  if (data.url) {
    finishBtn.textContent = 'ç”Ÿæˆå®Œäº†';
    finishBtn.style.display = 'block';

    const output = document.createElement('div');
    output.id = 'shared-url-box';
    output.innerHTML = `<p>ã“ã®URLã‚’å…±æœ‰ã§ãã¾ã™ğŸ‘‡</p><a href="${data.url}" target="_blank">${data.url}</a>`;
    output.style.cssText = `...`; // ã‚¹ã‚¿ã‚¤ãƒ«çœç•¥å¯
    document.body.appendChild(output);

    setTimeout(() => {
      const box = document.getElementById('shared-url-box');
      if (box) box.remove();
    }, 600000);
  } else {
    alert('URLã®ç™ºè¡Œã«å¤±æ•—ã—ã¾ã—ãŸ');
    finishBtn.disabled = false;
    finishBtn.textContent = 'å®Œæˆ';
    finishBtn.style.display = 'block';
  }
});



function embedYouTubeVideo() {
  const input = document.getElementById('youtube-url');
  const player = document.getElementById('youtube-player');
  let url = input.value.trim();

  // m.youtube â†’ www.youtube ã«å¤‰æ›
  url = url.replace("m.youtube.com", "www.youtube.com");

  const match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/);
  if (match && match[1]) {
    const videoId = match[1];
    player.innerHTML = `
      <iframe width="100%" height="200" 
      style="max-width: 90vw;"  
        src="https://www.youtube.com/embed/${videoId}" 
        frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
        allowfullscreen>
      </iframe>
    `;
  } else {
    player.innerHTML = "<p style='color:red;'>æ­£ã—ã„YouTubeã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>";
  }
}
function hideYouTubeSection() {
    const section = document.querySelector('.youtube-section');
    if (section) {
      section.style.display = 'none';
    }
  }
  // base64ç”»åƒã‚’ãƒªã‚µã‚¤ã‚ºï¼‹åœ§ç¸®ã™ã‚‹é–¢æ•°
async function compressImage(base64, maxSize = 300) {
  return new Promise((resolve) => {
    const img = new Image();
    img.onload = () => {
      const canvas = document.createElement("canvas");

      const scale = Math.min(maxSize / img.width, maxSize / img.height, 1);
      canvas.width = img.width * scale;
      canvas.height = img.height * scale;

      const ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      const compressed = canvas.toDataURL("image/jpeg", 0.6); // 60%åœ§ç¸®
      resolve(compressed);
    };
    img.src = base64;
  });
}
function startDiagnosis() {
  const textInputs = Array.from(document.querySelectorAll('.editable-text')).map(i => i.value).join(' ');
  const extra = document.getElementById('extra-text')?.value || '';
  const combined = (textInputs + ' ' + extra).toLowerCase();

  let type = 'INFP'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ

  if (combined.includes('è¨ˆç”»') || combined.includes('æ•´ç†')) type = 'J';
  else if (combined.includes('ã²ã‚‰ã‚ã') || combined.includes('è‡ªç”±')) type = 'P';

  if (combined.includes('ã²ã¨ã‚Š') || combined.includes('é™ã‹')) type = 'I';
  else if (combined.includes('ä»²é–“') || combined.includes('ãƒ¯ã‚¤ãƒ¯ã‚¤')) type = 'E';

  if (combined.includes('ç›´æ„Ÿ') || combined.includes('æƒ³åƒ')) type = 'N';
  else if (combined.includes('ç¾å®Ÿ') || combined.includes('å®Ÿç”¨')) type = 'S';

  if (combined.includes('å…±æ„Ÿ') || combined.includes('å„ªã—')) type += 'F';
  else if (combined.includes('è«–ç†') || combined.includes('åˆ†æ')) type += 'T';

  if (type.length < 4) type = 'INFP'; // ä¸å®Œå…¨ãªã‚‰åˆæœŸå€¤ã«

  const resultText = `ã‚ãªãŸã¯ã€Œ${type}ã‚¿ã‚¤ãƒ—ã€ã‹ã‚‚ï¼ï¼Ÿ`;

  document.getElementById('diagnosis-result').textContent = resultText;
  document.getElementById('diagnosis-modal').style.display = 'flex';

  // ã‚¿ãƒƒãƒ—ã§é–‰ã˜ã‚‹
  document.getElementById('diagnosis-modal').addEventListener('click', () => {
    document.getElementById('diagnosis-modal').style.display = 'none';
  });
}

  </script>
<!-- æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªèƒŒæ™¯ãƒ†ãƒ³ãƒ—ãƒ¬ä¸€è¦§ -->
<div id="bg-template-list" style="
  display: none;
  position: fixed;
  bottom: 70px;
  left: 50%;
  transform: translateX(-50%);
  background: white;
  padding: 10px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  z-index: 1100;
  max-width: 90vw;
  overflow-x: auto;
  gap: 10px;
  scrollbar-width: none; /* Firefoxç”¨ */
  -ms-overflow-style: none; /* IEç”¨ */
">
<!-- â–¼ ã‚«ãƒ¡ãƒ©ã‚¢ã‚¤ã‚³ãƒ³ä»˜ããƒ†ãƒ³ãƒ—ãƒ¬è¿½åŠ ã“ã“ã‹ã‚‰ -->
<img src="/static/camera.jpeg" onclick="document.getElementById('background-input').click()" 
     style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<!-- â–¼ ã‚«ãƒ¡ãƒ©ã‚¢ã‚¤ã‚³ãƒ³ä»˜ããƒ†ãƒ³ãƒ—ãƒ¬è¿½åŠ ã“ã“ã¾ã§ -->
  <img src="/static/haikei_1.jpeg" onclick="setBackground('/static/haikei_1.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_2.jpeg" onclick="setBackground('/static/haikei_2.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_3.jpeg" onclick="setBackground('/static/haikei_3.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_4.jpeg" onclick="setBackground('/static/haikei_4.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_5.jpeg" onclick="setBackground('/static/haikei_5.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_6.jpeg" onclick="setBackground('/static/haikei_6.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_7.jpeg" onclick="setBackground('/static/haikei_7.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_8.jpeg" onclick="setBackground('/static/haikei_8.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_9.jpeg" onclick="setBackground('/static/haikei_9.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<img src="/static/haikei_10.jpeg" onclick="setBackground('/static/haikei_10.jpeg')" style="width:50px; height:50px; cursor:pointer; border-radius:8px; flex-shrink:0;">
<!-- ã•ã‚‰ã«è¿½åŠ ã—ã¦ã‚‚OKï¼ -->

</div>
<!-- â–¼ è¨ºæ–­ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ -->
<div style="text-align: center; margin-top: 20px;">
  <button onclick="startDiagnosis()" style="
    padding: 10px 20px;
    font-size: 16px;
    border-radius: 10px;
    background-color: #f48fb1;
    color: white;
    border: none;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  ">è¨ºæ–­ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
</div>

<!-- â–¼ ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºéƒ¨åˆ† -->
<div id="diagnosis-modal" style="
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background-color: rgba(0,0,0,0.7);
  z-index: 9999;
  align-items: center;
  justify-content: center;
">
  <div style="
    background: white;
    padding: 30px;
    border-radius: 20px;
    max-width: 80vw;
    font-size: 24px;
    font-weight: bold;
    text-align: center;
    font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', sans-serif;
    animation: fadeIn 0.6s ease-in-out;
  " id="diagnosis-result"></div>
</div>

<style>
@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1); }
}
</style>

<script>
function startDiagnosis() {
  const textInputs = Array.from(document.querySelectorAll('.editable-text')).map(i => i.value).join(' ');
  const extra = document.getElementById('extra-text')?.value || '';
  const combined = (textInputs + ' ' + extra).toLowerCase();
  const barColor = getComputedStyle(document.documentElement).getPropertyValue('--bar-color').trim().toLowerCase();

  let type = '';

  if (
    combined.includes('ã²ã¨ã‚Š') || combined.includes('é™ã‹') ||
    combined.includes('æœ¬') || combined.includes('ã‚½ãƒ­') ||
    combined.includes('å®¶') || combined.includes('è½ã¡ç€ã') ||
    combined.includes('ã‚¢ãƒ‹ãƒ¡')
  ) {
    type += 'I';
  } else if (
    combined.includes('ä»²é–“') || combined.includes('ã¿ã‚“ãª') ||
    combined.includes('ã‚«ãƒ©ã‚ªã‚±') || combined.includes('ã‚¤ãƒ™ãƒ³ãƒˆ') ||
    combined.includes('æ—…è¡Œ') || combined.includes('é£²ã¿ä¼š')
  ) {
    type += 'E';
  } else {
    type += 'I';
  }

  if (
    combined.includes('ç©ºæƒ³') || combined.includes('ã²ã‚‰ã‚ã') ||
    combined.includes('æƒ³åƒ') || combined.includes('ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–') ||
    combined.includes('ã‚¢ãƒ¼ãƒˆ') || combined.includes('å‰µä½œ') ||
    combined.includes('å“²å­¦')
  ) {
    type += 'N';
  } else if (
    combined.includes('ç¾å®Ÿ') || combined.includes('å®Ÿç”¨') ||
    combined.includes('æ—…è¡Œ') || combined.includes('é‹å‹•') ||
    combined.includes('æ–™ç†') || combined.includes('ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢')
  ) {
    type += 'S';
  } else {
    type += 'N';
  }

  let tfScore = 0;
  if (
    combined.includes('è«–ç†') || combined.includes('åˆ†æ') ||
    combined.includes('åŠ¹ç‡') || combined.includes('æ•°å­—') ||
    combined.includes('ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°')
  ) {
    tfScore += 1;
  }
  if (
    combined.includes('å…±æ„Ÿ') || combined.includes('ã‚„ã•ã—ã„') ||
    combined.includes('å¿œæ´') || combined.includes('æ€ã„ã‚„ã‚Š') ||
    combined.includes('ã‚±ã‚¢')
  ) {
    tfScore -= 1;
  }

  if (barColor.includes('pink') || barColor.includes('#f') || barColor.includes('red')) {
    tfScore -= 1;
  }
  if (barColor.includes('blue') || barColor.includes('#00f') || barColor.includes('navy')) {
    tfScore += 1;
  }

  type += tfScore >= 0 ? 'T' : 'F';

  if (
    combined.includes('è¨ˆç”»') || combined.includes('æ•´ç†') ||
    combined.includes('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«') || combined.includes('æ™‚é–“ç®¡ç†') ||
    combined.includes('ãƒªã‚¹ãƒˆ') || combined.includes('æº–å‚™')
  ) {
    type += 'J';
  } else if (
    combined.includes('è‡ªç”±') || combined.includes('æ°—ã¾ã¾') ||
    combined.includes('æŸ”è»Ÿ') || combined.includes('ãƒã‚¤ãƒšãƒ¼ã‚¹') ||
    combined.includes('ãã®å ´')
  ) {
    type += 'P';
  } else {
    type += 'P';
  }

  const resultLines = [];

  // MBTIè¨ºæ–­
  resultLines.push(`ã‚ãªãŸã¯ã€Œ${type}ã‚¿ã‚¤ãƒ—ã€ã‹ã‚‚ï¼ï¼Ÿ`);

  const mbtiDescriptions = {
    INFP: "ç†æƒ³ä¸»ç¾©ã§æ„Ÿå—æ€§è±Šã‹ãªã€Œç™’ã—ç³»ã‚¿ã‚¤ãƒ—ã€ï¼",
    INTP: "è«–ç†çš„ã§æ¢ç©¶å¿ƒãŒå¼·ã„ã€Œæ€ç´¢å®¶ã‚¿ã‚¤ãƒ—ã€ï¼",
    INFJ: "äººã®å¿ƒã«å¯„ã‚Šæ·»ã†ã€Œé™ã‹ãªã‚«ãƒªã‚¹ãƒã‚¿ã‚¤ãƒ—ã€ï¼",
    INTJ: "æˆ¦ç•¥çš„ã§æœªæ¥å¿—å‘ãªã€Œæ§‹æƒ³æ´¾ã‚¿ã‚¤ãƒ—ã€ï¼",
    ENFP: "ã²ã‚‰ã‚ãã¨äººé–“é–¢ä¿‚ãŒå¾—æ„ãªã€Œå†’é™ºå®¶ã‚¿ã‚¤ãƒ—ã€ï¼",
    ENTP: "æ©Ÿè»¢ãŒåˆ©ã„ã¦æŒ‘æˆ¦ã‚’æã‚Œãªã„ã€Œã‚¢ã‚¤ãƒ‡ã‚¢ãƒãƒ³ã€ï¼",
    ENFJ: "äººã‚’å·»ãè¾¼ã‚€åŠ›ãŒã‚ã‚‹ã€Œãƒªãƒ¼ãƒ€ãƒ¼ã‚¿ã‚¤ãƒ—ã€ï¼",
    ENTJ: "ç›®æ¨™é”æˆã«ä¸€ç›´ç·šãªã€Œå¸ä»¤å¡”ã‚¿ã‚¤ãƒ—ã€ï¼",
    ISFP: "æ„Ÿæ€§ã¨èª¿å’Œã‚’é‡è¦–ã™ã‚‹ã€Œã‚„ã•ã—ã•æ´¾ã€ï¼",
    ISTP: "å†·é™æ²ˆç€ãªã€Œå®Ÿè·µæ´¾ã€ï¼",
    ISFJ: "æ”¯ãˆã‚‹ã“ã¨ã«å–œã³ã‚’æ„Ÿã˜ã‚‹ã€Œã‚µãƒãƒ¼ã‚¿ãƒ¼ã€ï¼",
    ISTJ: "è²¬ä»»æ„Ÿã®å¼·ã„ã€Œã—ã£ã‹ã‚Šè€…ã€ï¼",
    ESFP: "ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ãªã€Œã‚¨ãƒ³ã‚¿ãƒ¡å¥½ãã€ï¼",
    ESTP: "è¡Œå‹•åŠ›æŠœç¾¤ãªã€Œä½“é¨“å‹ãƒªãƒ¼ãƒ€ãƒ¼ã€ï¼",
    ESFJ: "äººã®å½¹ã«ç«‹ã¡ãŸã„ã€Œè¦ªã—ã¿æ´¾ã€ï¼",
    ESTJ: "åŠ¹ç‡çš„ã§å®Ÿå‹™ã«å¼·ã„ã€Œé ¼ã‚Œã‚‹äººã€ï¼"
  };
  resultLines.push(`\n MBTIçš„ã«ã¯ï¼š\n${mbtiDescriptions[type] || "ãƒãƒ©ãƒ³ã‚¹å‹ã‚¿ã‚¤ãƒ—ï¼"}`);

  // ã‚«ãƒ©ãƒ¼è¨ºæ–­
  if (barColor.includes('pink') || barColor.includes('#f')) {
    resultLines.push(`\n ã‚«ãƒ©ãƒ¼è¨ºæ–­ï¼š\né¸ã‚“ã è‰²ï¼ˆãƒ”ãƒ³ã‚¯ç³»ï¼‰ã¯ã€æ„Ÿå—æ€§ãŒè±Šã‹ã§ã‚„ã•ã—ã„æ€§æ ¼ã®ã‚ã‚‰ã‚ã‚Œã€‚`);
  } else if (barColor.includes('blue') || barColor.includes('#00f') || barColor.includes('navy')) {
    resultLines.push(`\n ã‚«ãƒ©ãƒ¼è¨ºæ–­ï¼š\né¸ã‚“ã è‰²ï¼ˆé’ç³»ï¼‰ã¯ã€å†·é™ã§èª å®Ÿãªæ€§æ ¼ã®ã‚ã‚‰ã‚ã‚Œã€‚`);
  } else if (barColor.includes('green')) {
    resultLines.push(`\n ã‚«ãƒ©ãƒ¼è¨ºæ–­ï¼š\né¸ã‚“ã è‰²ï¼ˆç·‘ç³»ï¼‰ã¯ã€èª¿å’Œã‚„è‡ªç„¶ã‚’å¤§åˆ‡ã«ã™ã‚‹ç©ã‚„ã‹ãªæ€§æ ¼ã§ã™ã€‚`);
  } else if (barColor.includes('yellow')) {
    resultLines.push(`\n ã‚«ãƒ©ãƒ¼è¨ºæ–­ï¼š\né¸ã‚“ã è‰²ï¼ˆé»„è‰²ç³»ï¼‰ã¯ã€æ˜ã‚‹ãå‰å‘ãã§ç¤¾äº¤çš„ãªã‚¿ã‚¤ãƒ—ã§ã™ã€‚`);
  } else {
    resultLines.push(`\n ã‚«ãƒ©ãƒ¼è¨ºæ–­ï¼š\né¸ã‚“ã è‰²ã‹ã‚‰ã‚‚å€‹æ€§çš„ãªã‚»ãƒ³ã‚¹ãŒæ„Ÿã˜ã‚‰ã‚Œã¾ã™ï¼`);
  }

  // è¶£å‘³è¨ºæ–­
  const hobbyAnalysis = [];
  if (combined.includes('ã‚²ãƒ¼ãƒ ')) hobbyAnalysis.push("æˆ¦ç•¥ç³»ãƒ»ãƒã‚¤ãƒšãƒ¼ã‚¹æ´¾");
  if (combined.includes('ã‚¢ãƒ‹ãƒ¡')) hobbyAnalysis.push("æ„Ÿæ€§è±Šã‹ã§å†…å‘å‹å¯„ã‚Š");
  if (combined.includes('æ—…è¡Œ')) hobbyAnalysis.push("å¥½å¥‡å¿ƒæ—ºç››ãªå†’é™ºã‚¿ã‚¤ãƒ—");
  if (combined.includes('ã‚«ãƒ•ã‚§')) hobbyAnalysis.push("ç™’ã—ãƒ»æ„Ÿæ€§é‡è¦–ã‚¿ã‚¤ãƒ—");
  if (combined.includes('éŸ³æ¥½')) hobbyAnalysis.push("æ„Ÿæƒ…ã¨ã®ã¤ãªãŒã‚ŠãŒå¼·ã„äºº");
  if (combined.includes('èª­æ›¸')) hobbyAnalysis.push("æ€ç´¢å‹ã§æƒ³åƒåŠ›ãŒè±Šã‹");
  if (combined.includes('ã‚¹ãƒãƒ¼ãƒ„')) hobbyAnalysis.push("å¤–å‘çš„ã§ã‚¨ãƒãƒ«ã‚®ãƒƒã‚·ãƒ¥");

  if (hobbyAnalysis.length > 0) {
    resultLines.push(`\nğŸ¯ è¶£å‘³è¨ºæ–­ï¼š\n${hobbyAnalysis.join('ï¼')} ãªå‚¾å‘ãŒè¦‹ã‚‰ã‚Œã¾ã™ï¼`);
  }

  // è¶£å‘³ã‹ã‚‰ã®æ‹¡å¼µææ¡ˆ
  const hobbyExtensions = [];
  const extraText = extra;

  if (extraText.includes('ã‚²ãƒ¼ãƒ ')) hobbyExtensions.push("ğŸ® å®Ÿã¯ã€Œã‚µãƒã‚²ãƒ¼ã€ã‚„ã€Œãƒœãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ã€ã‚‚ãƒãƒã‚‹ã‹ã‚‚ï¼Ÿ");
  if (extraText.includes('éŸ³æ¥½')) hobbyExtensions.push("ğŸµ å®Ÿã¯ã€Œãƒ©ã‚¤ãƒ–å‚æˆ¦ã€ã‚„ã€Œä½œè©ãƒ»ä½œæ›²æ´»å‹•ã€ã‚‚å‘ã„ã¦ã‚‹ã‹ã‚‚ï¼Ÿ");
  if (extraText.includes('ã‚¹ãƒãƒ¼ãƒ„')) hobbyExtensions.push("âš½ å®Ÿã¯ã€Œã‚¹ãƒãƒ¼ãƒ„è¦³æˆ¦ã€ã‚„ã€Œeã‚¹ãƒãƒ¼ãƒ„ã€ã‚‚ç†±ä¸­ã§ãã‚‹ã‹ã‚‚ï¼Ÿ");
  if (extraText.includes('ã‚«ãƒ•ã‚§')) hobbyExtensions.push("â˜• å®Ÿã¯ã€Œã‚«ãƒ•ã‚§å·¡ã‚Šãƒ–ãƒ­ã‚°ã€ã‚„ã€Œã‚³ãƒ¼ãƒ’ãƒ¼ã®æ·¹ã‚Œæ–¹ç ”ç©¶ã€ã‚‚æ¥½ã—ã„ã‹ã‚‚ï¼Ÿ");
  if (extraText.includes('ã‚¢ãƒ‹ãƒ¡')) hobbyExtensions.push("ğŸ¨ å®Ÿã¯ã€Œã‚¤ãƒ©ã‚¹ãƒˆåˆ¶ä½œã€ã‚„ã€Œã‚³ã‚¹ãƒ—ãƒ¬ã€ã‚‚æŒ‘æˆ¦ã—ã¦ã¿ãŸããªã‚‹ã‹ã‚‚ï¼Ÿ");
  if (extraText.includes('æ˜ ç”»')) hobbyExtensions.push("ğŸ¬ å®Ÿã¯ã€Œæ˜ ç”»ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿ã€ã‚„ã€Œè„šæœ¬ã¥ãã‚Šã€ã‚‚å¥½ãã‹ã‚‚ï¼Ÿ");
  if (extraText.includes('æ—…è¡Œ')) hobbyExtensions.push("âœˆï¸ å®Ÿã¯ã€Œæ—…å‹•ç”»ä½œã‚Šã€ã‚„ã€Œç¾åœ°ã‚°ãƒ«ãƒ¡å·¡ã‚Šã€ã‚‚æ¥½ã—ã‚ã‚‹ã‹ã‚‚ï¼Ÿ");
  if (extraText.includes('ç¾è¡“') || extraText.includes('ã‚¤ãƒ©ã‚¹ãƒˆ')) hobbyExtensions.push("ğŸ–¼ï¸ å®Ÿã¯ã€Œå±•ç¤ºå·¡ã‚Šã€ã‚„ã€Œãƒ‡ã‚¸ã‚¿ãƒ«ã‚¢ãƒ¼ãƒˆã€ã‚‚ã´ã£ãŸã‚Šã‹ã‚‚ï¼Ÿ");
  if (extraText.includes('èª­æ›¸')) hobbyExtensions.push("ğŸ“– å®Ÿã¯ã€ŒåŸ·ç­†æ´»å‹•ã€ã‚„ã€Œèª­æ›¸ä¼šã€ã‚‚å‘ã„ã¦ã‚‹ã‹ã‚‚ï¼Ÿ");
  if (extraText.includes('ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³')) hobbyExtensions.push("ğŸ‘— å®Ÿã¯ã€Œå¤ç€æ¢ã—ã€ã‚„ã€Œã‚»ãƒ«ãƒ•ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°æ’®å½±ã€ã‚‚å¾—æ„ã‹ã‚‚ï¼Ÿ");
  if (extraText.includes('ãƒšãƒƒãƒˆ')) hobbyExtensions.push("ğŸ¶ å®Ÿã¯ã€Œãƒšãƒƒãƒˆå†™çœŸæŠ•ç¨¿ã€ã‚„ã€Œã—ã¤ã‘å‹•ç”»ã®è¦–è´ã€ã‚‚å¥½ãã‹ã‚‚ï¼Ÿ");
  if (extraText.includes('ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢')) hobbyExtensions.push("â›°ï¸ å®Ÿã¯ã€Œç™»å±±ã€ã‚„ã€Œã‚­ãƒ£ãƒ³ãƒ—é“å…·åé›†ã€ã‚‚è¶£å‘³ã«ãªã‚‹ã‹ã‚‚ï¼Ÿ");
  if (extraText.includes('æ–™ç†')) hobbyExtensions.push("ğŸ³ å®Ÿã¯ã€Œãƒ¬ã‚·ãƒ”å‹•ç”»æŠ•ç¨¿ã€ã‚„ã€Œé£Ÿå™¨é›†ã‚ã€ã‚‚æ¥½ã—ã‚ã‚‹ã‹ã‚‚ï¼Ÿ");
  if (extraText.includes('ç­‹ãƒˆãƒ¬')) hobbyExtensions.push("ğŸ’ª å®Ÿã¯ã€Œé£Ÿäº‹ç®¡ç†ã€ã‚„ã€Œç­‹ãƒˆãƒ¬ä»²é–“ã¨ã®äº¤æµã€ã‚‚å¥½ãã‹ã‚‚ï¼Ÿ");

  if (hobbyExtensions.length > 0) {
    resultLines.push(`\nâœ¨ è¶£å‘³ã‹ã‚‰ã®åºƒãŒã‚Šææ¡ˆï¼š\n${hobbyExtensions.join('\n')}`);
  }

  const formattedResult = resultLines.map(line => `
    <div style="
      margin: 18px 0;
      font-size: 18px;
      line-height: 1.8;
      text-align: left;
    ">${line}</div>
  `).join('');

  document.getElementById('diagnosis-result').innerHTML = formattedResult;
  document.getElementById('diagnosis-modal').style.display = 'flex';
  document.getElementById('diagnosis-modal').addEventListener('click', () => {
    document.getElementById('diagnosis-modal').style.display = 'none';
  });
}
window.addEventListener('DOMContentLoaded', () => {
  const textInputs = Array.from(document.querySelectorAll('.editable-text')).map(i => i.value).join(' ');
  const extra = document.getElementById('extra-text')?.value || '';
  const combined = (textInputs + ' ' + extra).toLowerCase();

  const hobbyHints = [];
  if (combined.includes('ã‚²ãƒ¼ãƒ ')) hobbyHints.push('ğŸ® ã“ã®äººã¯ã€Œã‚²ãƒ¼ãƒ å¥½ãã€ã‹ã‚‚ï¼Ÿ');
  if (combined.includes('ã‚¢ãƒ‹ãƒ¡')) hobbyHints.push('ğŸ¥ ã‚¢ãƒ‹ãƒ¡ã‚„æ˜ åƒä½œå“ãŒå¥½ããªäººã‹ã‚‚ï¼Ÿ');
  if (combined.includes('æ—…è¡Œ')) hobbyHints.push('âœˆï¸ å¥½å¥‡å¿ƒæ—ºç››ã§æ—…è¡Œå¥½ããªã‚¿ã‚¤ãƒ—ã‹ã‚‚ï¼Ÿ');
  if (combined.includes('ã‚«ãƒ•ã‚§')) hobbyHints.push('â˜• ã‚«ãƒ•ã‚§å·¡ã‚Šã‚„ãŠã—ã‚ƒã‚Œãªç©ºé–“ãŒå¥½ãã‹ã‚‚ï¼Ÿ');
  if (combined.includes('éŸ³æ¥½')) hobbyHints.push('ğŸµ éŸ³æ¥½ã‚„ãƒ©ã‚¤ãƒ–ã«ã‚‚è©³ã—ã„ã‹ã‚‚ï¼Ÿ');
  if (combined.includes('ã‚¹ãƒãƒ¼ãƒ„')) hobbyHints.push('âš½ ã‚¹ãƒãƒ¼ãƒ„è¦³æˆ¦ã‚„ä½“ã‚’å‹•ã‹ã™ã®ãŒå¥½ãã‹ã‚‚ï¼Ÿ');
  if (combined.includes('èª­æ›¸')) hobbyHints.push('ğŸ“š æœ¬ã‚„ç‰©èªã®ä¸–ç•Œã«æ²¡é ­ã™ã‚‹ã®ãŒå¥½ãã‹ã‚‚ï¼Ÿ');
  if (combined.includes('æ˜ ç”»')) hobbyHints.push('ğŸ¬ æ˜ ç”»ã‚’èªã‚Šåˆã†ã®ãŒå¥½ããªã‚¿ã‚¤ãƒ—ã‹ã‚‚ï¼Ÿ');

  if (hobbyHints.length > 0) {
    const message = 'ğŸ“Œ ã“ã®äººã¯ã“ã‚“ãªã“ã¨ãŒå¥½ãã‹ã‚‚â€¦ï¼Ÿ\n\n' + hobbyHints.join('\n');
    document.getElementById('auto-hobby-text').innerText = message;
    document.getElementById('auto-hobby-modal').style.display = 'flex';
  }
});
</script>

</script>


</body>
</html> 